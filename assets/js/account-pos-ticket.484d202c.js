(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["account-pos-ticket"],{"42c8":function(t,e,c){},"4c53":function(t,e,c){"use strict";var o=c("23e7"),n=c("857a"),r=c("af03");o({target:"String",proto:!0,forced:r("sub")},{sub:function(){return n(this,"sub","","")}})},a615:function(t,e,c){"use strict";c("42c8")},e3a9:function(t,e,c){"use strict";c.r(e);c("99af"),c("b680");var o=c("f2bf"),n=function(t){return Object(o["pushScopeId"])("data-v-1f31a733"),t=t(),Object(o["popScopeId"])(),t},r={class:"card"},a={class:"body"},i={class:"flex items-center justify-end mb-3"},l={class:"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},u={key:0,class:"table-sm mb-2"},s=n((function(){return Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{style:{"min-width":"150px"}},"Product"),Object(o["createElementVNode"])("th",{style:{"min-width":"100px"}},"SKU"),Object(o["createElementVNode"])("th",null,"Price"),Object(o["createElementVNode"])("th",null,"Quantity"),Object(o["createElementVNode"])("th",null,"Total Price"),Object(o["createElementVNode"])("th",{style:{"min-width":"100px"}},"Actions")])],-1)})),d=["onClick"],m=["onClick"],b=["onClick"],p=["onClick"],j=["onClick"],O={key:0},f=["onClick"],k=["onClick"],y={key:0},v=n((function(){return Object(o["createElementVNode"])("td",{colspan:"6"},"No products available!",-1)})),N=[v];function h(t,e,c,n,v,h){var C=Object(o["resolveComponent"])("router-link"),g=Object(o["resolveComponent"])("icon"),V=Object(o["resolveComponent"])("pos-layout"),E=Object(o["resolveComponent"])("update-cart-item-modal");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createVNode"])(V,null,{content:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",r,[Object(o["createElementVNode"])("div",a,[Object(o["createElementVNode"])("div",i,[Object(o["createVNode"])(C,{tag:"a",to:{name:"account-pos-tickets"},class:"btn btn-primary mr-2"},{default:Object(o["withCtx"])((function(){return[Object(o["createTextVNode"])(Object(o["toDisplayString"])(n.translate("pos.tickets.back")),1)]})),_:1}),"paid"!==t.ticket.status&&t.ticket.cashier===t.employee.USERNAME?(Object(o["openBlock"])(),Object(o["createBlock"])(C,{key:0,tag:"a",to:{name:"account-pos-products"},class:"btn btn-primary"},{default:Object(o["withCtx"])((function(){return[Object(o["createTextVNode"])(Object(o["toDisplayString"])(n.translate("pos.tickets.add_product")),1)]})),_:1})):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",l,[t.ticket?(Object(o["openBlock"])(),Object(o["createElementBlock"])("table",u,[s,Object(o["createElementVNode"])("tbody",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.ticket.ticketProducts,(function(e,c){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{key:c},[Object(o["createElementVNode"])("td",{onClick:function(t){return n.launchUpdateCartItem(e,c)}},Object(o["toDisplayString"])(e.productName),9,d),Object(o["createElementVNode"])("td",{onClick:function(t){return n.launchUpdateCartItem(e,c)}},Object(o["toDisplayString"])(e.productSku),9,m),Object(o["createElementVNode"])("td",{onClick:function(t){return n.launchUpdateCartItem(e,c)}},Object(o["toDisplayString"])("".concat(e.productPrice," ").concat(n.currency)),9,b),Object(o["createElementVNode"])("td",{onClick:function(t){return n.launchUpdateCartItem(e,c)}},Object(o["toDisplayString"])(e.productQuantity),9,p),Object(o["createElementVNode"])("td",{onClick:function(t){return n.launchUpdateCartItem(e,c)}},Object(o["toDisplayString"])("".concat(n.toFixed(e.productPrice*e.productQuantity)," ").concat(n.currency)),9,j),Object(o["createElementVNode"])("td",null,[t.employee&&t.employee.USERNAME===t.ticket.cashier?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",O,["paid"!==t.ticket.status?(Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:0,onClick:function(t){return n.launchUpdateCartItem(e,c)},class:"hover:text-blue-500 mr-2"},[Object(o["createVNode"])(g,{name:"edit"})],8,f)):Object(o["createCommentVNode"])("",!0),"paid"!==t.ticket.status?(Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:1,onClick:function(t){return n.removeItemFromCart(e,c)},class:"hover:text-red-500"},[Object(o["createVNode"])(g,{name:"trash"})],8,k)):Object(o["createCommentVNode"])("",!0)])):Object(o["createCommentVNode"])("",!0)])])})),128)),0===t.ticket.ticketProducts.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",y,N)):Object(o["createCommentVNode"])("",!0)])])):Object(o["createCommentVNode"])("",!0)])])])]})),_:1}),Object(o["createVNode"])(E)],64)}var C=c("5530"),g=(c("a9e3"),c("a434"),c("ac1f"),c("1276"),c("d3b7"),c("25f0"),c("b64b"),c("66c3")),V=(c("4c53"),{class:"flex items-center justify-between"}),E={key:0},x={class:"mb-2"},w={class:"block mb-1"},I={class:"flex items-center"},B={class:"text-red-700 dark:text-red-400 text-sm"},S={class:"mt-4 text-right"},q={key:0,class:"mr-3"};function D(t,e,c,n,r,a){var i=Object(o["resolveComponent"])("icon"),l=Object(o["resolveComponent"])("j-button"),u=Object(o["resolveComponent"])("modal");return Object(o["openBlock"])(),Object(o["createBlock"])(u,{maxWidth:t.maxWidth,show:t.show,onClose:e[6]||(e[6]=function(t){return n.closeModal()})},{title:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",V,[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(n.translate("pos.title")),1),Object(o["createElementVNode"])("span",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer",onClick:e[0]||(e[0]=function(t){return n.closeModal()})},[Object(o["createVNode"])(i,{name:"close"})])])]})),content:Object(o["withCtx"])((function(){return[t.item?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",E,[Object(o["createElementVNode"])("form",{onSubmit:e[5]||(e[5]=Object(o["withModifiers"])((function(t){return n.submit()}),["prevent"]))},[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.item.itemName),1),Object(o["createElementVNode"])("div",x,[Object(o["createElementVNode"])("label",w,Object(o["toDisplayString"])(n.translate("pos.tickets.lbl_quantity")),1),Object(o["createElementVNode"])("div",I,[Object(o["createVNode"])(l,{onClick:e[1]||(e[1]=function(t){return n.sub()}),type:"button",class:"rounded-r-none"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(i,{name:"minus"})]})),_:1}),Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{onKeyup:e[2]||(e[2]=function(t){return n.validateQty()}),class:"form-input w-24 text-center rounded-none",type:"text","onUpdate:modelValue":e[3]||(e[3]=function(e){return t.form.qty=e})},null,544),[[o["vModelText"],t.form.qty]]),Object(o["createVNode"])(l,{onClick:e[4]||(e[4]=function(t){return n.add()}),type:"button",class:"rounded-l-none"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(i,{name:"plus"})]})),_:1})]),Object(o["createElementVNode"])("div",B,Object(o["toDisplayString"])(n.showError(t.errorBag,"qty")),1)]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(n.translate("pos.tickets.stock_left"))+" "+Object(o["toDisplayString"])(n.stockLeft),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(n.translate("pos.tickets.product_price"))+" "+Object(o["toDisplayString"])("".concat(t.item.productPrice," ").concat(t.currency)),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(n.translate("pos.tickets.total_price"))+" "+Object(o["toDisplayString"])("".concat(n.totalPrice," ").concat(t.currency)),1),Object(o["createElementVNode"])("div",S,[Object(o["createVNode"])(l,{disabled:t.isProcessing},{default:Object(o["withCtx"])((function(){return[t.isProcessing?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",q,[Object(o["createVNode"])(i,{name:"spinner",classes:"w-4 h-4 text-white"})])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(n.translate("pos.tickets.btn_save")),1)]})),_:1},8,["disabled"])])],32)])):Object(o["createCommentVNode"])("",!0)]})),_:1},8,["maxWidth","show"])}var P=c("714b"),U=c("cdae"),_=c("4032"),M=c("ea45"),Q=c("2ef0"),F=c("5502"),T=c("8923"),R={name:"UpdateCartItemModal",components:{Modal:P["a"],Icon:U["a"],JButton:_["a"]},setup:function(){var t=Object(o["inject"])("translate"),e=Object(o["inject"])("emitter"),c=Object(o["inject"])("toast"),n=Object(F["b"])(),r=Object(M["a"])(),a=r.showError,i=r.validate,l=Object(o["reactive"])({show:!1,maxWidth:"2xl",closeable:!0,item:null,ticket:null,itemIndex:-1,currency:"EUR",form:{qty:0},errorBag:{},rules:{qty:["required","minValue:1"]},messages:{qty:{required:"Please enter valid quantity",minValue:"Quantity should be greater than 0"}},isProcessing:!1,confirmHook:function(){}}),u=Object(o["computed"])((function(){return n.state.pos})),s=Object(o["computed"])((function(){return n.state.posCalls})),d=Object(o["computed"])((function(){if(!l.item)return 0;var t=Q["find"](u.value.products,{id:l.item.productId});return t?Number(t.stock)+Number(l.item.productQuantity)-Number(l.form.qty):0})),m=Object(o["computed"])((function(){return l.item?(l.item.productPrice*l.form.qty).toFixed(8):0}));Object(o["watch"])((function(){return Object(C["a"])({},l.form)}),(function(t,e){Object.keys(l.errorBag).length>0&&(l.errorBag=i(l.form,l.rules,l.messages))}));var b=function(){l.show=!1},p=function(){Number(l.form.qty)<Number(d.value)&&(l.form.qty=Number(l.form.qty)+1)},j=function(){Number(l.form.qty)>1&&(l.form.qty=Number(l.form.qty)-1)},O=function(){Number(l.form.qty)<1?l.form.qty=1:Number(l.form.qty)>Number(d.value)&&(l.form.qty=Number(d.value))},f=function(){if(l.errorBag=i(l.form,l.rules,l.messages),0===Object.keys(l.errorBag).length){l.isProcessing=!0;var t=Q["cloneDeep"](u.value),e=Q["findIndex"](t.tickets,{ticketId:l.ticket.ticketId.toString()});if(-1!==e){t.tickets[e].ticketProducts[l.itemIndex].productQuantity=l.form.qty,t.tickets[e].paymentRequest=null,n.dispatch(T["A"],{call:s.value.tickets,data:t.tickets});var o=Q["findIndex"](t.products,{id:l.item.productId});-1!==o&&(t.products[o].stock=d.value.toString(),n.dispatch(T["w"],{call:s.value.products,data:t.products}));var r=Q["findIndex"](t.favourites,{id:l.item.productId});-1!==r&&(t.favourites[r].stock=d.value.toString()),n.commit(T["S"],t),c.success("Quantity updated successfully"),l.isProcessing=!1,l.confirmHook(),b()}}};return Object(o["onBeforeMount"])((function(){e.on("updateCartItemModal",(function(t){l.currency=t.currency,l.item=t.product,l.ticket=t.ticket,l.itemIndex=t.itemIndex,l.confirmHook=t.confirm,l.form={qty:Number(l.item.productQuantity)},l.show=!0}))})),Object(C["a"])(Object(C["a"])({translate:t},Object(o["toRefs"])(l)),{},{stockLeft:d,totalPrice:m,closeModal:b,showError:a,add:p,sub:j,validateQty:O,submit:f})}},A=c("6b0d"),L=c.n(A);const W=L()(R,[["render",D]]);var H=W,J=c("2e13"),K=c("6c02"),Y={name:"Ticket",components:{"pos-layout":g["a"],Icon:U["a"],UpdateCartItemModal:H},setup:function(){var t=Object(o["inject"])("translate"),e=Object(o["inject"])("swal"),c=Object(o["inject"])("emitter"),n=Object(o["inject"])("toast"),r=Object(F["b"])(),a=Object(K["d"])(),i=Object(J["a"])(),l=i.toFixed,u=i.saveNotification,s=Object(o["reactive"])({ticket:null,employee:null,socket:null,isSocketClosed:!1}),d=Object(o["computed"])((function(){return r.state.accountInfo})),m=Object(o["computed"])((function(){return r.state.user})),b=Object(o["computed"])((function(){return r.state.pos})),p=Object(o["computed"])((function(){return r.state.posCalls})),j=Object(o["computed"])((function(){return d.value?d.value.PayoutCurrencyShortName:"EUR"})),O=function(t,e){c.emit("updateCartItemModal",{product:t,itemIndex:e,currency:j.value,ticket:s.ticket,confirm:function(){s.ticket=Q["find"](b.value.tickets,{ticketId:s.ticket.ticketId})}})},f=function(t,c){e.fire({title:"Ticket",text:"Are you sure, want to remove this product?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",focusCancel:!0,customClass:{container:"swal2-tailwind"}}).then((function(e){var o=e.value;if(o&&!0===o){var a=Q["cloneDeep"](b.value),i=Q["findIndex"](a.products,{id:t.productId});-1!==i&&(a.products[i].stock=Number(a.products[i].stock)+Number(t.productQuantity),r.dispatch(T["w"],{call:p.value.products,data:a.products}));var l=Q["findIndex"](a.favourites,{id:t.productId});-1!==l&&(a.favourites[l].stock=Number(b.value.favourites[l].stock)+Number(t.productQuantity));var d=Q["cloneDeep"](s.ticket),m=Q["findIndex"](a.tickets,{ticketId:d.ticketId});-1!==m&&(d.ticketProducts.splice(c,1),s.ticket=d,a.tickets.splice(m,1,d),r.dispatch(T["A"],{call:p.value.tickets,data:a.tickets}),r.commit(T["S"],a),n.success("Product removed successfully!"),u("Product removed successfully!"))}}))},k=function t(){s.socket=new WebSocket("wss://wss.cointopay.com/transactions"),s.socket.onmessage=function(t){if(t&&t.data){var e=t.data.split(":");if("pos"===e[0].toLowerCase()){var c=e[1];m.value&&c.toString()===m.value.ID.toString()&&r.dispatch(T["i"],{})}}},s.socket.onclose=function(e){s.isSocketClosed||t()}};return Object(o["onBeforeMount"])((function(){s.employee=Q["find"](b.value.users,{isLoggedIn:"true"}),Object.keys(a.params).length>0&&a.params.ticketId&&(s.ticket=Q["find"](b.value.tickets,{ticketId:a.params.ticketId}),k())})),Object(o["onBeforeUnmount"])((function(){s.isSocketClosed=!0,s.socket&&s.socket.close()})),Object(C["a"])(Object(C["a"])({translate:t},Object(o["toRefs"])(s)),{},{toFixed:l,currency:j,launchUpdateCartItem:O,removeItemFromCart:f})}};c("a615");const z=L()(Y,[["render",h],["__scopeId","data-v-1f31a733"]]);e["default"]=z}}]);
//# sourceMappingURL=account-pos-ticket.484d202c.js.map