(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shop-invoice"],{de56:function(e,t,o){"use strict";o.r(t);var c=o("f2bf");const n={key:0},r={class:"text-center mb-3"},a={class:"font-bold"},i={class:"font-bold"},l={class:"w-full lg:w-3/5 mx-auto"},s={class:"mb-4"},d={class:"text-3xl font-bold text-blue-500 text-center"},b=["href"],p=Object(c["createElementVNode"])("span",{class:"mr-2"},"Click to Redirect",-1),m={key:0},O={class:"mt-4"},u={class:"flex justify-center flex-wrap items-stretch w-full mb-4 relative"},j={class:"flex -mr-px"},v={class:"mb-4"},h={class:"text-3xl font-bold text-blue-500 text-center"},g=["href"],N=Object(c["createElementVNode"])("span",{class:"mr-2"},"Click to Redirect",-1),k={key:0},V={class:"mt-4"},y={key:0,class:"text-center mb-3"},E={class:"flex justify-center flex-wrap items-stretch w-full mb-4 relative"},f={class:"flex -mr-px"},x={class:"mb-4"},C={class:"text-3xl font-bold text-blue-500 text-center"},w=["href"],q=Object(c["createElementVNode"])("span",{class:"mr-2"},"Click to Redirect",-1),B={key:0},S={class:"text-center"},T={key:0,class:"card mt-4"},D={class:"body"},I={class:"scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},L={class:"table-sm mb-2"},R=Object(c["createElementVNode"])("th",null,"Item",-1),P={key:0},A=Object(c["createElementVNode"])("th",null,"Price",-1),_=Object(c["createElementVNode"])("th",null,"Quantity",-1),M=Object(c["createElementVNode"])("th",null,"Subtotal",-1),U={class:"flex items-center"},$=["src","onClick"],H={key:0},z={key:0},Q=["colspan"],F={colspan:"1"},J={key:1},K=["colspan"],Z={class:"text-red-500"},W={colspan:"1"},G={class:"text-red-500"},X=["colspan"],Y=Object(c["createElementVNode"])("span",{class:"font-bold"},"Total:",-1),ee=[Y],te={colspan:"1"},oe={class:"font-bold"},ce={class:"text-center"},ne={key:1,class:"row"},re={class:"offset-md-3 col-md-6 text-center"},ae={class:"alert alert-success"},ie=["innerHTML"];function le(e,t,o,Y,le,se){const de=Object(c["resolveComponent"])("icon"),be=Object(c["resolveComponent"])("QRCodeVue3"),pe=Object(c["resolveComponent"])("Tab"),me=Object(c["resolveComponent"])("TabSet"),Oe=Object(c["resolveComponent"])("router-link"),ue=Object(c["resolveComponent"])("centered-layout");return Object(c["openBlock"])(),Object(c["createBlock"])(ue,null,{default:Object(c["withCtx"])(()=>[e.invoice?(Object(c["openBlock"])(),Object(c["createElementBlock"])(c["Fragment"],{key:0},[Y.isInvoiceComplete?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",ne,[Object(c["createElementVNode"])("div",re,[Object(c["createElementVNode"])("div",ae,[Object(c["createElementVNode"])("span",{innerHTML:Y.translate("pos.invoice.success")},null,8,ie),Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.invoice.TransactionID),1)]),Object(c["createVNode"])(Oe,{class:"btn btn-success b200",tag:"a",to:"/shop"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(Y.translate("pos.cart.continue_shopping")),1)]),_:1})])])):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",n,[Object(c["createElementVNode"])("div",r,[Object(c["createElementVNode"])("p",null,Object(c["toDisplayString"])(Y.translate("pos.invoice.message")),1),Object(c["createElementVNode"])("p",null,[Object(c["createElementVNode"])("span",a,Object(c["toDisplayString"])(Y.translate("pos.invoice.merchant")),1),Object(c["createTextVNode"])(" "+Object(c["toDisplayString"])(e.invoice.ShopTitle),1)]),Object(c["createElementVNode"])("p",null,[Object(c["createElementVNode"])("span",i,Object(c["toDisplayString"])(Y.translate("pos.invoice.invoice_number")),1),Object(c["createTextVNode"])("  "+Object(c["toDisplayString"])(e.invoice.TransactionID),1)])]),Object(c["createElementVNode"])("div",l,[Object(c["createVNode"])(me,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(pe,{name:Y.translate("invoice.address_only")},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",s,[Object(c["createElementVNode"])("p",d,Object(c["toDisplayString"])(e.timer),1),Y.isPaid?(Object(c["openBlock"])(),Object(c["createElementBlock"])("a",{key:0,href:e.invoice.RedirectTargetURL,class:"mt-3 text-blue-500 hover:underline inline-flex items-center"},[p,Object(c["createVNode"])(de,{name:"arrow-right",classes:"w-5 h-5"})],8,b)):Object(c["createCommentVNode"])("",!0)]),Y.isPaid||Y.isExpired?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",m,[Object(c["createVNode"])(be,{imgclass:"mx-auto",width:Y.qrOptions.width,height:Y.qrOptions.height,"qr-options":Y.qrOptions.qrOptions,"background-options":Y.qrOptions.backgroundOptions,"dots-options":Y.qrOptions.dotsOptions,"corners-dot-options":Y.qrOptions.cornersDotOptions,"corners-square-options":Y.qrOptions.cornersSquareOptions,value:e.invoice.coinAddress},null,8,["width","height","qr-options","background-options","dots-options","corners-dot-options","corners-square-options","value"]),Object(c["createElementVNode"])("div",O,[Object(c["createElementVNode"])("div",u,[Object(c["withDirectives"])(Object(c["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=t=>e.invoice.coinAddress=t),readonly:"",class:"form-input w-2/3 rounded-r-none"},null,512),[[c["vModelText"],e.invoice.coinAddress]]),Object(c["createElementVNode"])("div",j,[Object(c["createElementVNode"])("span",{onClick:t[1]||(t[1]=t=>Y.copyToClipboard(e.invoice.coinAddress)),class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-300 dark:border-gray-600 px-3 whitespace-no-wrap text-sm"},[Object(c["createVNode"])(de,{name:"clipboard",classes:"w-5 h-5"})])])])])]))]),_:1},8,["name"]),Object(c["createVNode"])(pe,{name:Y.translate("invoice.full_crypto_link"),selected:!0},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",v,[Object(c["createElementVNode"])("p",h,Object(c["toDisplayString"])(e.timer),1),Y.isPaid?(Object(c["openBlock"])(),Object(c["createElementBlock"])("a",{key:0,href:e.invoice.RedirectTargetURL,class:"mt-3 text-blue-500 hover:underline inline-flex items-center"},[N,Object(c["createVNode"])(de,{name:"arrow-right",classes:"w-5 h-5"})],8,g)):Object(c["createCommentVNode"])("",!0)]),Y.isPaid||Y.isExpired?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",k,[Object(c["createVNode"])(be,{imgclass:"mx-auto",width:Y.qrOptions.width,height:Y.qrOptions.height,"qr-options":Y.qrOptions.qrOptions,"background-options":Y.qrOptions.backgroundOptions,"dots-options":Y.qrOptions.dotsOptions,"corners-dot-options":Y.qrOptions.cornersDotOptions,"corners-square-options":Y.qrOptions.cornersSquareOptions,value:Y.qrLink},null,8,["width","height","qr-options","background-options","dots-options","corners-dot-options","corners-square-options","value"]),Object(c["createElementVNode"])("div",V,[e.invoice.Tag?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",y,"Memo/Tag: "+Object(c["toDisplayString"])(e.invoice.Tag),1)):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("div",E,[Object(c["withDirectives"])(Object(c["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.invoice.coinAddress=t),readonly:"",class:"form-input w-2/3 rounded-r-none"},null,512),[[c["vModelText"],e.invoice.coinAddress]]),Object(c["createElementVNode"])("div",f,[Object(c["createElementVNode"])("span",{onClick:t[3]||(t[3]=t=>Y.copyToClipboard(e.invoice.coinAddress)),class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-300 dark:border-gray-600 px-3 whitespace-no-wrap text-sm"},[Object(c["createVNode"])(de,{name:"clipboard",classes:"w-5 h-5"})])])])])]))]),_:1},8,["name"]),Object(c["createVNode"])(pe,{name:Y.translate("invoice.tzero")},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",x,[Object(c["createElementVNode"])("p",C,Object(c["toDisplayString"])(e.timer),1),Y.isPaid?(Object(c["openBlock"])(),Object(c["createElementBlock"])("a",{key:0,href:e.invoice.RedirectTargetURL,class:"mt-3 text-blue-500 hover:underline inline-flex items-center"},[q,Object(c["createVNode"])(de,{name:"arrow-right",classes:"w-5 h-5"})],8,w)):Object(c["createCommentVNode"])("",!0)]),Y.isPaid||Y.isExpired?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",B,[Object(c["createVNode"])(be,{imgclass:"mx-auto",width:Y.qrOptions.width,height:Y.qrOptions.height,"qr-options":Y.qrOptions.qrOptions,"background-options":Y.qrOptions.backgroundOptions,"dots-options":Y.qrOptions.dotsOptions,"corners-dot-options":Y.qrOptions.cornersDotOptions,"corners-square-options":Y.qrOptions.cornersSquareOptions,value:e.invoice.TZERO},null,8,["width","height","qr-options","background-options","dots-options","corners-dot-options","corners-square-options","value"])]))]),_:1},8,["name"])]),_:1}),Object(c["createElementVNode"])("p",S,Object(c["toDisplayString"])(`${Y.translate("pos.invoice.amount")}: ${e.invoice.Amount} ${e.invoice.LongName}`),1),e.order.items.length>0?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",T,[Object(c["createElementVNode"])("div",D,[Object(c["createElementVNode"])("div",I,[Object(c["createElementVNode"])("table",L,[Object(c["createElementVNode"])("thead",null,[Object(c["createElementVNode"])("tr",null,[R,6===Object.keys(e.order.items[0]).length?(Object(c["openBlock"])(),Object(c["createElementBlock"])("th",P,"SKU")):Object(c["createCommentVNode"])("",!0),A,_,M])]),Object(c["createElementVNode"])("tbody",null,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.order.items,(t,o)=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("tr",{key:o},[Object(c["createElementVNode"])("td",null,[Object(c["createElementVNode"])("div",U,[t.url?(Object(c["openBlock"])(),Object(c["createElementBlock"])("img",{key:0,src:t.url,alt:"",class:"w-12 h-12 rounded-full overflow-hidden mr-2 cursor-pointer",onClick:e=>Y.fancyBox(t.url)},null,8,$)):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("p",null,Object(c["toDisplayString"])(t.name),1)])]),6===Object.keys(e.order.items[0]).length?(Object(c["openBlock"])(),Object(c["createElementBlock"])("td",H,Object(c["toDisplayString"])(t.sku),1)):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("td",null,Object(c["toDisplayString"])(Y.formatPrice(t.price,Y.currency)),1),Object(c["createElementVNode"])("td",null,Object(c["toDisplayString"])("x "+t.qty),1),Object(c["createElementVNode"])("td",null,Object(c["toDisplayString"])(Y.formatPrice(t.price*t.qty,Y.currency)),1)]))),128)),e.order.shipping?(Object(c["openBlock"])(),Object(c["createElementBlock"])("tr",z,[Object(c["createElementVNode"])("td",{colspan:6===Object.keys(e.order.items[0]).length?4:3,class:"text-right"},Object(c["toDisplayString"])(Y.translate("invoice.shipping_cost"))+": ",9,Q),Object(c["createElementVNode"])("td",F,Object(c["toDisplayString"])(e.order.shipping.method+" "+Y.formatPrice(e.order.shipping.cost,Y.currency)),1)])):Object(c["createCommentVNode"])("",!0),e.order.coupon?(Object(c["openBlock"])(),Object(c["createElementBlock"])("tr",J,[Object(c["createElementVNode"])("td",{colspan:6===Object.keys(e.order.items[0]).length?4:3,class:"text-right"},[Object(c["createElementVNode"])("span",Z,Object(c["toDisplayString"])(Y.translate("invoice.discount"))+":",1)],8,K),Object(c["createElementVNode"])("td",W,[Object(c["createElementVNode"])("span",G,"-"+Object(c["toDisplayString"])(Y.formatPrice(e.order.coupon.discount,Y.currency)),1)])])):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("tr",null,[Object(c["createElementVNode"])("td",{colspan:6===Object.keys(e.order.items[0]).length?4:3,class:"text-right"},ee,8,X),Object(c["createElementVNode"])("td",te,[Object(c["createElementVNode"])("span",oe,Object(c["toDisplayString"])(Y.cartTotal),1)])])])])])])])):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("div",ce,[Object(c["createVNode"])(Oe,{to:{name:"invoice",params:{confirmCode:e.invoice.Security}},tag:"a",class:"btn btn-primary"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])("Invoice Page ")]),_:1},8,["to"])])])]))],64)):Object(c["createCommentVNode"])("",!0)]),_:1})}o("14d9");var se=o("9e55"),de=o("cdae"),be=o("6605"),pe=o("5502"),me=o("8923"),Oe=o("bad0"),ue=o("f51a"),je=o("61c6"),ve=o.n(je),he=o("3fbe"),ge=o("2e13"),Ne=o("2ef0");const ke=o("1d5e");var Ve={name:"ShopInvoice",components:{CenteredLayout:se["a"],TabSet:Oe["a"],Tab:ue["a"],Icon:de["a"],QRCodeVue3:ve.a},setup(){const e=Object(c["inject"])("translate"),t=Object(c["inject"])("http"),o=Object(be["d"])(),n=Object(be["e"])(),r=Object(pe["b"])(),{qrOptions:a}=Object(he["a"])(),{copyToClipboard:i,formatPrice:l,fancyBox:s}=Object(ge["a"])(),d=Object(c["reactive"])({confirmCode:null,invoice:null,order:{items:[],shipping:null,coupon:null},interval:null,transactionInterval:null,timer:null,loader:"",socket:null,isClosedSocket:!1,status:"null"}),b=Object(c["computed"])(()=>!!d.status&&-1!==["paid","underpaid","complete"].indexOf(d.status.toLowerCase())),p=Object(c["computed"])(()=>d.invoice&&("paid"===d.invoice.Status.toLowerCase()||"underpaid"===d.invoice.Status.toLowerCase())),m=Object(c["computed"])(()=>d.invoice&&"expired"===d.invoice.Status.toLowerCase()),O=Object(c["computed"])(()=>d.invoice.CoinName.toLowerCase()+":"+d.invoice.coinAddress+"?amount="+d.invoice.Amount),u=Object(c["computed"])(()=>d.invoice?d.invoice.inputCurrency:"EUR"),j=Object(c["computed"])(()=>{let e=0;return d.order.items.length>0&&d.order.items.map(t=>{e+=Number(t.qty)*Number(t.price)}),d.order.shipping&&(e+=Number(d.order.shipping.cost)),d.order.coupon&&(e-=Number(d.order.coupon.discount)),l(e,u.value)}),v="https://app.cointopay.com",h=e=>{const t=decodeURIComponent(e.CustomerReferenceNr),o=document.createElement("div");o.innerHTML=t;let c=o.innerHTML.trim();d.order={items:[],shipping:null,coupon:null},c&&(c=c.split(":::").filter(Boolean),c.map(e=>{e=e.split("|").filter(Boolean),6===e.length?d.order.items.push({id:e[0],sku:e[1],name:e[2],url:e[3],price:Number(e[4]),qty:Number(e[5])}):5===e.length?d.order.items.push({id:e[0],name:e[1],url:e[2],price:Number(e[3]),qty:Number(e[4])}):2===e.length?d.order.shipping={method:e[0],cost:e[1]}:3===e.length&&(d.order.coupon={code:e[0],value:e[1],discount:e[2]})}))},g=(e,o="main")=>{d.loader=o;const c={Call:"Transactiondetail",MerchantID:0,APIKey:"_",ConfirmCode:e,output:"json"};t.get(v+"/v2REAPI",{params:c}).then(e=>{if(d.loader="",200===e.status&&"failed"!==e.data.result){d.invoice=e.data.data,h(d.invoice),r.commit(me["L"],d.invoice);const t=d.invoice.Status.toLowerCase();-1!==["paid","underpaid","expired"].indexOf(t)&&(d.timer=d.invoice.Status,d.transactionInterval&&clearInterval(d.transactionInterval),d.interval&&(clearInterval(d.interval),d.timer=t)),-1!==["waiting","awaiting-fiat"].indexOf(t)&&k()}}).catch(e=>{d.loader="",console.log(e)})},N=()=>{if(Object.keys(o.params).length>0){const e=o.params.confirmCode;g(e),d.transactionInterval&&clearInterval(d.transactionInterval),d.transactionInterval=setInterval(()=>{g(e,!1)},6e4)}else n.push({name:"shop"})},k=()=>{if(!d.timer){const e=ke.tz(d.invoice.CreatedOn,"Europe/Amsterdam").add(Number(d.invoice.ExpiryTime),"minutes");d.interval=setInterval(()=>{const t=ke().tz("Europe/Amsterdam").valueOf(),o=e.valueOf()-t,c=Math.floor(o/864e5),n=Math.floor(o%864e5/36e5),r=Math.floor(o%36e5/6e4),a=Math.floor(o%6e4/1e3);d.timer=`${c}d ${n}h ${r}m ${a}s`,o<0&&(clearInterval(d.interval),d.timer="Expired",g(d.invoice.ConfirmCode,""))},1e3)}},V=()=>{d.socket=new WebSocket("wss://wss.cointopay.com/transactions"),d.socket.onmessage=e=>{if(e&&e.data){const t=e.data.split(":");if(d.invoice){const e=Ne["cloneDeep"](d.invoice);"TZERO"===t[0]&&e&&Number(e.TransactionID)===Number(t[1])&&(d.interval&&clearInterval(d.interval),e.Status=t[2].toLowerCase(),d.status=t[2].toLowerCase(),r.commit(me["L"],e))}}},d.socket.onclose=e=>{d.isClosedSocket||V()}};return Object(c["onBeforeMount"])(()=>{N(),V()}),Object(c["onBeforeUnmount"])(()=>{d.transactionInterval&&clearInterval(d.transactionInterval),d.interval&&clearInterval(d.interval),null!==d.socket&&(d.isClosedSocket=!0,d.socket.close())}),{translate:e,...Object(c["toRefs"])(d),currency:u,isInvoiceComplete:b,copyToClipboard:i,qrOptions:a,isPaid:p,isExpired:m,qrLink:O,formatPrice:l,cartTotal:j,fancyBox:s}}},ye=o("6b0d"),Ee=o.n(ye);const fe=Ee()(Ve,[["render",le]]);t["default"]=fe}}]);
//# sourceMappingURL=shop-invoice.4ba9b3b2.js.map