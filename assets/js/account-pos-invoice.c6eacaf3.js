(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["account-pos-invoice"],{"8fab":function(e,t,n){"use strict";n.r(t);n("99af"),n("b0c0");var o=n("f2bf"),c={class:"mb-4 text-center"},r={class:"font-bold mr-2"},a={class:"font-bold mr-2"},i={class:"mb-4 flex items-center flex-col"},s={class:"flex flex-wrap justify-center items-stretch w-full relative"},l=["value"],d={class:"flex -mr-px"},u={class:"mb-4 flex items-center flex-col"},p={class:"flex flex-wrap justify-center items-stretch w-full relative"},m=["value"],b={class:"flex -mr-px"},v={class:"mb-4 flex items-center justify-between flex-col"},O={class:"text-center"},g={class:"text-2xl font-bold text-blue-500 text-center capitalize"},f={key:0,class:"mt-4"},j={class:"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},y={class:"table-md"},h=Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{style:{"min-width":"250px"}},"Item"),Object(o["createElementVNode"])("th",null,"SKU"),Object(o["createElementVNode"])("th",null,"Price"),Object(o["createElementVNode"])("th",null,"Quantity"),Object(o["createElementVNode"])("th",null,"Subtotal")])],-1),k={class:""},N=["src"],E={class:"mb-0 ml-1"},V={key:0},q={class:"text-right",colspan:"3"},x={colspan:"2"},C={key:1},w={class:"text-right",colspan:"3"},I={class:"text-blue-500",colspan:"2"},S=Object(o["createElementVNode"])("td",{class:"text-right",colspan:"3"},[Object(o["createElementVNode"])("span",{class:"font-bold"},"Total:")],-1),D={colspan:"2"},R={class:"font-bold"},T={class:"mt-2 text-center"},A=["href"];function B(e,t,n,B,P,_){var U=Object(o["resolveComponent"])("QRCodeVue3"),M=Object(o["resolveComponent"])("icon"),L=Object(o["resolveComponent"])("tab"),z=Object(o["resolveComponent"])("tab-set"),K=Object(o["resolveComponent"])("pulse-skeleton"),Q=Object(o["resolveComponent"])("pos-layout");return Object(o["openBlock"])(),Object(o["createBlock"])(Q,null,{content:Object(o["withCtx"])((function(){return[e.ticket&&e.invoice&&!B.isInvoiceComplete&&!e.isProcessing?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:0},[Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(B.translate("pos.invoice.message")),1),Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",r,Object(o["toDisplayString"])(B.translate("pos.invoice.merchant"))+":",1),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(e.invoice.ShopTitle),1)]),Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",a,Object(o["toDisplayString"])(B.translate("pos.invoice.invoice_number")),1),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(e.invoice.TransactionID),1)])]),Object(o["createVNode"])(z,null,{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(L,{name:B.translate("invoice.address_only")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",i,[Object(o["createVNode"])(U,{"background-options":B.qrOptions.backgroundOptions,"corners-dot-options":B.qrOptions.cornersDotOptions,"corners-square-options":B.qrOptions.cornersSquareOptions,"dots-options":B.qrOptions.dotsOptions,height:B.qrOptions.height,"qr-options":B.qrOptions.qrOptions,value:e.invoice.coinAddress,width:B.qrOptions.width,imgclass:"mx-auto mb-4"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"]),Object(o["createElementVNode"])("div",s,[Object(o["createElementVNode"])("input",{value:decodeURIComponent(e.invoice.coinAddress),class:"form-input flex-1 md:flex-none md:w-2/3 rounded-r-none",readonly:"",type:"text"},null,8,l),Object(o["createElementVNode"])("div",d,[Object(o["createElementVNode"])("span",{class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-500 px-3 whitespace-no-wrap text-sm",onClick:t[0]||(t[0]=function(t){return B.copyToClipboard(decodeURIComponent(e.invoice.coinAddress))})},[Object(o["createVNode"])(M,{classes:"w-5 h-5",name:"clipboard"})])])])])]})),_:1},8,["name"]),Object(o["createVNode"])(L,{name:B.translate("invoice.full_crypto_link"),selected:!0},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",u,[Object(o["createVNode"])(U,{"background-options":B.qrOptions.backgroundOptions,"corners-dot-options":B.qrOptions.cornersDotOptions,"corners-square-options":B.qrOptions.cornersSquareOptions,"dots-options":B.qrOptions.dotsOptions,height:B.qrOptions.height,"qr-options":B.qrOptions.qrOptions,value:B.cryptoLink,width:B.qrOptions.width,imgclass:"mx-auto mb-4"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"]),Object(o["createElementVNode"])("div",p,[Object(o["createElementVNode"])("input",{value:decodeURIComponent(e.invoice.coinAddress),class:"form-input flex-1 md:flex-none md:w-2/3 rounded-r-none",readonly:"",type:"text"},null,8,m),Object(o["createElementVNode"])("div",b,[Object(o["createElementVNode"])("span",{class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-500 px-3 whitespace-no-wrap text-sm",onClick:t[1]||(t[1]=function(t){return B.copyToClipboard(decodeURIComponent(e.invoice.coinAddress))})},[Object(o["createVNode"])(M,{classes:"w-5 h-5",name:"clipboard"})])])])])]})),_:1},8,["name"]),Object(o["createVNode"])(L,{name:B.translate("invoice.tzero")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",v,[Object(o["createVNode"])(U,{"background-options":B.qrOptions.backgroundOptions,"corners-dot-options":B.qrOptions.cornersDotOptions,"corners-square-options":B.qrOptions.cornersSquareOptions,"dots-options":B.qrOptions.dotsOptions,height:B.qrOptions.height,"qr-options":B.qrOptions.qrOptions,value:e.invoice.TZERO,width:B.qrOptions.width,imgclass:"mx-auto"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"])])]})),_:1},8,["name"])]})),_:1}),Object(o["createElementVNode"])("p",O,Object(o["toDisplayString"])(B.translate("pos.invoice.amount"))+": "+Object(o["toDisplayString"])("".concat(e.invoice.Amount," ").concat(e.invoice.LongName)),1),Object(o["createElementVNode"])("p",g,Object(o["toDisplayString"])(e.timer),1),e.order.items.length>0?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",f,[Object(o["createElementVNode"])("div",j,[Object(o["createElementVNode"])("table",y,[h,Object(o["createElementVNode"])("tbody",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.order.items,(function(e,t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{key:t},[Object(o["createElementVNode"])("td",null,[Object(o["createElementVNode"])("div",k,[Object(o["createElementVNode"])("img",{src:e.url,alt:"",style:{width:"100px"}},null,8,N),Object(o["createElementVNode"])("p",E,Object(o["toDisplayString"])(e.name),1)])]),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(e.sku),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(B.formatPrice(e.price,B.currency)),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])("x ".concat(e.qty)),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(B.formatPrice(e.price*e.qty,B.currency)),1)])})),128)),e.order.shipping?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",V,[Object(o["createElementVNode"])("td",q,Object(o["toDisplayString"])(B.translate("invoice.shipping_cost")),1),Object(o["createElementVNode"])("td",x,Object(o["toDisplayString"])(e.order.shipping.method+" "+B.formatPrice(e.order.shipping.cost,B.currency)),1)])):Object(o["createCommentVNode"])("",!0),e.order.coupon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",C,[Object(o["createElementVNode"])("td",w,Object(o["toDisplayString"])(B.translate("invoice.discount")),1),Object(o["createElementVNode"])("td",I,Object(o["toDisplayString"])("-".concat(B.formatPrice(e.order.coupon.discount,B.currency))),1)])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("tr",null,[S,Object(o["createElementVNode"])("td",D,[Object(o["createElementVNode"])("span",R,Object(o["toDisplayString"])(B.cartTotal),1)])])])])])])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("div",T,[Object(o["createElementVNode"])("a",{href:e.ticket.paymentRequest.RedirectURL,class:"btn btn-primary",target:"_blank"},"Invoice Detail",8,A)])],64)):Object(o["createCommentVNode"])("",!0),e.isProcessing?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:1},[Object(o["createVNode"])(K),Object(o["createVNode"])(K)],64)):Object(o["createCommentVNode"])("",!0)]})),_:1})}var P=n("5530"),_=(n("d81d"),n("a9e3"),n("d3b7"),n("25f0"),n("498a"),n("4de4"),n("ac1f"),n("1276"),n("159b"),n("a434"),n("66c3")),U=n("5502"),M=n("2ef0"),L=n("8923"),z=n("6c02"),K=n("7f45"),Q=n("2e13"),F=n("bf2e"),H=n("bad0"),Y=n("f51a"),J=n("61c6"),Z=n.n(J),W=n("3fbe"),G=n("cdae"),X={name:"Invoice",components:{PulseSkeleton:F["a"],"pos-layout":_["a"],TabSet:H["a"],Tab:Y["a"],QRCodeVue3:Z.a,Icon:G["a"]},setup:function(){var e=Object(o["inject"])("translate"),t=Object(o["inject"])("http"),n=Object(U["b"])(),c=Object(z["d"])(),r=Object(z["e"])(),a=Object(Q["a"])(),i=a.generateId,s=a.copyToClipboard,l=a.formatPrice,d=Object(W["a"])(),u=d.qrOptions,p=Object(o["reactive"])({invoice:null,ticket:null,order:{items:[],shipping:null,coupon:null},invoiceStatus:null,timer:null,interval:null,transactionInterval:null,socket:null,isCloseSocket:!1,isProcessing:!1}),m=Object(o["computed"])((function(){return n.state.pos})),b=Object(o["computed"])((function(){return n.state.posCalls})),v=Object(o["computed"])((function(){return"".concat(p.invoice.CoinName.toLowerCase(),":").concat(p.invoice.coinAddress,"?amount=").concat(p.invoice.Amount)})),O=Object(o["computed"])((function(){return p.ticket.paymentRequest?p.ticket.paymentRequest.inputCurrency:"EUR"})),g=Object(o["computed"])((function(){var e=0;return p.order.items.length>0&&p.order.items.map((function(t){e+=Number(t.qty)*Number(t.price)})),p.order.shipping&&(e+=Number(p.order.shipping.cost)),p.order.coupon&&(e-=Number(p.order.coupon.discount)),l(e,O.value)})),f=Object(o["computed"])((function(){return!!p.invoiceStatus&&-1!==["paid","underpaid","complete"].indexOf(p.invoiceStatus)})),j="https://app.cointopay.com",y=function(e){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p.isProcessing=o;var c={Call:"Transactiondetail",MerchantID:0,APIKey:"_",ConfirmCode:e,output:"json"};t.get("".concat(j,"/v2REAPI"),{params:c}).then((function(t){if(p.isProcessing=!1,200===t.status&&"failed"!==t.data.result&&(p.invoice=t.data.data,p.invoice)){var o=M["cloneDeep"](m.value.tickets),c=M["findIndex"](o,(function(t){return t.paymentRequest&&t.paymentRequest.Security===e}));if(-1!==c){if(p.ticket=o[c],p.ticket){k(p.ticket.paymentRequest);var a=p.invoice.Status.toLowerCase();if("paid"===a||"underpaid"===a?o[c].status="paid":"waiting"===a?o[c].status="inprogress":"expired"===a&&(o[c].status="waiting"),"waiting"===p.ticket.status)o[c].paymentRequest=null;else if("paid"===p.ticket.status){o[c].isActive=!1;var i=M["find"](m.value.receipts,{TICKETNUMBER:p.ticket.id.toString()});i||N(p.ticket)}}o[c].paymentRequest=p.invoice,n.dispatch(L["z"],{call:b.value.tickets,data:o});var s=p.invoice.Status.toLowerCase();if(p.invoiceStatus=s,"paid"===s||"underpaid"===s||"expired"===s){if(p.timer=p.invoice.Status,p.transactionInterval&&clearInterval(p.transactionInterval),p.interval&&(clearInterval(p.interval),p.timer=s),"paid"===p.ticket.status)return r.push({name:"account-pos-invoice-success",params:{ticketId:p.ticket.ticketId}});if("waiting"===p.ticket.status)return r.push({name:"account-pos-tickets"})}"waiting"!==s&&"awaiting-fiat"!==s||h()}}})).catch((function(e){p.isProcessing=!1,console.log(e)}))},h=function(){if(!p.timer){var e=K["tz"](p.invoice.CreatedOn,"Atlantic/Azores").add(p.invoice.ExpiryTime,"minutes");p.interval=setInterval((function(){var t=K["tz"]("Atlantic/Azores").valueOf(),n=e.valueOf()-t,o=Math.floor(n/864e5),c=Math.floor(n%864e5/36e5),r=Math.floor(n%36e5/6e4),a=Math.floor(n%6e4/1e3);p.timer="".concat(o,"d ").concat(c,"h ").concat(r,"m ").concat(a,"s"),n<0&&(clearInterval(p.interval),p.timer="Expired")}),1e3)}},k=function(e){var t=decodeURIComponent(e.CustomerReferenceNr),n=document.createElement("div");n.innerHTML=t;var o=n.innerHTML.trim();p.order={items:[],shipping:null,coupon:null},o&&(o=o.split(":::").filter(Boolean),o.map((function(e){e=e.split("|").filter(Boolean),6===e.length?p.order.items.push({id:e[0],sku:e[1],name:e[2],url:e[3],price:Number(e[4]),qty:Number(e[5])}):5===e.length?p.order.items.push({id:e[0],name:e[1],url:e[2],price:Number(e[3]),qty:Number(e[4])}):2===e.length?p.order.shipping={method:e[0],cost:e[1]}:3===e.length&&(p.order.coupon={code:e[0],value:e[1],discount:e[2]})})))},N=function(e){var t=M["cloneDeep"](m.value),o=t.receipts,c={ID:i(o),CASHIER:e.cashier,CURRENCY:e.inputCurrency,DATE:(new Date).getTime().toString(),TRANSACTION_ID:e.paymentRequest.TransactionID.toString(),TICKETNUMBER:e.ticketId.toString(),TOTAL:"Total Price: ".concat(e.paymentRequest.OriginalAmount)};o.push(c),n.dispatch(L["w"],{call:b.value.receipts,data:o});var r=t.receiptItems;e.ticketProducts.forEach((function(e){var t={ID:i(r),ITEM_NAME:e.productName,ITEM_PRICE:e.productPrice.toString(),ITEM_SKU:e.productSku,QUANTITY:e.productQuantity.toString(),CURRENCY:e.currency,RECIEPT_ID:c.ID,DATE:(new Date).getTime()};r.push(t)})),n.dispatch(L["x"],{call:b.value.receiptItems,data:r})},E=function(e){return e=e.toLowerCase(),"complete"===e?"paid":"failed"===e?"waiting":void 0},V=function e(){p.socket=new WebSocket("wss://wss.cointopay.com/transactions"),p.socket.onmessage=function(e){if(e&&e.data){var t=e.data.split(":");if(p.invoice){var o=M["cloneDeep"](p.invoice),c=M["cloneDeep"](m.value),a=c.tickets;if("TZERO"===t[0]&&o&&Number(o.TransactionID)===Number(t[1])){var i=M["cloneDeep"](p.ticket);4===t.length?(i.status="waiting",i.paymentRequest=null):i&&"inprogress"===i.status.toLowerCase()&&(i.status=E(t[2]),"waiting"===i.status?i.paymentRequest=null:"paid"===i.status&&(i.isActive=!1,N(i)));var s=M["findIndex"](a,(function(e){if(e.paymentRequest)return e.paymentRequest.Security===p.invoice.Security}));if(-1!==s){if(p.interval&&clearInterval(p.interval),p.invoiceStatus=o.Status,c.tickets.splice(s,1,i),n.dispatch(L["z"],{call:b.value.tickets,data:c.tickets}),"paid"===i.status)return r.push({name:"account-pos-invoice-success",params:{ticketId:i.ticketId}});if("waiting"===i.status)return r.push({name:"account-pos-tickets"})}}}}},p.socket.onclose=function(t){p.isCloseSocket||e()}};return Object(o["onBeforeMount"])((function(){c.params.confirmCode&&(y(c.params.confirmCode),V())})),Object(o["onBeforeUnmount"])((function(){p.interval&&clearInterval(p.interval),p.transactionInterval&&clearInterval(p.transactionInterval),p.isCloseSocket=!0,p.socket.close()})),Object(P["a"])(Object(P["a"])({translate:e},Object(o["toRefs"])(p)),{},{cryptoLink:v,copyToClipboard:s,qrOptions:u,currency:O,formatPrice:l,cartTotal:g,isInvoiceComplete:f})}},$=n("6b0d"),ee=n.n($);const te=ee()(X,[["render",B]]);t["default"]=te},bf2e:function(e,t,n){"use strict";var o=n("f2bf"),c=Object(o["createStaticVNode"])('<div class="p-2 w-full mx-auto"><div class="animate-pulse"><div class="flex-1 space-y-3 py-1"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-2"></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-1"></div></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div></div></div></div></div><div class="p-2 w-full mx-auto"><div class="animate-pulse"><div class="flex-1 space-y-3 py-1"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-1"></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-2"></div></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div></div></div></div></div>',2);function r(e,t,n,o,r,a){return c}var a={name:"PulseSkeleton"},i=n("6b0d"),s=n.n(i);const l=s()(a,[["render",r]]);t["a"]=l}}]);
//# sourceMappingURL=account-pos-invoice.c6eacaf3.js.map