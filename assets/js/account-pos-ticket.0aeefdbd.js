(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["account-pos-ticket"],{"42c8":function(e,t,c){},a615:function(e,t,c){"use strict";c("42c8")},e3a9:function(e,t,c){"use strict";c.r(t);var o=c("f2bf");const a=e=>(Object(o["pushScopeId"])("data-v-1f31a733"),e=e(),Object(o["popScopeId"])(),e),r={class:"card"},n={class:"body"},l={class:"flex items-center justify-end mb-3"},s={class:"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},i={key:0,class:"table-sm mb-2"},d=a(()=>Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{style:{"min-width":"150px"}},"Product"),Object(o["createElementVNode"])("th",{style:{"min-width":"100px"}},"SKU"),Object(o["createElementVNode"])("th",null,"Price"),Object(o["createElementVNode"])("th",null,"Quantity"),Object(o["createElementVNode"])("th",null,"Total Price"),Object(o["createElementVNode"])("th",{style:{"min-width":"100px"}},"Actions")])],-1)),u=["onClick"],m=["onClick"],b=["onClick"],p=["onClick"],j=["onClick"],O={key:0},k=["onClick"],y=["onClick"],f={key:0},N=a(()=>Object(o["createElementVNode"])("td",{colspan:"6"},"No products available!",-1)),v=[N];function h(e,t,c,a,N,h){const C=Object(o["resolveComponent"])("router-link"),V=Object(o["resolveComponent"])("icon"),g=Object(o["resolveComponent"])("pos-layout"),E=Object(o["resolveComponent"])("update-cart-item-modal");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createVNode"])(g,null,{content:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("div",r,[Object(o["createElementVNode"])("div",n,[Object(o["createElementVNode"])("div",l,[Object(o["createVNode"])(C,{tag:"a",to:{name:"account-pos-tickets"},class:"btn btn-primary mr-2"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(a.translate("pos.tickets.back")),1)]),_:1}),"paid"!==e.ticket.status&&e.ticket.cashier===e.employee.USERNAME?(Object(o["openBlock"])(),Object(o["createBlock"])(C,{key:0,tag:"a",to:{name:"account-pos-products"},class:"btn btn-primary"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(a.translate("pos.tickets.add_product")),1)]),_:1})):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",s,[e.ticket?(Object(o["openBlock"])(),Object(o["createElementBlock"])("table",i,[d,Object(o["createElementVNode"])("tbody",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.ticket.ticketProducts,(t,c)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{key:c},[Object(o["createElementVNode"])("td",{onClick:e=>a.launchUpdateCartItem(t,c)},Object(o["toDisplayString"])(t.productName),9,u),Object(o["createElementVNode"])("td",{onClick:e=>a.launchUpdateCartItem(t,c)},Object(o["toDisplayString"])(t.productSku),9,m),Object(o["createElementVNode"])("td",{onClick:e=>a.launchUpdateCartItem(t,c)},Object(o["toDisplayString"])(`${t.productPrice} ${a.currency}`),9,b),Object(o["createElementVNode"])("td",{onClick:e=>a.launchUpdateCartItem(t,c)},Object(o["toDisplayString"])(t.productQuantity),9,p),Object(o["createElementVNode"])("td",{onClick:e=>a.launchUpdateCartItem(t,c)},Object(o["toDisplayString"])(`${a.toFixed(t.productPrice*t.productQuantity)} ${a.currency}`),9,j),Object(o["createElementVNode"])("td",null,[e.employee&&e.employee.USERNAME===e.ticket.cashier?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",O,["paid"!==e.ticket.status?(Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:0,onClick:e=>a.launchUpdateCartItem(t,c),class:"hover:text-blue-500 mr-2"},[Object(o["createVNode"])(V,{name:"edit"})],8,k)):Object(o["createCommentVNode"])("",!0),"paid"!==e.ticket.status?(Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:1,onClick:e=>a.removeItemFromCart(t,c),class:"hover:text-red-500"},[Object(o["createVNode"])(V,{name:"trash"})],8,y)):Object(o["createCommentVNode"])("",!0)])):Object(o["createCommentVNode"])("",!0)])]))),128)),0===e.ticket.ticketProducts.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",f,v)):Object(o["createCommentVNode"])("",!0)])])):Object(o["createCommentVNode"])("",!0)])])])]),_:1}),Object(o["createVNode"])(E)],64)}var C=c("66c3");const V={class:"flex items-center justify-between"},g={key:0},E={class:"mb-2"},x={class:"block mb-1"},w={class:"flex items-center"},I={class:"text-red-700 dark:text-red-400 text-sm"},B={class:"mt-4 text-right"},S={key:0,class:"mr-3"};function q(e,t,c,a,r,n){const l=Object(o["resolveComponent"])("icon"),s=Object(o["resolveComponent"])("j-button"),i=Object(o["resolveComponent"])("modal");return Object(o["openBlock"])(),Object(o["createBlock"])(i,{maxWidth:e.maxWidth,show:e.show,onClose:t[6]||(t[6]=e=>a.closeModal())},{title:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("div",V,[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(a.translate("pos.title")),1),Object(o["createElementVNode"])("span",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer",onClick:t[0]||(t[0]=e=>a.closeModal())},[Object(o["createVNode"])(l,{name:"close"})])])]),content:Object(o["withCtx"])(()=>[e.item?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",g,[Object(o["createElementVNode"])("form",{onSubmit:t[5]||(t[5]=Object(o["withModifiers"])(e=>a.submit(),["prevent"]))},[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.item.itemName),1),Object(o["createElementVNode"])("div",E,[Object(o["createElementVNode"])("label",x,Object(o["toDisplayString"])(a.translate("pos.tickets.lbl_quantity")),1),Object(o["createElementVNode"])("div",w,[Object(o["createVNode"])(s,{onClick:t[1]||(t[1]=e=>a.sub()),type:"button",class:"rounded-r-none"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{name:"minus"})]),_:1}),Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{onKeyup:t[2]||(t[2]=e=>a.validateQty()),class:"form-input w-24 text-center rounded-none",type:"text","onUpdate:modelValue":t[3]||(t[3]=t=>e.form.qty=t)},null,544),[[o["vModelText"],e.form.qty]]),Object(o["createVNode"])(s,{onClick:t[4]||(t[4]=e=>a.add()),type:"button",class:"rounded-l-none"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{name:"plus"})]),_:1})]),Object(o["createElementVNode"])("div",I,Object(o["toDisplayString"])(a.showError(e.errorBag,"qty")),1)]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(a.translate("pos.tickets.stock_left"))+" "+Object(o["toDisplayString"])(a.stockLeft),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(a.translate("pos.tickets.product_price"))+" "+Object(o["toDisplayString"])(`${e.item.productPrice} ${e.currency}`),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(a.translate("pos.tickets.total_price"))+" "+Object(o["toDisplayString"])(`${a.totalPrice} ${e.currency}`),1),Object(o["createElementVNode"])("div",B,[Object(o["createVNode"])(s,{disabled:e.isProcessing},{default:Object(o["withCtx"])(()=>[e.isProcessing?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",S,[Object(o["createVNode"])(l,{name:"spinner",classes:"w-4 h-4 text-white"})])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(a.translate("pos.tickets.btn_save")),1)]),_:1},8,["disabled"])])],32)])):Object(o["createCommentVNode"])("",!0)]),_:1},8,["maxWidth","show"])}var D=c("714b"),P=c("cdae"),U=c("4032"),_=c("ea45"),M=c("2ef0"),Q=c("5502"),F=c("8923"),T={name:"UpdateCartItemModal",components:{Modal:D["a"],Icon:P["a"],JButton:U["a"]},setup(){const e=Object(o["inject"])("translate"),t=Object(o["inject"])("emitter"),c=Object(o["inject"])("toast"),a=Object(Q["b"])(),{showError:r,validate:n}=Object(_["a"])(),l=Object(o["reactive"])({show:!1,maxWidth:"2xl",closeable:!0,item:null,ticket:null,itemIndex:-1,currency:"EUR",form:{qty:0},errorBag:{},rules:{qty:["required","minValue:1"]},messages:{qty:{required:"Please enter valid quantity",minValue:"Quantity should be greater than 0"}},isProcessing:!1,confirmHook:()=>{}}),s=Object(o["computed"])(()=>a.state.pos),i=Object(o["computed"])(()=>a.state.posCalls),d=Object(o["computed"])(()=>{if(!l.item)return 0;const e=M["find"](s.value.products,{id:l.item.productId});return e?Number(e.stock)+Number(l.item.productQuantity)-Number(l.form.qty):0}),u=Object(o["computed"])(()=>l.item?(l.item.productPrice*l.form.qty).toFixed(8):0);Object(o["watch"])(()=>({...l.form}),(e,t)=>{Object.keys(l.errorBag).length>0&&(l.errorBag=n(l.form,l.rules,l.messages))});const m=()=>{l.show=!1},b=()=>{Number(l.form.qty)<Number(d.value)&&(l.form.qty=Number(l.form.qty)+1)},p=()=>{Number(l.form.qty)>1&&(l.form.qty=Number(l.form.qty)-1)},j=()=>{Number(l.form.qty)<1?l.form.qty=1:Number(l.form.qty)>Number(d.value)&&(l.form.qty=Number(d.value))},O=()=>{if(l.errorBag=n(l.form,l.rules,l.messages),0===Object.keys(l.errorBag).length){l.isProcessing=!0;const e=M["cloneDeep"](s.value),t=M["findIndex"](e.tickets,{ticketId:l.ticket.ticketId.toString()});if(-1!==t){e.tickets[t].ticketProducts[l.itemIndex].productQuantity=l.form.qty,e.tickets[t].paymentRequest=null,a.dispatch(F["A"],{call:i.value.tickets,data:e.tickets});const o=M["findIndex"](e.products,{id:l.item.productId});-1!==o&&(e.products[o].stock=d.value.toString(),a.dispatch(F["w"],{call:i.value.products,data:e.products}));const r=M["findIndex"](e.favourites,{id:l.item.productId});-1!==r&&(e.favourites[r].stock=d.value.toString()),a.commit(F["S"],e),c.success("Quantity updated successfully"),l.isProcessing=!1,l.confirmHook(),m()}}};return Object(o["onBeforeMount"])(()=>{t.on("updateCartItemModal",e=>{l.currency=e.currency,l.item=e.product,l.ticket=e.ticket,l.itemIndex=e.itemIndex,l.confirmHook=e.confirm,l.form={qty:Number(l.item.productQuantity)},l.show=!0})}),{translate:e,...Object(o["toRefs"])(l),stockLeft:d,totalPrice:u,closeModal:m,showError:r,add:b,sub:p,validateQty:j,submit:O}}},$=c("6b0d"),R=c.n($);const A=R()(T,[["render",q]]);var L=A,W=c("2e13"),H=c("6605"),J={name:"Ticket",components:{"pos-layout":C["a"],Icon:P["a"],UpdateCartItemModal:L},setup(){const e=Object(o["inject"])("translate"),t=Object(o["inject"])("swal"),c=Object(o["inject"])("emitter"),a=Object(o["inject"])("toast"),r=Object(Q["b"])(),n=Object(H["d"])(),{toFixed:l,saveNotification:s}=Object(W["a"])(),i=Object(o["reactive"])({ticket:null,employee:null,socket:null,isSocketClosed:!1}),d=Object(o["computed"])(()=>r.state.accountInfo),u=Object(o["computed"])(()=>r.state.user),m=Object(o["computed"])(()=>r.state.pos),b=Object(o["computed"])(()=>r.state.posCalls),p=Object(o["computed"])(()=>d.value?d.value.PayoutCurrencyShortName:"EUR"),j=(e,t)=>{c.emit("updateCartItemModal",{product:e,itemIndex:t,currency:p.value,ticket:i.ticket,confirm:()=>{i.ticket=M["find"](m.value.tickets,{ticketId:i.ticket.ticketId})}})},O=(e,c)=>{t.fire({title:"Ticket",text:"Are you sure, want to remove this product?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",focusCancel:!0,customClass:{container:"swal2-tailwind"}}).then(({value:t})=>{if(t&&!0===t){const t=M["cloneDeep"](m.value),o=M["findIndex"](t.products,{id:e.productId});-1!==o&&(t.products[o].stock=Number(t.products[o].stock)+Number(e.productQuantity),r.dispatch(F["w"],{call:b.value.products,data:t.products}));const n=M["findIndex"](t.favourites,{id:e.productId});-1!==n&&(t.favourites[n].stock=Number(m.value.favourites[n].stock)+Number(e.productQuantity));const l=M["cloneDeep"](i.ticket),d=M["findIndex"](t.tickets,{ticketId:l.ticketId});-1!==d&&(l.ticketProducts.splice(c,1),i.ticket=l,t.tickets.splice(d,1,l),r.dispatch(F["A"],{call:b.value.tickets,data:t.tickets}),r.commit(F["S"],t),a.success("Product removed successfully!"),s("Product removed successfully!"))}})},k=()=>{i.socket=new WebSocket("wss://wss.cointopay.com/transactions"),i.socket.onmessage=e=>{if(e&&e.data){const t=e.data.split(":");if("pos"===t[0].toLowerCase()){const e=t[1];u.value&&e.toString()===u.value.ID.toString()&&r.dispatch(F["i"],{})}}},i.socket.onclose=e=>{i.isSocketClosed||k()}};return Object(o["onBeforeMount"])(()=>{i.employee=M["find"](m.value.users,{isLoggedIn:"true"}),Object.keys(n.params).length>0&&n.params.ticketId&&(i.ticket=M["find"](m.value.tickets,{ticketId:n.params.ticketId}),k())}),Object(o["onBeforeUnmount"])(()=>{i.isSocketClosed=!0,i.socket&&i.socket.close()}),{translate:e,...Object(o["toRefs"])(i),toFixed:l,currency:p,launchUpdateCartItem:j,removeItemFromCart:O}}};c("a615");const K=R()(J,[["render",h],["__scopeId","data-v-1f31a733"]]);t["default"]=K}}]);
//# sourceMappingURL=account-pos-ticket.0aeefdbd.js.map