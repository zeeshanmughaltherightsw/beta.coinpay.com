{"version":3,"sources":["webpack:///./src/views/pos/Tickets.vue","webpack:///./src/components/account/pos/modals/tickets/SaveTicketModal.vue","webpack:///./src/components/account/pos/modals/tickets/SaveTicketModal.vue?ee0a","webpack:///./src/views/pos/Tickets.vue?729d","webpack:///./src/views/pos/Tickets.vue?32f2"],"names":["class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_withScopeId","_createElementVNode","value","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","style","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","key","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","colspan","_hoisted_26","render","_component_icon","_component_j_button","_component_router_link","_component_pos_layout","_component_save_ticket_modal","_directive_tippy","_openBlock","_createVNode","content","_cache","_ctx","$event","aria-label","_vModelSelect","classes","name","_withDirectives","type","_vModelText","_createElementBlock","onClick","_createCommentVNode","$setup","default","_withCtx","_createTextVNode","_toDisplayString","_","_Fragment","_renderList","ticket","index","data-ticket","onDblclick","ticketId","isActive","cashier","toLowerCase","USERNAME","status","notes","currency","ticketProducts","length","paymentRequest","to","params","confirmCode","Security","tag","_createBlock","_component_modal","maxWidth","show","onClose","title","onSubmit","disabled","components","Modal","Icon","JButton","setup","translate","inject","emitter","toast","store","useStore","validator","showError","validate","state","reactive","closeable","employee","form","errorBag","rules","messages","required","isProcessing","isBarcodeScanner","pos","computed","posCalls","allAtlCoins","allAltCoins","currencyLongName","altCoin","ShortName","Name","watch","newVal","oldVal","Object","keys","closeModal","generateId","tickets","Number","toString","submit","formData","isValid","splice","error","push","inputCurrency","dispatch","SAVE_TICKETS","call","data","then","message","success","catch","console","log","onBeforeMount","on","args","toRefs","__exports__","SaveTicketModal","POSLayout","swal","router","useRouter","compositionUtils","toFixed","keyword","socket","isSocketClosed","user","accountInfo","filteredTickets","filter","counter","map","trim","indexOf","a","Date","TransactionConfirmedOn","PayoutCurrencyShortName","totalAmount","product","productQuantity","productPrice","updateSelectedTicket","isRedirect","t","continueShopping","addProductsToTicket","deleteTicket","id","fire","text","icon","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","focusCancel","customClass","container","posData","products","isSelected","productIndex","productId","stock","favIndex","favourites","SAVE_PRODUCTS","ticketIndex","launchSaveTicketModal","emit","initSocket","WebSocket","onmessage","event","parts","split","merchantID","ID","FETCH_POS_DATA","onclose","users","isLoggedIn","onBeforeUnmount","close"],"mappings":"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","file":"assets/js/account-pos-tickets.18a974f2.js","sourcesContent":["<template>\r\n  <pos-layout>\r\n    <template v-slot:content>\r\n      <div class=\"card\">\r\n        <div class=\"body\">\r\n          <div class=\"flex items-center justify-end flex-col lg:flex-row mb-3\">\r\n            <div class=\"mb-4 lg:mb-0 mr-3\">\r\n              <select v-model=\"status\" aria-label=\"\" class=\"form-select w-72\">\r\n                <option value=\"\">All Tickets</option>\r\n                <option value=\"waiting\">Active</option>\r\n                <option value=\"paid\">Processed</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"mb-3 lg:mb-0 mr-3\">\r\n              <div class=\"relative flex-1\">\r\n                <icon classes=\"absolute w-5 h-5 top-3 left-3 dark:text-gray-300\" name=\"search\"></icon>\r\n                <input v-model=\"keyword\" aria-label=\"Search...\" class=\"form-input px-10 w-full\" type=\"text\"/>\r\n                <span v-if=\"keyword !== ''\" class=\"absolute top-3 right-3 dark:text-gray-400 cursor-pointer\"\r\n                      @click=\"keyword = ''\">\r\n                  <icon classes=\"w-5 h-5\" name=\"close\"></icon>\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div class=\"text-right\">\r\n              <j-button type=\"button\" @click=\"launchSaveTicketModal()\">{{ translate('pos.tickets.add') }}</j-button>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600\">\r\n            <table class=\"table-sm mb-2\">\r\n              <thead>\r\n              <tr>\r\n                <th class=\"whitespace-nowrap\">Ticket #</th>\r\n                <th class=\"whitespace-nowrap\">Name</th>\r\n                <th>Note</th>\r\n                <th>Cashier</th>\r\n                <th>Currency</th>\r\n                <th class=\"whitespace-nowrap\">Products</th>\r\n                <th class=\"whitespace-nowrap\">Total</th>\r\n                <th class=\"whitespace-nowrap\">Status</th>\r\n                <th style=\"min-width:200px;width:200px;\">Actions</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody>\r\n              <tr v-for=\"(ticket, index) in filteredTickets\" :key=\"index\" :data-ticket=\"index\"\r\n                  @dblclick=\"addProductsToTicket(ticket)\">\r\n                <td>{{ `#${ticket.ticketId}` }}</td>\r\n                <td>\r\n                  <div class=\"flex items-center\">\r\n                    <span class=\"mr-2\">{{ ticket.name }}</span>\r\n                    <span\r\n                      v-if=\"ticket.isActive === 'true' && employee && ticket.cashier.toLowerCase() === employee.USERNAME.toLowerCase()\">\r\n                      <icon classes=\"w-5 h-5 text-blue-500\" name=\"shopping-cart\"></icon>\r\n                    </span>\r\n                    <span\r\n                      v-if=\"ticket.isActive === 'false' && ticket.status !== 'paid' && employee && ticket.cashier === employee.USERNAME.toLowerCase()\"\r\n                      class=\"cursor-pointer\"\r\n                      @click=\"updateSelectedTicket(ticket)\">\r\n                      <icon classes=\"w-5 h-5 text-gray-500\" name=\"shopping-cart\"></icon>\r\n                    </span>\r\n                  </div>\r\n                </td>\r\n                <td>{{ ticket.notes }}</td>\r\n                <td>{{ ticket.cashier }}</td>\r\n                <td>{{ ticket.currency }}</td>\r\n                <td>{{ ticket.ticketProducts.length }}</td>\r\n                <td>{{ totalAmount(ticket) + ' ' + currency }}\r\n                </td>\r\n                <td> {{ticket.status}} </td>\r\n                <td class=\"pr-3\">\r\n                  <router-link v-if=\"ticket.status === 'inprogress' && ticket.paymentRequest !== null\"\r\n                               v-tippy=\"'View Invoice'\"\r\n                               :to=\"{name: 'account-pos-invoice', params: { confirmCode: ticket.paymentRequest.Security }}\"\r\n                               class=\"hover:text-blue-500 mr-2 inline-block\" tag=\"a\">\r\n                    <icon name=\"clock\"></icon>\r\n                  </router-link>\r\n                  <router-link :to=\"{name: 'account-pos-ticket', params: { ticketId: ticket.ticketId }}\"\r\n                               v-tippy=\"'View Detail'\"\r\n                               class=\"hover:text-green-500 mr-2 inline-block\" tag=\"a\">\r\n                    <icon name=\"eye\"></icon>\r\n                  </router-link>\r\n                  <template v-if=\"employee && employee.USERNAME.toLowerCase() === ticket.cashier.toLowerCase()\">\r\n                    <button v-if=\"ticket.status !== 'paid'\" class=\"hover:text-green-500 mr-2\"\r\n                            v-tippy=\"'Add Product(s)'\" @click=\"continueShopping(ticket)\">\r\n                      <icon name=\"plus-circle\"></icon>\r\n                    </button>\r\n\r\n                    <template v-if=\"employee && ticket.status !== 'paid'\">\r\n                      <button class=\"hover:text-green-500 mr-2\" v-tippy=\"'Update Ticket'\"\r\n                              @click=\"launchSaveTicketModal(ticket)\">\r\n                        <icon name=\"edit\"></icon>\r\n                      </button>\r\n                      <button class=\"hover:text-red-500\" v-tippy=\"'Delete Ticket'\"\r\n                              @click=\"deleteTicket(ticket.ticketId)\">\r\n                        <icon name=\"trash\"></icon>\r\n                      </button>\r\n                    </template>\r\n\r\n                  </template>\r\n                </td>\r\n              </tr>\r\n              <tr v-if=\"filteredTickets.length === 0\">\r\n                <td colspan=\"8\">No ticket available</td>\r\n              </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </template>\r\n  </pos-layout>\r\n  <!-- Save Ticket -->\r\n  <save-ticket-modal></save-ticket-modal>\r\n</template>\r\n\r\n<script>\r\nimport POSLayout from '@/components/layouts/POSLayout'\r\nimport JButton from '@/templates/Button'\r\nimport Icon from '@/components/Icon'\r\nimport SaveTicketModal from '@/components/account/pos/modals/tickets/SaveTicketModal'\r\nimport { computed, inject, onBeforeMount, onBeforeUnmount, reactive, toRefs } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport * as _ from 'lodash'\r\nimport compositionUtils from '@/compositionUtils'\r\nimport { FETCH_POS_DATA, SAVE_PRODUCTS, SAVE_TICKETS } from '@/store/keys'\r\nimport { useRouter } from 'vue-router'\r\n\r\nexport default {\r\n  name: 'Tickets',\r\n  components: {\r\n    SaveTicketModal,\r\n    'pos-layout': POSLayout,\r\n    JButton,\r\n    Icon\r\n  },\r\n  setup () {\r\n    const translate = inject('translate')\r\n    const swal = inject('swal')\r\n    const toast = inject('toast')\r\n    const emitter = inject('emitter')\r\n\r\n    const store = useStore()\r\n    const router = useRouter()\r\n\r\n    const { toFixed } = compositionUtils()\r\n\r\n    // Status\r\n    const state = reactive({\r\n      status: 'waiting',\r\n      keyword: '',\r\n      employee: null,\r\n      socket: null,\r\n      isSocketClosed: false\r\n    })\r\n\r\n    // Computed\r\n    const user = computed(() => store.state.user)\r\n    const accountInfo = computed(() => store.state.accountInfo)\r\n    const pos = computed(() => store.state.pos)\r\n    const posCalls = computed(() => store.state.posCalls)\r\n    const filteredTickets = computed(() => {\r\n      let tickets = []\r\n      if (state.employee) {\r\n        tickets = pos.value.tickets.filter(ticket => ticket.isActive === 'true' && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase())\r\n      }\r\n      if (tickets.length > 1) {\r\n        let counter = 0\r\n        pos.value.tickets.map(ticket => {\r\n          if (ticket.isActive === 'true') {\r\n            if (ticket.status === 'paid') {\r\n              ticket.isActive = 'false'\r\n            } else {\r\n              counter++\r\n            }\r\n          }\r\n          if (counter > 1) {\r\n            ticket.isActive = 'false'\r\n          }\r\n          return ticket\r\n        })\r\n        if (counter > 1) {\r\n          store.dispatch(SAVE_TICKETS, {\r\n            call: posCalls.value.tickets,\r\n            data: pos.value.tickets\r\n          })\r\n        }\r\n      }\r\n      if (state.keyword && state.status) {\r\n        const keyword = state.keyword.trim().toLowerCase()\r\n        tickets = pos.value.tickets.filter(ticket => {\r\n          if (state.status.toString() === 'waiting') {\r\n            return (typeof ticket.status === 'undefined' || ['waiting', 'inprogress'].indexOf(ticket.status.toLowerCase()) !== -1) &&\r\n              (_.includes(ticket.name.toLowerCase(), keyword) ||\r\n                _.includes(ticket.notes.toLowerCase(), keyword)\r\n              ) && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          } else {\r\n            return ticket.status && ticket.status.toString() === state.status.toString() && (_.includes(ticket.name.toLowerCase(), keyword) ||\r\n              _.includes(ticket.notes.toLowerCase(), keyword)\r\n            ) && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          }\r\n        })\r\n      } else if (state.keyword) {\r\n        const keyword = state.keyword.trim().toLowerCase()\r\n        tickets = pos.value.tickets.filter(ticket => {\r\n          return (_.includes(ticket.name.toLowerCase(), keyword) ||\r\n            _.includes(ticket.notes.toLowerCase(), keyword)\r\n          )\r\n        })\r\n      } else if (state.status) {\r\n        tickets = pos.value.tickets.filter(ticket => {\r\n          if (state.status.toString() === 'waiting') {\r\n            return (typeof ticket.status === 'undefined' ||\r\n                ['waiting', 'inprogress'].indexOf(ticket.status.toLowerCase()) !== -1) &&\r\n              ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          } else {\r\n            return ticket.status && ticket.status.toString() === state.status.toString() &&\r\n              ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          }\r\n        })\r\n      } else {\r\n        tickets = pos.value.tickets\r\n      }\r\n      // return _.orderBy(tickets, 'isActive', 'desc')\r\n      return _.orderBy(tickets, [(a) => {\r\n        return new Date(a.paymentRequest.TransactionConfirmedOn)\r\n      }, 'isActive'], ['desc', 'desc'])\r\n    })\r\n    \r\n\r\n    const currency = computed(() => {\r\n      return accountInfo.value ? accountInfo.value.PayoutCurrencyShortName : 'EUR'\r\n    })\r\n\r\n    // Methods\r\n    const totalAmount = (ticket) => {\r\n      let totalAmount = 0\r\n      ticket.ticketProducts.map(product => {\r\n        totalAmount = Number(totalAmount) + Number(product.productQuantity) * Number(product.productPrice)\r\n      })\r\n      return toFixed(totalAmount)\r\n    }\r\n    const updateSelectedTicket = (ticket, isRedirect = false) => {\r\n      const tickets = _.cloneDeep(pos.value.tickets)\r\n      if (state.employee && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()) {\r\n        tickets.map(t => {\r\n          if (t.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()) {\r\n            t.isActive = t.ticketId.toString() === ticket.ticketId.toString() && t.status !== 'paid' ? 'true' : 'false'\r\n          }\r\n        })\r\n        store.dispatch(SAVE_TICKETS, {\r\n          call: posCalls.value.tickets,\r\n          data: tickets\r\n        })\r\n        toast.success('Ticket selected successfully')\r\n        if (isRedirect) {\r\n          router.push({ name: 'account-pos-products' })\r\n        }\r\n      }\r\n    }\r\n    const continueShopping = (ticket) => {\r\n      // this.index = null\r\n      updateSelectedTicket(ticket, true)\r\n    }\r\n    const addProductsToTicket = (ticket) => {\r\n      if (ticket.status !== 'paid' && state.employee && state.employee.USERNAME.toLowerCase() === ticket.cashier.toLowerCase()) {\r\n        continueShopping(ticket)\r\n      }\r\n    }\r\n    const deleteTicket = (id) => {\r\n      const index = _.findIndex(pos.value.tickets, { ticketId: id })\r\n      if (index !== -1) {\r\n        swal.fire({\r\n          title: 'Ticket',\r\n          text: 'Are you sure, want to delete this ticket?',\r\n          icon: 'warning',\r\n          showCancelButton: true,\r\n          confirmButtonColor: '#d33',\r\n          confirmButtonText: 'Yes',\r\n          cancelButtonText: 'No',\r\n          focusCancel: true,\r\n          customClass: {\r\n            container: 'swal2-tailwind'\r\n          }\r\n        }).then(({ value }) => {\r\n          if (value && value === true) {\r\n            const posData = _.cloneDeep(pos.value)\r\n            const tickets = posData.tickets\r\n            const ticket = tickets[index]\r\n            const products = posData.products\r\n            const isSelected = ticket.isActive\r\n            if (ticket.ticketProducts.length > 0) {\r\n              ticket.ticketProducts.map(product => {\r\n                const productIndex = _.findIndex(products, { id: product.productId })\r\n                if (productIndex !== -1) {\r\n                  products[productIndex].stock =\r\n                    Number(products[productIndex].stock) +\r\n                    Number(product.productQuantity)\r\n                }\r\n                const favIndex = _.findIndex(posData.favourites, { id: product.productId })\r\n                if (favIndex !== -1) {\r\n                  posData.favourites[favIndex].stock =\r\n                    Number(posData.favourites[favIndex].stock) + Number(product.productQuantity)\r\n                }\r\n              })\r\n            }\r\n            store.dispatch(SAVE_PRODUCTS, {\r\n              call: posCalls.value.products,\r\n              data: products\r\n            })\r\n            posData.products = products\r\n            tickets.splice(index, 1)\r\n            posData.tickets = tickets\r\n            if (isSelected === 'true' && posData.tickets.length > 0) {\r\n              const ticketIndex = _.findIndex(posData.tickets, (ticket) => {\r\n                return (ticket.status.toLowerCase() === 'waiting' || ticket.status.toLowerCase() === 'inprogress') &&\r\n                  ticket.cashier === state.employee.USERNAME.toLowerCase()\r\n              })\r\n              if (ticketIndex !== -1) {\r\n                posData.tickets[ticketIndex].isActive = 'true'\r\n              }\r\n            }\r\n            store.dispatch(SAVE_TICKETS, {\r\n              call: posCalls.value.tickets,\r\n              data: posData.tickets\r\n            })\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    const launchSaveTicketModal = (ticket = null) => {\r\n      emitter.emit('saveTicketModal', {\r\n        currency: currency.value,\r\n        employee: state.employee,\r\n        ticket: ticket\r\n      })\r\n    }\r\n\r\n    const initSocket = () => {\r\n      state.socket = new WebSocket('wss://wss.cointopay.com/transactions')\r\n      state.socket.onmessage = (event) => {\r\n        if (event && event.data) {\r\n          const parts = event.data.split(':')\r\n          if (parts[0].toLowerCase() === 'pos') {\r\n            const merchantID = parts[1]\r\n            if (user.value && merchantID.toString() === user.value.ID.toString()) {\r\n              store.dispatch(FETCH_POS_DATA, {})\r\n            }\r\n          }\r\n        }\r\n      }\r\n      state.socket.onclose = (event) => {\r\n        if (!state.isSocketClosed) {\r\n          initSocket()\r\n        }\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      state.employee = _.find(pos.value.users, { isLoggedIn: 'true' })\r\n      initSocket()\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      state.isSocketClosed = true\r\n      if (state.socket) {\r\n        state.socket.close()\r\n      }\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      filteredTickets,\r\n      currency,\r\n      totalAmount,\r\n      continueShopping,\r\n      updateSelectedTicket,\r\n      addProductsToTicket,\r\n      deleteTicket,\r\n      launchSaveTicketModal\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.table-sm {\r\n  thead {\r\n    tr {\r\n      th:first-child {\r\n        @apply pl-3;\r\n      }\r\n    }\r\n  }\r\n\r\n  tbody {\r\n    tr {\r\n      td:first-child {\r\n        @apply pl-3;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <modal :maxWidth=\"maxWidth\" :show=\"show\" @close=\"closeModal()\">\r\n    <template #title>\r\n      <div class=\"flex items-center justify-between\">\r\n        <span>{{ form.name == '' ? translate('pos.products.title') : translate('pos.products.titleupdate') }}</span>\r\n        <span class=\"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer\"\r\n              @click=\"closeModal()\">\r\n          <icon name=\"close\"></icon>\r\n        </span>\r\n      </div>\r\n    </template>\r\n    <template #content>\r\n      <form @submit.prevent=\"submit()\">\r\n        <div class=\"mb-2\">\r\n          <div class=\"flex items-center justify-between mb-1\">\r\n            <label>{{ translate('pos.tickets.name') }}</label>\r\n            <div class=\"text-red-700 dark:text-red-400 text-sm\">{{ showError(errorBag, 'name') }}</div>\r\n          </div>\r\n          <input v-model=\"form.name\" class=\"form-input w-full\" type=\"text\"/>\r\n        </div>\r\n        <div class=\"mb-2\">\r\n          <div class=\"flex items-center justify-between mb-1\">\r\n            <label>{{ translate('pos.tickets.note') }}</label>\r\n            <div class=\"text-red-700 dark:text-red-400 text-sm\">{{ showError(errorBag, 'notes') }}</div>\r\n          </div>\r\n          <input v-model=\"form.notes\" class=\"form-input w-full\" type=\"text\"/>\r\n        </div>\r\n\r\n        <div class=\"mt-4 text-right\">\r\n          <j-button :disabled=\"isProcessing\">\r\n            <div v-if=\"isProcessing\" class=\"mr-3\">\r\n              <icon :name=\"'spinner'\" classes=\"w-4 h-4 text-white\"></icon>\r\n            </div>\r\n            <span>{{ translate('pos.products.btn_save') }}</span>\r\n          </j-button>\r\n        </div>\r\n      </form>\r\n    </template>\r\n  </modal>\r\n</template>\r\n\r\n<script>\r\nimport Modal from '@/components/Modal'\r\nimport Icon from '@/components/Icon'\r\nimport JButton from '@/templates/Button'\r\nimport { computed, inject, onBeforeMount, reactive, toRefs, watch } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport validator from '@/validator'\r\nimport * as _ from 'lodash'\r\nimport { SAVE_TICKETS } from '@/store/keys'\r\n\r\nexport default {\r\n  name: 'SaveTicketModal',\r\n  components: {\r\n    Modal,\r\n    Icon,\r\n    JButton\r\n  },\r\n  setup () {\r\n    // Providers\r\n    const translate = inject('translate')\r\n    const emitter = inject('emitter')\r\n    const toast = inject('toast')\r\n\r\n    // Store\r\n    const store = useStore()\r\n\r\n    const {\r\n      showError,\r\n      validate\r\n    } = validator()\r\n\r\n    // State\r\n    const state = reactive({\r\n      show: false,\r\n      maxWidth: '2xl',\r\n      closeable: true,\r\n      ticket: null,\r\n      currency: 'EUR',\r\n      employee: null,\r\n      form: {\r\n        name: '',\r\n        notes: ''\r\n      },\r\n      errorBag: {},\r\n      rules: {\r\n        name: ['required']\r\n      },\r\n      messages: {\r\n        name: {\r\n          required: 'Ticket name is required'\r\n        }\r\n      },\r\n      isProcessing: false,\r\n      isBarcodeScanner: false\r\n    })\r\n\r\n    // Computed\r\n    const pos = computed(() => store.state.pos)\r\n    const posCalls = computed(() => store.state.posCalls)\r\n    const allAtlCoins = computed(() => store.state.allAltCoins)\r\n    const currencyLongName = computed(() => {\r\n      const altCoin = _.find(allAtlCoins.value, { ShortName: state.currency })\r\n      return altCoin ? altCoin.Name : ''\r\n    })\r\n\r\n    // Watch\r\n    watch(() => ({ ...state.form }),\r\n      (newVal, oldVal) => {\r\n        if (Object.keys(state.errorBag).length > 0) {\r\n          state.errorBag = validate(state.form, state.rules, state.messages)\r\n        }\r\n      })\r\n\r\n    // Methods\r\n    const closeModal = () => {\r\n      state.show = false\r\n    }\r\n    const generateId = () => {\r\n      const tickets = _.cloneDeep(pos.value.tickets)\r\n      if (tickets.length > 0) {\r\n        const ticket = _.maxBy(tickets, ticket => {\r\n          return Number(ticket.ticketId)\r\n        })\r\n        return (Number(ticket.ticketId) + 1).toString()\r\n      }\r\n      return '1'\r\n    }\r\n    // Create or Update Product\r\n    const submit = () => {\r\n      state.errorBag = validate(state.form, state.rules, state.messages)\r\n      if (Object.keys(state.errorBag).length === 0) {\r\n        state.isProcessing = true\r\n        const formData = state.form\r\n        const tickets = _.cloneDeep(pos.value.tickets)\r\n        let isValid = true\r\n        if (state.ticket) {\r\n          let index = _.findIndex(tickets, ticket => {\r\n            return (ticket.name === formData.name && state.ticket.ticketId !== ticket.ticketId)\r\n          })\r\n          if (index === -1) {\r\n            index = _.findIndex(tickets, { ticketId: state.ticket.ticketId })\r\n            tickets.splice(index, 1, {\r\n              ...state.ticket,\r\n              name: formData.name,\r\n              notes: formData.notes\r\n            })\r\n          } else {\r\n            isValid = false\r\n            state.isProcessing = false\r\n            toast.error('Ticket name already exists!')\r\n          }\r\n        } else {\r\n          if (_.findIndex(tickets, { name: formData.name }) === -1) {\r\n            tickets.push({\r\n              ticketId: generateId(),\r\n              status: 'waiting',\r\n              notes: formData.notes,\r\n              name: formData.name,\r\n              isActive: 'true',\r\n              cashier: state.employee.USERNAME.toLowerCase(),\r\n              currency: currencyLongName.value,\r\n              inputCurrency: state.currency,\r\n              ticketProducts: [],\r\n              paymentRequest: null\r\n            })\r\n          } else {\r\n            isValid = false\r\n            state.isProcessing = false\r\n            toast.error('Product with this sku already exists!')\r\n          }\r\n        }\r\n        if (isValid) {\r\n          store.dispatch(SAVE_TICKETS, {\r\n            call: posCalls.value.tickets,\r\n            data: tickets\r\n          }).then(() => {\r\n            state.isProcessing = false\r\n            const message = state.ticket ? 'Ticket updated successfully' : 'Ticket added successfully'\r\n            toast.success(message)\r\n            closeModal()\r\n          }).catch(error => {\r\n            console.log(error)\r\n            state.isProcessing = false\r\n            toast.error('Internal Server Error')\r\n          })\r\n        }\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      emitter.on('saveTicketModal', (args) => {\r\n        state.currency = args.currency\r\n        state.employee = args.employee\r\n        state.ticket = args.ticket || null\r\n        state.form = {\r\n          name: state.ticket ? state.ticket.name : '',\r\n          notes: state.ticket ? state.ticket.notes : ''\r\n        }\r\n        state.show = true\r\n      })\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      showError,\r\n      closeModal,\r\n      submit\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","import { render } from \"./SaveTicketModal.vue?vue&type=template&id=591afd86\"\nimport script from \"./SaveTicketModal.vue?vue&type=script&lang=js\"\nexport * from \"./SaveTicketModal.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\TRS 37\\\\Desktop\\\\Zeeshan\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Tickets.vue?vue&type=template&id=0a8eae0f&scoped=true\"\nimport script from \"./Tickets.vue?vue&type=script&lang=js\"\nexport * from \"./Tickets.vue?vue&type=script&lang=js\"\n\nimport \"./Tickets.vue?vue&type=style&index=0&id=0a8eae0f&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\TRS 37\\\\Desktop\\\\Zeeshan\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-0a8eae0f\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Tickets.vue?vue&type=style&index=0&id=0a8eae0f&lang=scss&scoped=true\""],"sourceRoot":""}