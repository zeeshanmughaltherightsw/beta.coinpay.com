"use strict";(self["webpackChunkcointopay"]=self["webpackChunkcointopay"]||[]).push([[90],{9254:function(e,t,s){s.r(t),s.d(t,{default:function(){return x}});var a=s(821);const o={key:0,class:"text-center"},r={class:"font-bold text-green-500 mb-4"},n={class:"w-full md:w-3/5 mx-auto mb-3"},c={class:"flex items-center mb-1"},l={style:{"flex-grow":"1"}},i=["placeholder"],m=["disabled"],u={key:0,class:"mr-3"},p={class:"text-blue-500 text-sm text-left"},d=(0,a.createTextVNode)(" Create New Order ");function f(e,t,s,f,v,k){const h=(0,a.resolveComponent)("icon"),g=(0,a.resolveComponent)("routerLink"),b=(0,a.resolveComponent)("pos-layout");return(0,a.openBlock)(),(0,a.createBlock)(b,null,{content:(0,a.withCtx)((()=>[e.ticket&&e.ticket.paymentRequest?((0,a.openBlock)(),(0,a.createElementBlock)("div",o,[(0,a.createVNode)(h,{name:"check-circle",classes:"w-24 h-24 text-green-500 mx-auto"}),(0,a.createElementVNode)("p",r," Invoice #"+(0,a.toDisplayString)(e.ticket.paymentRequest.TransactionID)+" has been paid successfully! ",1),(0,a.createElementVNode)("div",n,[(0,a.createElementVNode)("form",{onSubmit:t[1]||(t[1]=(0,a.withModifiers)((e=>f.submit()),["prevent"]))},[(0,a.createElementVNode)("div",c,[(0,a.createElementVNode)("div",l,[(0,a.withDirectives)((0,a.createElementVNode)("input",{placeholder:f.translate("pos.receipts.email"),"aria-label":"Email",class:"form-input w-full",type:"email","onUpdate:modelValue":t[0]||(t[0]=t=>e.form.email=t)},null,8,i),[[a.vModelText,e.form.email]])]),(0,a.createElementVNode)("button",{disabled:e.isProcessing,class:"btn btn-success ml-3"},[e.isProcessing?((0,a.openBlock)(),(0,a.createElementBlock)("span",u,[(0,a.createVNode)(h,{name:"spinner",classes:"w-4 h-4 text-white"})])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("span",null,(0,a.toDisplayString)(f.translate("pos.receipts.btn_send_receipt")),1)],8,m)])],32),(0,a.createElementVNode)("div",p,(0,a.toDisplayString)(f.showError(e.errorBag,"email")),1)]),(0,a.createVNode)(g,{class:"btn btn-primary",tag:"a",to:{name:"account-pos-products"}},{default:(0,a.withCtx)((()=>[d])),_:1})])):(0,a.createCommentVNode)("",!0)])),_:1})}var v=s(2630),k=s(7983),h=s(2119),g=s(8637),b=s(6232),y=s(6486),E=s(381),I=s.n(E),w={name:"Success",components:{"pos-layout":v.Z,Icon:k.Z},setup(){const e=(0,a.inject)("translate"),t=(0,a.inject)("http"),s=(0,a.inject)("toast"),o=(0,g.oR)(),r=(0,h.yj)(),n=(0,h.tv)(),{showError:c,validate:l}=(0,b.Z)(),i=(0,a.reactive)({ticket:null,form:{email:""},errorBag:{},rules:{email:["required","email"]},messages:{email:{required:"Email address is required",email:"Please provide a valid email address"}},isProcessing:!1}),m=(0,a.computed)((()=>o.state.user)),u=(0,a.computed)((()=>o.state.pos)),p=(0,a.computed)((()=>{const e=y.find(u.value.receipts,(e=>e.TICKETNUMBER===i.ticket.ticketId.toString()));return e&&(e.items=u.value.receiptItems.filter((t=>t.RECIEPT_ID===e.ID))),e}));(0,a.watch)((()=>({...i.form})),((e,t)=>{Object.keys(i.errorBag).length>0&&(i.errorBag=l(e,i.rules,i.messages))}));const d="https://app.cointopay.com",f=()=>{if(i.errorBag=l(i.form,i.rules,i.messages),0===Object.keys(i.errorBag).length&&p.value){i.isProcessing=!0;const e={"Receipt ID":p.value.ID,Time:I()(new Date(Number(p.value.DATE))).format("DD/MM/YYYY H:mm A"),"Total Amount":p.value.TOTAL+" "+p.value.CURRENCY,Cashier:p.value.CASHIER,Items:p.value.items},a={Call:"POSRECEIPT",MerchantID:Number(m.value.ID),APIKey:m.value.APIKey,email:i.form.email,ticketData:JSON.stringify(e),output:"json"},o=e=>Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&");t.post(`${d}/v2REAPI`,o(a),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{i.isProcessing=!1,e.data&&(i.form.email="",s.success("Receipt sent successfully")),n.push({name:"account-pos-products"})})).catch((e=>{i.isProcessing=!1,console.log(e)}))}};return(0,a.onBeforeMount)((()=>{Object.keys(r.params).length>0&&r.params.ticketId&&(i.ticket=y.find(u.value.tickets,{ticketId:r.params.ticketId}))})),{translate:e,...(0,a.toRefs)(i),showError:c,submit:f}}},C=s(3744);const N=(0,C.Z)(w,[["render",f]]);var x=N}}]);
//# sourceMappingURL=account-pos-invoice-success.74b3d9ef.js.map