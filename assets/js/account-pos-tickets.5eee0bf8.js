(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["account-pos-tickets"],{"154e":function(e,t,c){"use strict";c.r(t);c("b0c0");var o=c("f2bf"),n=function(e){return Object(o["pushScopeId"])("data-v-4733e418"),e=e(),Object(o["popScopeId"])(),e},r={class:"card"},a={class:"body"},s={class:"flex items-center justify-end flex-col lg:flex-row mb-3"},i={class:"mb-4 lg:mb-0 mr-3"},l=n((function(){return Object(o["createElementVNode"])("option",{value:""},"All Tickets",-1)})),u=n((function(){return Object(o["createElementVNode"])("option",{value:"waiting"},"Active",-1)})),d=n((function(){return Object(o["createElementVNode"])("option",{value:"paid"},"Processed",-1)})),m=[l,u,d],b={class:"mb-3 lg:mb-0 mr-3"},p={class:"relative flex-1"},j={class:"text-right"},O={class:"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},k={class:"table-sm mb-2"},f=n((function(){return Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{class:"whitespace-nowrap"},"Ticket Number"),Object(o["createElementVNode"])("th",{class:"whitespace-nowrap"},"Ticket Name"),Object(o["createElementVNode"])("th",null,"Note"),Object(o["createElementVNode"])("th",null,"Cashier"),Object(o["createElementVNode"])("th",null,"Currency"),Object(o["createElementVNode"])("th",{class:"whitespace-nowrap"},"Total Products"),Object(o["createElementVNode"])("th",{class:"whitespace-nowrap"},"Total Amount"),Object(o["createElementVNode"])("th",{style:{"min-width":"200px",width:"200px"}},"Actions")])],-1)})),v=["data-ticket","onDblclick"],w={class:"flex items-center"},h={class:"mr-2"},y={key:0},N=["onClick"],g={class:"pr-3"},E=["onClick"],C=["onClick"],V=["onClick"],x={key:0},S=n((function(){return Object(o["createElementVNode"])("td",{colspan:"8"},"No ticket available",-1)})),B=[S];function L(e,t,c,n,l,u){var d=Object(o["resolveComponent"])("icon"),S=Object(o["resolveComponent"])("j-button"),L=Object(o["resolveComponent"])("router-link"),T=Object(o["resolveComponent"])("pos-layout"),A=Object(o["resolveComponent"])("save-ticket-modal"),D=Object(o["resolveDirective"])("tippy");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createVNode"])(T,null,{content:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",r,[Object(o["createElementVNode"])("div",a,[Object(o["createElementVNode"])("div",s,[Object(o["createElementVNode"])("div",i,[Object(o["withDirectives"])(Object(o["createElementVNode"])("select",{"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.status=t}),"aria-label":"",class:"form-select w-72"},m,512),[[o["vModelSelect"],e.status]])]),Object(o["createElementVNode"])("div",b,[Object(o["createElementVNode"])("div",p,[Object(o["createVNode"])(d,{classes:"absolute w-5 h-5 top-3 left-3 dark:text-gray-300",name:"search"}),Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.keyword=t}),"aria-label":"Search...",class:"form-input px-10 w-full",type:"text"},null,512),[[o["vModelText"],e.keyword]]),""!==e.keyword?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:"absolute top-3 right-3 dark:text-gray-400 cursor-pointer",onClick:t[2]||(t[2]=function(t){return e.keyword=""})},[Object(o["createVNode"])(d,{classes:"w-5 h-5",name:"close"})])):Object(o["createCommentVNode"])("",!0)])]),Object(o["createElementVNode"])("div",j,[Object(o["createVNode"])(S,{type:"button",onClick:t[3]||(t[3]=function(e){return n.launchSaveTicketModal()})},{default:Object(o["withCtx"])((function(){return[Object(o["createTextVNode"])(Object(o["toDisplayString"])(n.translate("pos.tickets.add")),1)]})),_:1})])]),Object(o["createElementVNode"])("div",O,[Object(o["createElementVNode"])("table",k,[f,Object(o["createElementVNode"])("tbody",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(n.filteredTickets,(function(t,c){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{key:c,"data-ticket":c,onDblclick:function(e){return n.addProductsToTicket(t)}},[Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])("#".concat(t.ticketId)),1),Object(o["createElementVNode"])("td",null,[Object(o["createElementVNode"])("div",w,[Object(o["createElementVNode"])("span",h,Object(o["toDisplayString"])(t.name),1),"true"===t.isActive&&e.employee&&t.cashier.toLowerCase()===e.employee.USERNAME.toLowerCase()?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",y,[Object(o["createVNode"])(d,{classes:"w-5 h-5 text-blue-500",name:"shopping-cart"})])):Object(o["createCommentVNode"])("",!0),"false"===t.isActive&&"paid"!==t.status&&e.employee&&t.cashier===e.employee.USERNAME.toLowerCase()?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:1,class:"cursor-pointer",onClick:function(e){return n.updateSelectedTicket(t)}},[Object(o["createVNode"])(d,{classes:"w-5 h-5 text-gray-500",name:"shopping-cart"})],8,N)):Object(o["createCommentVNode"])("",!0)])]),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(t.notes),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(t.cashier),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(t.currency),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(t.ticketProducts.length),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(n.totalAmount(t)+" "+n.currency),1),Object(o["createElementVNode"])("td",g,["inprogress"===t.status&&null!==t.paymentRequest?Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createBlock"])(L,{key:0,to:{name:"account-pos-invoice",params:{confirmCode:t.paymentRequest.Security}},class:"hover:text-blue-500 mr-2 inline-block",tag:"a"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(d,{name:"clock"})]})),_:2},1032,["to"])),[[D,"View Invoice"]]):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createBlock"])(L,{to:{name:"account-pos-ticket",params:{ticketId:t.ticketId}},class:"hover:text-green-500 mr-2 inline-block",tag:"a"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(d,{name:"eye"})]})),_:2},1032,["to"])),[[D,"View Detail"]]),e.employee&&e.employee.USERNAME.toLowerCase()===t.cashier.toLowerCase()?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:1},["paid"!==t.status?Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:0,class:"hover:text-green-500 mr-2",onClick:function(e){return n.continueShopping(t)}},[Object(o["createVNode"])(d,{name:"plus-circle"})],8,E)),[[D,"Add Product(s)"]]):Object(o["createCommentVNode"])("",!0),e.employee&&"paid"!==t.status?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:1},[Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{class:"hover:text-green-500 mr-2",onClick:function(e){return n.launchSaveTicketModal(t)}},[Object(o["createVNode"])(d,{name:"edit"})],8,C)),[[D,"Update Ticket"]]),Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{class:"hover:text-red-500",onClick:function(e){return n.deleteTicket(t.ticketId)}},[Object(o["createVNode"])(d,{name:"trash"})],8,V)),[[D,"Delete Ticket"]])],64)):Object(o["createCommentVNode"])("",!0)],64)):Object(o["createCommentVNode"])("",!0)])],40,v)})),128)),0===n.filteredTickets.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",x,B)):Object(o["createCommentVNode"])("",!0)])])])])])]})),_:1}),Object(o["createVNode"])(A)],64)}var T=c("5530"),A=(c("b680"),c("4de4"),c("d3b7"),c("d81d"),c("498a"),c("25f0"),c("a9e3"),c("a434"),c("ac1f"),c("1276"),c("66c3")),D=c("4032"),I=c("cdae"),M={class:"flex items-center justify-between"},P={class:"mb-2"},U={class:"flex items-center justify-between mb-1"},R={class:"text-red-700 dark:text-red-400 text-sm"},_={class:"mb-2"},q={class:"flex items-center justify-between mb-1"},F={class:"text-red-700 dark:text-red-400 text-sm"},W={class:"mt-4 text-right"},z={key:0,class:"mr-3"};function J(e,t,c,n,r,a){var s=Object(o["resolveComponent"])("icon"),i=Object(o["resolveComponent"])("j-button"),l=Object(o["resolveComponent"])("modal");return Object(o["openBlock"])(),Object(o["createBlock"])(l,{maxWidth:e.maxWidth,show:e.show,onClose:t[4]||(t[4]=function(e){return n.closeModal()})},{title:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("div",M,[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(n.translate("pos.products.title")),1),Object(o["createElementVNode"])("span",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer",onClick:t[0]||(t[0]=function(e){return n.closeModal()})},[Object(o["createVNode"])(s,{name:"close"})])])]})),content:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(o["withModifiers"])((function(e){return n.submit()}),["prevent"]))},[Object(o["createElementVNode"])("div",P,[Object(o["createElementVNode"])("div",U,[Object(o["createElementVNode"])("label",null,Object(o["toDisplayString"])(n.translate("pos.tickets.name")),1),Object(o["createElementVNode"])("div",R,Object(o["toDisplayString"])(n.showError(e.errorBag,"name")),1)]),Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.form.name=t}),class:"form-input w-full",type:"text"},null,512),[[o["vModelText"],e.form.name]])]),Object(o["createElementVNode"])("div",_,[Object(o["createElementVNode"])("div",q,[Object(o["createElementVNode"])("label",null,Object(o["toDisplayString"])(n.translate("pos.tickets.note")),1),Object(o["createElementVNode"])("div",F,Object(o["toDisplayString"])(n.showError(e.errorBag,"notes")),1)]),Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.form.notes=t}),class:"form-input w-full",type:"text"},null,512),[[o["vModelText"],e.form.notes]])]),Object(o["createElementVNode"])("div",W,[Object(o["createVNode"])(i,{disabled:e.isProcessing},{default:Object(o["withCtx"])((function(){return[e.isProcessing?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",z,[Object(o["createVNode"])(s,{name:"spinner",classes:"w-4 h-4 text-white"})])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(n.translate("pos.products.btn_save")),1)]})),_:1},8,["disabled"])])],32)]})),_:1},8,["maxWidth","show"])}c("b64b");var Q=c("714b"),Y=c("5502"),G=c("ea45"),H=c("2ef0"),K=c("8923"),X={name:"SaveTicketModal",components:{Modal:Q["a"],Icon:I["a"],JButton:D["a"]},setup:function(){var e=Object(o["inject"])("translate"),t=Object(o["inject"])("emitter"),c=Object(o["inject"])("toast"),n=Object(Y["b"])(),r=Object(G["a"])(),a=r.showError,s=r.validate,i=Object(o["reactive"])({show:!1,maxWidth:"2xl",closeable:!0,ticket:null,currency:"EUR",employee:null,form:{name:"",notes:""},errorBag:{},rules:{name:["required"]},messages:{name:{required:"Ticket name is required"}},isProcessing:!1,isBarcodeScanner:!1}),l=Object(o["computed"])((function(){return n.state.pos})),u=Object(o["computed"])((function(){return n.state.posCalls})),d=Object(o["computed"])((function(){return n.state.allAltCoins})),m=Object(o["computed"])((function(){var e=H["find"](d.value,{ShortName:i.currency});return e?e.Name:""}));Object(o["watch"])((function(){return Object(T["a"])({},i.form)}),(function(e,t){Object.keys(i.errorBag).length>0&&(i.errorBag=s(i.form,i.rules,i.messages))}));var b=function(){i.show=!1},p=function(){var e=H["cloneDeep"](l.value.tickets);if(e.length>0){var t=H["maxBy"](e,(function(e){return Number(e.id)}));return(Number(t.id)+1).toString()}return"1"},j=function(){if(i.errorBag=s(i.form,i.rules,i.messages),0===Object.keys(i.errorBag).length){i.isProcessing=!0;var e=i.form,t=H["cloneDeep"](l.value.tickets),o=!0;if(i.ticket){var r=H["findIndex"](t,(function(t){return t.name===e.name&&i.ticket.ticketId!==t.ticketId}));-1===r?(r=H["findIndex"](t,{ticketId:i.ticket.ticketId}),t.splice(r,1,Object(T["a"])(Object(T["a"])({},i.ticket),{},{name:e.name,notes:e.notes}))):(o=!1,i.isProcessing=!1,c.error("Ticket name already exists!"))}else-1===H["findIndex"](t,{name:e.name})?t.push({ticketId:p(),status:"waiting",notes:e.notes,name:e.name,isActive:"true",cashier:i.employee.USERNAME.toLowerCase(),currency:m.value,inputCurrency:i.currency,ticketProducts:[],paymentRequest:null}):(o=!1,i.isProcessing=!1,c.error("Product with this sku already exists!"));o&&n.dispatch(K["z"],{call:u.value.tickets,data:t}).then((function(){i.isProcessing=!1;var e=i.ticket?"Ticket updated successfully":"Ticket added successfully";c.success(e),b()})).catch((function(e){console.log(e),i.isProcessing=!1,c.error("Internal Server Error")}))}};return Object(o["onBeforeMount"])((function(){t.on("saveTicketModal",(function(e){i.currency=e.currency,i.employee=e.employee,i.ticket=e.ticket||null,i.form={name:i.ticket?i.ticket.name:"",notes:i.ticket?i.ticket.notes:""},i.show=!0}))})),Object(T["a"])(Object(T["a"])({translate:e},Object(o["toRefs"])(i)),{},{showError:a,closeModal:b,submit:j})}},Z=c("6b0d"),$=c.n(Z);const ee=$()(X,[["render",J]]);var te=ee,ce=c("2e13"),oe=c("6c02"),ne={name:"Tickets",components:{SaveTicketModal:te,"pos-layout":A["a"],JButton:D["a"],Icon:I["a"]},setup:function(){var e=Object(o["inject"])("translate"),t=Object(o["inject"])("swal"),c=Object(o["inject"])("toast"),n=Object(o["inject"])("emitter"),r=Object(Y["b"])(),a=Object(oe["e"])(),s=Object(ce["a"])(),i=s.toFixed,l=Object(o["reactive"])({status:"",keyword:"",employee:null,socket:null,isSocketClosed:!1}),u=Object(o["computed"])((function(){return r.state.user})),d=Object(o["computed"])((function(){return r.state.accountInfo})),m=Object(o["computed"])((function(){return r.state.pos})),b=Object(o["computed"])((function(){return r.state.posCalls})),p=Object(o["computed"])((function(){var e=[];if(l.employee&&(e=m.value.tickets.filter((function(e){return"true"===e.isActive&&e.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase()}))),e.length>1){var t=0;m.value.tickets.map((function(e){return"true"===e.isActive&&("paid"===e.status?e.isActive="false":t++),t>1&&(e.isActive="false"),e})),t>1&&r.dispatch(K["z"],{call:b.value.tickets,data:m.value.tickets})}if(l.keyword&&l.status){var c=l.keyword.trim().toLowerCase();e=m.value.tickets.filter((function(e){return"waiting"===l.status.toString()?("undefined"===typeof e.status||-1!==["waiting","inprogress"].indexOf(e.status.toLowerCase()))&&(H["includes"](e.name.toLowerCase(),c)||H["includes"](e.notes.toLowerCase(),c))&&e.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase():e.status&&e.status.toString()===l.status.toString()&&(H["includes"](e.name.toLowerCase(),c)||H["includes"](e.notes.toLowerCase(),c))&&e.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase()}))}else if(l.keyword){var o=l.keyword.trim().toLowerCase();e=m.value.tickets.filter((function(e){return H["includes"](e.name.toLowerCase(),o)||H["includes"](e.notes.toLowerCase(),o)}))}else e=l.status?m.value.tickets.filter((function(e){return"waiting"===l.status.toString()?("undefined"===typeof e.status||-1!==["waiting","inprogress"].indexOf(e.status.toLowerCase()))&&e.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase():e.status&&e.status.toString()===l.status.toString()&&e.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase()})):m.value.tickets;return H["orderBy"](e,"isActive","desc")})),j=Object(o["computed"])((function(){return d.value?d.value.PayoutCurrencyShortName:"EUR"})),O=function(e){var t=0;return e.ticketProducts.map((function(e){t=Number(t)+Number(e.productQuantity)*Number(e.productPrice)})),i(t)},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=H["cloneDeep"](m.value.tickets);l.employee&&e.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase()&&(o.map((function(t){t.cashier.toLowerCase()===l.employee.USERNAME.toLowerCase()&&(t.isActive=t.ticketId.toString()===e.ticketId.toString()&&"paid"!==t.status?"true":"false")})),r.dispatch(K["z"],{call:b.value.tickets,data:o}),c.success("Ticket selected successfully"),t&&a.push({name:"account-pos-products"}))},f=function(e){k(e,!0)},v=function(e){"paid"!==e.status&&l.employee&&l.employee.USERNAME.toLowerCase()===e.cashier.toLowerCase()&&f(e)},w=function(e){var c=H["findIndex"](m.value.tickets,{ticketId:e});-1!==c&&t.fire({title:"Ticket",text:"Are you sure, want to delete this ticket?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",focusCancel:!0,customClass:{container:"swal2-tailwind"}}).then((function(e){var t=e.value;if(t&&!0===t){var o=H["cloneDeep"](m.value),n=o.tickets,a=n[c],s=o.products,i=a.isActive;if(a.ticketProducts.length>0&&a.ticketProducts.map((function(e){var t=H["findIndex"](s,{id:e.productId});-1!==t&&(s[t].stock=Number(s[t].stock)+Number(e.productQuantity));var c=H["findIndex"](o.favourites,{id:e.productId});-1!==c&&(o.favourites[c].stock=Number(o.favourites[c].stock)+Number(e.productQuantity))})),r.dispatch(K["v"],{call:b.value.products,data:s}),o.products=s,n.splice(c,1),o.tickets=n,"true"===i&&o.tickets.length>0){var u=H["findIndex"](o.tickets,(function(e){return("waiting"===e.status.toLowerCase()||"inprogress"===e.status.toLowerCase())&&e.cashier===l.employee.USERNAME.toLowerCase()}));-1!==u&&(o.tickets[u].isActive="true")}r.dispatch(K["z"],{call:b.value.tickets,data:o.tickets})}}))},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n.emit("saveTicketModal",{currency:j.value,employee:l.employee,ticket:e})},y=function e(){l.socket=new WebSocket("wss://wss.cointopay.com/transactions"),l.socket.onmessage=function(e){if(e&&e.data){var t=e.data.split(":");if("pos"===t[0].toLowerCase()){var c=t[1];u.value&&c.toString()===u.value.ID.toString()&&r.dispatch(K["i"],{})}}},l.socket.onclose=function(t){l.isSocketClosed||e()}};return Object(o["onBeforeMount"])((function(){l.employee=H["find"](m.value.users,{isLoggedIn:"true"}),y()})),Object(o["onBeforeUnmount"])((function(){l.isSocketClosed=!0,l.socket&&l.socket.close()})),Object(T["a"])(Object(T["a"])({translate:e},Object(o["toRefs"])(l)),{},{filteredTickets:p,currency:j,totalAmount:O,continueShopping:f,updateSelectedTicket:k,addProductsToTicket:v,deleteTicket:w,launchSaveTicketModal:h})}};c("79dd");const re=$()(ne,[["render",L],["__scopeId","data-v-4733e418"]]);t["default"]=re},"534d":function(e,t,c){},"79dd":function(e,t,c){"use strict";c("534d")}}]);
//# sourceMappingURL=account-pos-tickets.5eee0bf8.js.map