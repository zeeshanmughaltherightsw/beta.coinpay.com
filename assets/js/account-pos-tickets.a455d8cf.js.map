{"version":3,"sources":["webpack:///./src/views/pos/Tickets.vue","webpack:///./src/components/account/pos/modals/tickets/SaveTicketModal.vue","webpack:///./src/components/account/pos/modals/tickets/SaveTicketModal.vue?ee0a","webpack:///./src/views/pos/Tickets.vue?729d","webpack:///./src/views/pos/Tickets.vue?e963"],"names":["class","_createElementVNode","value","_hoisted_5","_hoisted_6","_hoisted_7","style","colspan","_hoisted_25","_createVNode","_component_pos_layout","content","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_ctx","aria-label","_hoisted_9","_hoisted_10","_component_icon","classes","name","type","_createElementBlock","onClick","_hoisted_11","_component_j_button","$setup","_hoisted_12","_hoisted_13","_hoisted_14","_Fragment","ticket","index","key","data-ticket","onDblclick","ticketId","_hoisted_16","_hoisted_17","isActive","cashier","toLowerCase","USERNAME","status","notes","currency","ticketProducts","length","_hoisted_20","paymentRequest","_createBlock","_component_router_link","to","params","confirmCode","Security","tag","_component_save_ticket_modal","_component_modal","maxWidth","show","onClose","title","onSubmit","_hoisted_8","disabled","components","Modal","Icon","JButton","setup","translate","inject","emitter","toast","store","useStore","showError","validate","validator","state","reactive","closeable","employee","form","errorBag","rules","messages","required","isProcessing","isBarcodeScanner","pos","computed","posCalls","allAtlCoins","allAltCoins","currencyLongName","altCoin","_","ShortName","Name","watch","newVal","oldVal","Object","keys","closeModal","generateId","tickets","Number","toString","submit","formData","isValid","splice","error","push","inputCurrency","dispatch","SAVE_TICKETS","call","data","then","message","success","catch","console","log","onBeforeMount","on","args","toRefs","__exports__","SaveTicketModal","POSLayout","swal","router","useRouter","toFixed","compositionUtils","keyword","socket","isSocketClosed","user","accountInfo","filteredTickets","filter","counter","map","trim","indexOf","a","Date","TransactionConfirmedOn","PayoutCurrencyShortName","totalAmount","product","productQuantity","productPrice","updateSelectedTicket","isRedirect","t","continueShopping","addProductsToTicket","deleteTicket","id","fire","text","icon","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","focusCancel","customClass","container","posData","products","isSelected","productIndex","productId","stock","favIndex","favourites","SAVE_PRODUCTS","ticketIndex","launchSaveTicketModal","emit","initSocket","WebSocket","onmessage","event","parts","split","merchantID","ID","FETCH_POS_DATA","onclose","users","isLoggedIn","onBeforeUnmount","close","render"],"mappings":"4OAGWA,MAAM,Q,GACJA,MAAM,Q,GACJA,MAAM,2D,GACJA,MAAM,qB,QAEPC,gCAAqC,UAA7BC,MAAM,IAAG,eAAW,I,QAC5BD,gCAAuC,UAA/BC,MAAM,WAAU,UAAM,I,QAC9BD,gCAAuC,UAA/BC,MAAM,QAAO,aAAS,I,GAF9BC,EACAC,EACAC,G,GAGCL,MAAM,qB,GACJA,MAAM,mB,GASRA,MAAM,c,GAKXA,MAAM,iJ,GACCA,MAAM,iB,QACXC,gCAYQ,cAXRA,gCAUK,WATHA,gCAA2C,MAAvCD,MAAM,qBAAoB,YAC9BC,gCAAuC,MAAnCD,MAAM,qBAAoB,QAC9BC,gCAAa,UAAT,QACJA,gCAAgB,UAAZ,WACJA,gCAAiB,UAAb,YACJA,gCAA2C,MAAvCD,MAAM,qBAAoB,YAC9BC,gCAAwC,MAApCD,MAAM,qBAAoB,SAC9BC,gCAAyC,MAArCD,MAAM,qBAAoB,UAC9BC,gCAAqD,MAAjDK,MAAA,qCAAqC,eAAO,I,kCAQzCN,MAAM,qB,GACHA,MAAM,Q,2BAoBZA,MAAM,Q,4DAiCVC,gCAAwC,MAApCM,QAAQ,KAAI,uBAAmB,I,GAAnCC,G,iYArGdC,yBA6GaC,QA5GMC,QAAO,qBACtB,IAyGM,CAzGNV,gCAyGM,MAzGNW,EAyGM,CAxGJX,gCAuGM,MAvGNY,EAuGM,CAtGJZ,gCAqBM,MArBNa,EAqBM,CApBJb,gCAMM,MANNc,EAMM,6BALJd,gCAIS,U,qCAJQe,SAAM,GAAEC,aAAW,GAAGjB,MAAM,oB,2BAA5BgB,cAMnBf,gCASM,MATNiB,EASM,CARJjB,gCAOM,MAPNkB,EAOM,CANJV,yBAAsFW,GAAhFC,QAAQ,mDAAmDC,KAAK,W,4BACtErB,gCAA6F,S,qCAA7Ee,UAAO,GAAEC,aAAW,YAAYjB,MAAM,0BAA0BuB,KAAK,Q,4BAArEP,aACQ,KAAZA,WAAO,yBAAnBQ,gCAGO,Q,MAHqBxB,MAAM,2DAC3ByB,QAAK,eAAET,UAAU,K,CACtBP,yBAA4CW,GAAtCC,QAAQ,UAAUC,KAAK,a,2CAInCrB,gCAEM,MAFNyB,EAEM,CADJjB,yBAAsGkB,GAA5FJ,KAAK,SAAUE,QAAK,eAAEG,4B,8BAAyB,IAAkC,2DAA/BA,YAAU,oBAAD,K,UAGzE3B,gCA+EM,MA/EN4B,EA+EM,CA7EJ5B,gCA4EQ,QA5ER6B,EA4EQ,CA3ENC,EAaA9B,gCA6DQ,0CA5DRuB,gCAwDKQ,2CAxDyBJ,kBAAe,CAAjCK,EAAQC,K,yBAApBV,gCAwDK,MAxD2CW,IAAKD,EAAQE,cAAaF,EACrEG,WAAQ,GAAET,sBAAoBK,I,CACjChC,gCAAoC,2CAAzBgC,EAAOK,UAAQ,GAC1BrC,gCAcK,WAbHA,gCAYM,MAZNsC,EAYM,CAXJtC,gCAA2C,OAA3CuC,EAA2C,6BAArBP,EAAOX,MAAI,GAEL,SAApBW,EAAOQ,UAAuBzB,YAAYiB,EAAOS,QAAQC,gBAAkB3B,WAAS4B,SAASD,eAAW,yBADhHnB,gCAGO,UADLf,yBAAkEW,GAA5DC,QAAQ,wBAAwBC,KAAK,qB,uCAGjB,UAApBW,EAAOQ,UAA0C,SAAlBR,EAAOY,QAAqB7B,YAAYiB,EAAOS,UAAY1B,WAAS4B,SAASD,eAAW,yBAD/HnB,gCAKO,Q,MAHLxB,MAAM,iBACLyB,QAAK,GAAEG,uBAAqBK,I,CAC7BxB,yBAA6EW,GAAvEC,QAAQ,mCAAmCC,KAAK,mB,iDAI5DrB,gCAA2B,uCAApBgC,EAAOa,OAAK,GACnB7C,gCAA6B,uCAAtBgC,EAAOS,SAAO,GACrBzC,gCAA8B,uCAAvBgC,EAAOc,UAAQ,GACtB9C,gCAA2C,uCAApCgC,EAAOe,eAAeC,QAAM,GACnChD,gCACK,uCADE2B,cAAYK,GAAU,IAAML,YAAQ,GAE3C3B,gCAA4B,uCAArBgC,EAAOY,QAAM,GACpB5C,gCA8BK,KA9BLiD,EA8BK,CA7BkC,eAAlBjB,EAAOY,QAAqD,OAA1BZ,EAAOkB,eAAc,sDAA1EC,yBAKcC,G,MAHAC,GAAE,CAAAhC,2BAAAiC,QAAAC,YAAuDvB,EAAOkB,eAAeM,WAChFzD,MAAM,wCAAwC0D,IAAI,K,8BAC7D,IAA0B,CAA1BjD,yBAA0BW,GAApBE,KAAK,Y,uBAHS,kBAAc,6FAKpC8B,yBAIcC,GAJAC,GAAE,CAAAhC,0BAAAiC,QAAAjB,SAAmDL,EAAOK,WAE7DtC,MAAM,yCAAyC0D,IAAI,K,8BAC9D,IAAwB,CAAxBjD,yBAAwBW,GAAlBE,KAAK,U,uBAFS,iBAINN,YAAYA,WAAS4B,SAASD,gBAAkBV,EAAOS,QAAQC,eAAW,yBAA1FnB,gCAiBWQ,eAAAG,OAAA,CAhBuB,SAAlBF,EAAOY,OAAM,sDAA3BrB,gCAGS,U,MAH+BxB,MAAM,4BACVyB,QAAK,GAAEG,mBAAiBK,I,CAC1DxB,yBAAgCW,GAA1BE,KAAK,iBAAa,UADT,oBAAgB,uCAIjBN,YAA8B,SAAlBiB,EAAOY,QAAM,yBAAzCrB,gCASWQ,eAAAG,OAAA,uDARTX,gCAGS,UAHDxB,MAAM,4BACLyB,QAAK,GAAEG,wBAAsBK,I,CACpCxB,yBAAyBW,GAAnBE,KAAK,UAAM,UAFgC,mBAAe,sDAIlEE,gCAGS,UAHDxB,MAAM,qBACLyB,QAAK,GAAEG,eAAaK,EAAOK,W,CAClC7B,yBAA0BW,GAApBE,KAAK,WAAO,UAFwB,oBAAe,oG,MAS9B,IAA3BM,kBAAgBqB,QAAM,yBAAhCzB,gCAEK,8D,MASjBf,yBAAuCkD,Q,2DC7G9B3D,MAAM,qC,GAUJA,MAAM,Q,GACJA,MAAM,0C,GAEJA,MAAM,0C,GAIVA,MAAM,Q,GACJA,MAAM,0C,GAEJA,MAAM,0C,GAKVA,MAAM,mB,SAEkBA,MAAM,Q,2LA7BzCoD,yBAqCQQ,GArCAC,SAAU7C,WAAW8C,KAAM9C,OAAO+C,QAAK,eAAEnC,iB,CACpCoC,MAAK,qBACd,IAMM,CANN/D,gCAMM,MANNW,EAMM,CALJX,gCAA4G,yCAAtF,IAAbe,OAAKM,KAAaM,YAAU,sBAAwBA,YAAU,6BAAD,GACtE3B,gCAGO,QAHDD,MAAM,+FACLyB,QAAK,eAAEG,iB,CACZnB,yBAA0BW,GAApBE,KAAK,gBAINX,QAAO,qBAChB,IAwBO,CAxBPV,gCAwBO,QAxBAgE,SAAM,0CAAUrC,WAAM,e,CAC3B3B,gCAMM,MANNY,EAMM,CALJZ,gCAGM,MAHNa,EAGM,CAFJb,gCAAkD,0CAAxC2B,YAAU,qBAAD,GACnB3B,gCAA2F,MAA3Fc,EAA2F,6BAApCa,YAAUZ,WAAU,SAAF,iCAE3Ef,gCAAkE,S,qCAAlDe,OAAKM,KAAI,GAAEtB,MAAM,oBAAoBuB,KAAK,Q,4BAA1CP,OAAKM,UAEvBrB,gCAMM,MANNE,EAMM,CALJF,gCAGM,MAHNG,EAGM,CAFJH,gCAAkD,0CAAxC2B,YAAU,qBAAD,GACnB3B,gCAA4F,MAA5FI,EAA4F,6BAArCuB,YAAUZ,WAAU,UAAF,iCAE3Ef,gCAAmE,S,qCAAnDe,OAAK8B,MAAK,GAAE9C,MAAM,oBAAoBuB,KAAK,Q,4BAA3CP,OAAK8B,WAGvB7C,gCAOM,MAPNiE,EAOM,CANJzD,yBAKWkB,GALAwC,SAAUnD,gBAAY,C,6BAC/B,IAEM,CAFKA,gBAAY,yBAAvBQ,gCAEM,MAFNN,EAEM,CADJT,yBAA4DW,GAArDE,KAAM,UAAWD,QAAQ,0B,uCAElCpB,gCAAqD,yCAA5C2B,YAAU,0BAAD,K,0HAkBf,GACbN,KAAM,kBACN8C,WAAY,CACVC,aACAC,YACAC,gBAEFC,QAEE,MAAMC,EAAYC,oBAAO,aACnBC,EAAUD,oBAAO,WACjBE,EAAQF,oBAAO,SAGfG,EAAQC,kBAER,UACJC,EAAS,SACTC,GACEC,iBAGEC,EAAQC,sBAAS,CACrBrB,MAAM,EACND,SAAU,MACVuB,WAAW,EACXnD,OAAQ,KACRc,SAAU,MACVsC,SAAU,KACVC,KAAM,CACJhE,KAAM,GACNwB,MAAO,IAETyC,SAAU,GACVC,MAAO,CACLlE,KAAM,CAAC,aAETmE,SAAU,CACRnE,KAAM,CACJoE,SAAU,4BAGdC,cAAc,EACdC,kBAAkB,IAIdC,EAAMC,sBAAS,IAAMjB,EAAMK,MAAMW,KACjCE,EAAWD,sBAAS,IAAMjB,EAAMK,MAAMa,UACtCC,EAAcF,sBAAS,IAAMjB,EAAMK,MAAMe,aACzCC,EAAmBJ,sBAAS,KAChC,MAAMK,EAAUC,UAAOJ,EAAY9F,MAAO,CAAEmG,UAAWnB,EAAMnC,WAC7D,OAAOoD,EAAUA,EAAQG,KAAO,KAIlCC,mBAAM,KAAM,IAAMrB,EAAMI,OACtB,CAACkB,EAAQC,KACHC,OAAOC,KAAKzB,EAAMK,UAAUtC,OAAS,IACvCiC,EAAMK,SAAWP,EAASE,EAAMI,KAAMJ,EAAMM,MAAON,EAAMO,aAK/D,MAAMmB,EAAa,KACjB1B,EAAMpB,MAAO,GAET+C,EAAa,KACjB,MAAMC,EAAUV,eAAYP,EAAI3F,MAAM4G,SACtC,GAAIA,EAAQ7D,OAAS,EAAG,CACtB,MAAMhB,EAASmE,WAAQU,EAAS7E,GACvB8E,OAAO9E,EAAOK,WAEvB,OAAQyE,OAAO9E,EAAOK,UAAY,GAAG0E,WAEvC,MAAO,KAGHC,EAAS,KAEb,GADA/B,EAAMK,SAAWP,EAASE,EAAMI,KAAMJ,EAAMM,MAAON,EAAMO,UACd,IAAvCiB,OAAOC,KAAKzB,EAAMK,UAAUtC,OAAc,CAC5CiC,EAAMS,cAAe,EACrB,MAAMuB,EAAWhC,EAAMI,KACjBwB,EAAUV,eAAYP,EAAI3F,MAAM4G,SACtC,IAAIK,GAAU,EACd,GAAIjC,EAAMjD,OAAQ,CAChB,IAAIC,EAAQkE,eAAYU,EAAS7E,GACvBA,EAAOX,OAAS4F,EAAS5F,MAAQ4D,EAAMjD,OAAOK,WAAaL,EAAOK,WAE7D,IAAXJ,GACFA,EAAQkE,eAAYU,EAAS,CAAExE,SAAU4C,EAAMjD,OAAOK,WACtDwE,EAAQM,OAAOlF,EAAO,EAAG,IACpBgD,EAAMjD,OACTX,KAAM4F,EAAS5F,KACfwB,MAAOoE,EAASpE,UAGlBqE,GAAU,EACVjC,EAAMS,cAAe,EACrBf,EAAMyC,MAAM,qCAGyC,IAAnDjB,eAAYU,EAAS,CAAExF,KAAM4F,EAAS5F,OACxCwF,EAAQQ,KAAK,CACXhF,SAAUuE,IACVhE,OAAQ,UACRC,MAAOoE,EAASpE,MAChBxB,KAAM4F,EAAS5F,KACfmB,SAAU,OACVC,QAASwC,EAAMG,SAASzC,SAASD,cACjCI,SAAUmD,EAAiBhG,MAC3BqH,cAAerC,EAAMnC,SACrBC,eAAgB,GAChBG,eAAgB,QAGlBgE,GAAU,EACVjC,EAAMS,cAAe,EACrBf,EAAMyC,MAAM,0CAGZF,GACFtC,EAAM2C,SAASC,OAAc,CAC3BC,KAAM3B,EAAS7F,MAAM4G,QACrBa,KAAMb,IACLc,KAAK,KACN1C,EAAMS,cAAe,EACrB,MAAMkC,EAAU3C,EAAMjD,OAAS,8BAAgC,4BAC/D2C,EAAMkD,QAAQD,GACdjB,MACCmB,MAAMV,IACPW,QAAQC,IAAIZ,GACZnC,EAAMS,cAAe,EACrBf,EAAMyC,MAAM,6BAmBpB,OAbAa,2BAAc,KACZvD,EAAQwD,GAAG,kBAAoBC,IAC7BlD,EAAMnC,SAAWqF,EAAKrF,SACtBmC,EAAMG,SAAW+C,EAAK/C,SACtBH,EAAMjD,OAASmG,EAAKnG,QAAU,KAC9BiD,EAAMI,KAAO,CACXhE,KAAM4D,EAAMjD,OAASiD,EAAMjD,OAAOX,KAAO,GACzCwB,MAAOoC,EAAMjD,OAASiD,EAAMjD,OAAOa,MAAQ,IAE7CoC,EAAMpB,MAAO,MAIV,CACLW,eACG4D,oBAAOnD,GACVH,YACA6B,aACAK,Y,qBC3MN,MAAMqB,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAAS,KAErD,S,0BFwHA,IACbhH,KAAM,UACN8C,WAAY,CACVmE,mBACA,aAAcC,OACdjE,eACAD,aAEFE,QACE,MAAMC,EAAYC,oBAAO,aACnB+D,EAAO/D,oBAAO,QACdE,EAAQF,oBAAO,SACfC,EAAUD,oBAAO,WAEjBG,EAAQC,iBACR4D,EAASC,mBAET,QAAEC,GAAYC,kBAGd3D,EAAQC,sBAAS,CACrBtC,OAAQ,UACRiG,QAAS,GACTzD,SAAU,KACV0D,OAAQ,KACRC,gBAAgB,IAIZC,EAAOnD,sBAAS,IAAMjB,EAAMK,MAAM+D,MAClCC,EAAcpD,sBAAS,IAAMjB,EAAMK,MAAMgE,aACzCrD,EAAMC,sBAAS,IAAMjB,EAAMK,MAAMW,KACjCE,EAAWD,sBAAS,IAAMjB,EAAMK,MAAMa,UACtCoD,EAAkBrD,sBAAS,KAC/B,IAAIgB,EAAU,GAId,GAHI5B,EAAMG,WACRyB,EAAUjB,EAAI3F,MAAM4G,QAAQsC,OAAOnH,GAA8B,SAApBA,EAAOQ,UAAuBR,EAAOS,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,gBAElImE,EAAQ7D,OAAS,EAAG,CACtB,IAAIoG,EAAU,EACdxD,EAAI3F,MAAM4G,QAAQwC,IAAIrH,IACI,SAApBA,EAAOQ,WACa,SAAlBR,EAAOY,OACTZ,EAAOQ,SAAW,QAElB4G,KAGAA,EAAU,IACZpH,EAAOQ,SAAW,SAEbR,IAELoH,EAAU,GACZxE,EAAM2C,SAASC,OAAc,CAC3BC,KAAM3B,EAAS7F,MAAM4G,QACrBa,KAAM9B,EAAI3F,MAAM4G,UAItB,GAAI5B,EAAM4D,SAAW5D,EAAMrC,OAAQ,CACjC,MAAMiG,EAAU5D,EAAM4D,QAAQS,OAAO5G,cACrCmE,EAAUjB,EAAI3F,MAAM4G,QAAQsC,OAAOnH,GACD,YAA5BiD,EAAMrC,OAAOmE,YACkB,qBAAlB/E,EAAOY,SAA8F,IAApE,CAAC,UAAW,cAAc2G,QAAQvH,EAAOY,OAAOF,kBAC7FyD,cAAWnE,EAAOX,KAAKqB,cAAemG,IACrC1C,cAAWnE,EAAOa,MAAMH,cAAemG,KACpC7G,EAAOS,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,cAEzDV,EAAOY,QAAUZ,EAAOY,OAAOmE,aAAe9B,EAAMrC,OAAOmE,aAAeZ,cAAWnE,EAAOX,KAAKqB,cAAemG,IACrH1C,cAAWnE,EAAOa,MAAMH,cAAemG,KACpC7G,EAAOS,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,oBAG7D,GAAIuC,EAAM4D,QAAS,CACxB,MAAMA,EAAU5D,EAAM4D,QAAQS,OAAO5G,cACrCmE,EAAUjB,EAAI3F,MAAM4G,QAAQsC,OAAOnH,GACzBmE,cAAWnE,EAAOX,KAAKqB,cAAemG,IAC5C1C,cAAWnE,EAAOa,MAAMH,cAAemG,SAI3ChC,EADS5B,EAAMrC,OACLgD,EAAI3F,MAAM4G,QAAQsC,OAAOnH,GACD,YAA5BiD,EAAMrC,OAAOmE,YACkB,qBAAlB/E,EAAOY,SACkD,IAApE,CAAC,UAAW,cAAc2G,QAAQvH,EAAOY,OAAOF,iBAClDV,EAAOS,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,cAEpDV,EAAOY,QAAUZ,EAAOY,OAAOmE,aAAe9B,EAAMrC,OAAOmE,YAChE/E,EAAOS,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,eAIrDkD,EAAI3F,MAAM4G,QAGtB,OAAOV,aAAUU,EAAS,CAAE2C,IAAM,MAChC,OAAO,IAAIC,KAAqB,QAAjB,EAACD,EAAEtG,sBAAc,aAAhB,EAAkBwG,yBACjC,YAAa,CAAC,OAAQ,WAIrB5G,EAAW+C,sBAAS,IACjBoD,EAAYhJ,MAAQgJ,EAAYhJ,MAAM0J,wBAA0B,OAInEC,EAAe5H,IACnB,IAAI4H,EAAc,EAIlB,OAHA5H,EAAOe,eAAesG,IAAIQ,IACxBD,EAAc9C,OAAO8C,GAAe9C,OAAO+C,EAAQC,iBAAmBhD,OAAO+C,EAAQE,gBAEhFpB,EAAQiB,IAEXI,EAAuB,CAAChI,EAAQiI,GAAa,KACjD,MAAMpD,EAAUV,eAAYP,EAAI3F,MAAM4G,SAClC5B,EAAMG,UAAYpD,EAAOS,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,gBAC7EmE,EAAQwC,IAAIa,IACNA,EAAEzH,QAAQC,gBAAkBuC,EAAMG,SAASzC,SAASD,gBACtDwH,EAAE1H,SAAW0H,EAAE7H,SAAS0E,aAAe/E,EAAOK,SAAS0E,YAA2B,SAAbmD,EAAEtH,OAAoB,OAAS,WAGxGgC,EAAM2C,SAASC,OAAc,CAC3BC,KAAM3B,EAAS7F,MAAM4G,QACrBa,KAAMb,IAERlC,EAAMkD,QAAQ,gCACVoC,GACFxB,EAAOpB,KAAK,CAAEhG,KAAM,2BAIpB8I,EAAoBnI,IAExBgI,EAAqBhI,GAAQ,IAEzBoI,EAAuBpI,IACL,SAAlBA,EAAOY,QAAqBqC,EAAMG,UAAYH,EAAMG,SAASzC,SAASD,gBAAkBV,EAAOS,QAAQC,eACzGyH,EAAiBnI,IAGfqI,EAAgBC,IACpB,MAAMrI,EAAQkE,eAAYP,EAAI3F,MAAM4G,QAAS,CAAExE,SAAUiI,KAC1C,IAAXrI,GACFuG,EAAK+B,KAAK,CACRxG,MAAO,SACPyG,KAAM,4CACNC,KAAM,UACNC,kBAAkB,EAClBC,mBAAoB,OACpBC,kBAAmB,MACnBC,iBAAkB,KAClBC,aAAa,EACbC,YAAa,CACXC,UAAW,oBAEZrD,KAAK,EAAG1H,YACT,GAAIA,IAAmB,IAAVA,EAAgB,CAC3B,MAAMgL,EAAU9E,eAAYP,EAAI3F,OAC1B4G,EAAUoE,EAAQpE,QAClB7E,EAAS6E,EAAQ5E,GACjBiJ,EAAWD,EAAQC,SACnBC,EAAanJ,EAAOQ,SAuB1B,GAtBIR,EAAOe,eAAeC,OAAS,GACjChB,EAAOe,eAAesG,IAAIQ,IACxB,MAAMuB,EAAejF,eAAY+E,EAAU,CAAEZ,GAAIT,EAAQwB,aACnC,IAAlBD,IACFF,EAASE,GAAcE,MACrBxE,OAAOoE,EAASE,GAAcE,OAC9BxE,OAAO+C,EAAQC,kBAEnB,MAAMyB,EAAWpF,eAAY8E,EAAQO,WAAY,CAAElB,GAAIT,EAAQwB,aAC7C,IAAdE,IACFN,EAAQO,WAAWD,GAAUD,MAC3BxE,OAAOmE,EAAQO,WAAWD,GAAUD,OAASxE,OAAO+C,EAAQC,oBAIpElF,EAAM2C,SAASkE,OAAe,CAC5BhE,KAAM3B,EAAS7F,MAAMiL,SACrBxD,KAAMwD,IAERD,EAAQC,SAAWA,EACnBrE,EAAQM,OAAOlF,EAAO,GACtBgJ,EAAQpE,QAAUA,EACC,SAAfsE,GAAyBF,EAAQpE,QAAQ7D,OAAS,EAAG,CACvD,MAAM0I,EAAcvF,eAAY8E,EAAQpE,QAAU7E,IACR,YAAhCA,EAAOY,OAAOF,eAA+D,eAAhCV,EAAOY,OAAOF,gBACjEV,EAAOS,UAAYwC,EAAMG,SAASzC,SAASD,gBAE1B,IAAjBgJ,IACFT,EAAQpE,QAAQ6E,GAAalJ,SAAW,QAG5CoC,EAAM2C,SAASC,OAAc,CAC3BC,KAAM3B,EAAS7F,MAAM4G,QACrBa,KAAMuD,EAAQpE,cAOlB8E,EAAwB,CAAC3J,EAAS,QACtC0C,EAAQkH,KAAK,kBAAmB,CAC9B9I,SAAUA,EAAS7C,MACnBmF,SAAUH,EAAMG,SAChBpD,OAAQA,KAIN6J,EAAa,KACjB5G,EAAM6D,OAAS,IAAIgD,UAAU,wCAC7B7G,EAAM6D,OAAOiD,UAAaC,IACxB,GAAIA,GAASA,EAAMtE,KAAM,CACvB,MAAMuE,EAAQD,EAAMtE,KAAKwE,MAAM,KAC/B,GAA+B,QAA3BD,EAAM,GAAGvJ,cAAyB,CACpC,MAAMyJ,EAAaF,EAAM,GACrBjD,EAAK/I,OAASkM,EAAWpF,aAAeiC,EAAK/I,MAAMmM,GAAGrF,YACxDnC,EAAM2C,SAAS8E,OAAgB,OAKvCpH,EAAM6D,OAAOwD,QAAWN,IACjB/G,EAAM8D,gBACT8C,MAiBN,OAZA5D,2BAAc,KACZhD,EAAMG,SAAWe,UAAOP,EAAI3F,MAAMsM,MAAO,CAAEC,WAAY,SACvDX,MAGFY,6BAAgB,KACdxH,EAAM8D,gBAAiB,EACnB9D,EAAM6D,QACR7D,EAAM6D,OAAO4D,UAIV,CACLlI,eACG4D,oBAAOnD,GACViE,kBACApG,WACA8G,cACAO,mBACAH,uBACAI,sBACAC,eACAsB,2B,UGrXN,MAAM,GAA2B,IAAgB,GAAQ,CAAC,CAAC,SAASgB,GAAQ,CAAC,YAAY,qBAE1E,iB,oCCTf,W","file":"assets/js/account-pos-tickets.a455d8cf.js","sourcesContent":["<template>\r\n  <pos-layout>\r\n    <template v-slot:content>\r\n      <div class=\"card\">\r\n        <div class=\"body\">\r\n          <div class=\"flex items-center justify-end flex-col lg:flex-row mb-3\">\r\n            <div class=\"mb-4 lg:mb-0 mr-3\">\r\n              <select v-model=\"status\" aria-label=\"\" class=\"form-select w-72\">\r\n                <option value=\"\">All Tickets</option>\r\n                <option value=\"waiting\">Active</option>\r\n                <option value=\"paid\">Processed</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"mb-3 lg:mb-0 mr-3\">\r\n              <div class=\"relative flex-1\">\r\n                <icon classes=\"absolute w-5 h-5 top-3 left-3 dark:text-gray-300\" name=\"search\"></icon>\r\n                <input v-model=\"keyword\" aria-label=\"Search...\" class=\"form-input px-10 w-full\" type=\"text\"/>\r\n                <span v-if=\"keyword !== ''\" class=\"absolute top-3 right-3 dark:text-gray-400 cursor-pointer\"\r\n                      @click=\"keyword = ''\">\r\n                  <icon classes=\"w-5 h-5\" name=\"close\"></icon>\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div class=\"text-right\">\r\n              <j-button type=\"button\" @click=\"launchSaveTicketModal()\">{{ translate('pos.tickets.add') }}</j-button>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600\">\r\n            <table class=\"table-sm mb-2\">\r\n              <thead>\r\n              <tr>\r\n                <th class=\"whitespace-nowrap\">Ticket #</th>\r\n                <th class=\"whitespace-nowrap\">Name</th>\r\n                <th>Note</th>\r\n                <th>Cashier</th>\r\n                <th>Currency</th>\r\n                <th class=\"whitespace-nowrap\">Products</th>\r\n                <th class=\"whitespace-nowrap\">Total</th>\r\n                <th class=\"whitespace-nowrap\">Status</th>\r\n                <th style=\"min-width:200px;width:200px;\">Actions</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody>\r\n              <tr v-for=\"(ticket, index) in filteredTickets\" :key=\"index\" :data-ticket=\"index\"\r\n                  @dblclick=\"addProductsToTicket(ticket)\">\r\n                <td>{{ `#${ticket.ticketId}` }}</td>\r\n                <td>\r\n                  <div class=\"flex items-center\">\r\n                    <span class=\"mr-2\">{{ ticket.name }}</span>\r\n                    <span\r\n                      v-if=\"ticket.isActive === 'true' && employee && ticket.cashier.toLowerCase() === employee.USERNAME.toLowerCase()\">\r\n                      <icon classes=\"w-5 h-5 text-blue-500\" name=\"shopping-cart\"></icon>\r\n                    </span>\r\n                    <span\r\n                      v-if=\"ticket.isActive === 'false' && ticket.status !== 'paid' && employee && ticket.cashier === employee.USERNAME.toLowerCase()\"\r\n                      class=\"cursor-pointer\"\r\n                      @click=\"updateSelectedTicket(ticket)\">\r\n                      <icon classes=\"w-5 h-5 text-gray-500 opacity-40\" name=\"shopping-cart\"></icon>\r\n                    </span>\r\n                  </div>\r\n                </td>\r\n                <td>{{ ticket.notes }}</td>\r\n                <td>{{ ticket.cashier }}</td>\r\n                <td>{{ ticket.currency }}</td>\r\n                <td>{{ ticket.ticketProducts.length }}</td>\r\n                <td>{{ totalAmount(ticket) + ' ' + currency }}\r\n                </td>\r\n                <td> {{ticket.status}} </td>\r\n                <td class=\"pr-3\">\r\n                  <router-link v-if=\"ticket.status === 'inprogress' && ticket.paymentRequest !== null\"\r\n                               v-tippy=\"'View Invoice'\"\r\n                               :to=\"{name: 'account-pos-invoice', params: { confirmCode: ticket.paymentRequest.Security }}\"\r\n                               class=\"hover:text-blue-500 mr-2 inline-block\" tag=\"a\">\r\n                    <icon name=\"clock\"></icon>\r\n                  </router-link>\r\n                  <router-link :to=\"{name: 'account-pos-ticket', params: { ticketId: ticket.ticketId }}\"\r\n                               v-tippy=\"'View Detail'\"\r\n                               class=\"hover:text-green-500 mr-2 inline-block\" tag=\"a\">\r\n                    <icon name=\"eye\"></icon>\r\n                  </router-link>\r\n                  <template v-if=\"employee && employee.USERNAME.toLowerCase() === ticket.cashier.toLowerCase()\">\r\n                    <button v-if=\"ticket.status !== 'paid'\" class=\"hover:text-green-500 mr-2\"\r\n                            v-tippy=\"'Add Product(s)'\" @click=\"continueShopping(ticket)\">\r\n                      <icon name=\"plus-circle\"></icon>\r\n                    </button>\r\n\r\n                    <template v-if=\"employee && ticket.status !== 'paid'\">\r\n                      <button class=\"hover:text-green-500 mr-2\" v-tippy=\"'Update Ticket'\"\r\n                              @click=\"launchSaveTicketModal(ticket)\">\r\n                        <icon name=\"edit\"></icon>\r\n                      </button>\r\n                      <button class=\"hover:text-red-500\" v-tippy=\"'Delete Ticket'\"\r\n                              @click=\"deleteTicket(ticket.ticketId)\">\r\n                        <icon name=\"trash\"></icon>\r\n                      </button>\r\n                    </template>\r\n\r\n                  </template>\r\n                </td>\r\n              </tr>\r\n              <tr v-if=\"filteredTickets.length === 0\">\r\n                <td colspan=\"8\">No ticket available</td>\r\n              </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </template>\r\n  </pos-layout>\r\n  <!-- Save Ticket -->\r\n  <save-ticket-modal></save-ticket-modal>\r\n</template>\r\n\r\n<script>\r\nimport POSLayout from '@/components/layouts/POSLayout'\r\nimport JButton from '@/templates/Button'\r\nimport Icon from '@/components/Icon'\r\nimport SaveTicketModal from '@/components/account/pos/modals/tickets/SaveTicketModal'\r\nimport { computed, inject, onBeforeMount, onBeforeUnmount, reactive, toRefs } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport * as _ from 'lodash'\r\nimport compositionUtils from '@/compositionUtils'\r\nimport { FETCH_POS_DATA, SAVE_PRODUCTS, SAVE_TICKETS } from '@/store/keys'\r\nimport { useRouter } from 'vue-router'\r\n\r\nexport default {\r\n  name: 'Tickets',\r\n  components: {\r\n    SaveTicketModal,\r\n    'pos-layout': POSLayout,\r\n    JButton,\r\n    Icon\r\n  },\r\n  setup () {\r\n    const translate = inject('translate')\r\n    const swal = inject('swal')\r\n    const toast = inject('toast')\r\n    const emitter = inject('emitter')\r\n\r\n    const store = useStore()\r\n    const router = useRouter()\r\n\r\n    const { toFixed } = compositionUtils()\r\n\r\n    // Status\r\n    const state = reactive({\r\n      status: 'waiting',\r\n      keyword: '',\r\n      employee: null,\r\n      socket: null,\r\n      isSocketClosed: false\r\n    })\r\n\r\n    // Computed\r\n    const user = computed(() => store.state.user)\r\n    const accountInfo = computed(() => store.state.accountInfo)\r\n    const pos = computed(() => store.state.pos)\r\n    const posCalls = computed(() => store.state.posCalls)\r\n    const filteredTickets = computed(() => {\r\n      let tickets = []\r\n      if (state.employee) {\r\n        tickets = pos.value.tickets.filter(ticket => ticket.isActive === 'true' && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase())\r\n      }\r\n      if (tickets.length > 1) {\r\n        let counter = 0\r\n        pos.value.tickets.map(ticket => {\r\n          if (ticket.isActive === 'true') {\r\n            if (ticket.status === 'paid') {\r\n              ticket.isActive = 'false'\r\n            } else {\r\n              counter++\r\n            }\r\n          }\r\n          if (counter > 1) {\r\n            ticket.isActive = 'false'\r\n          }\r\n          return ticket\r\n        })\r\n        if (counter > 1) {\r\n          store.dispatch(SAVE_TICKETS, {\r\n            call: posCalls.value.tickets,\r\n            data: pos.value.tickets\r\n          })\r\n        }\r\n      }\r\n      if (state.keyword && state.status) {\r\n        const keyword = state.keyword.trim().toLowerCase()\r\n        tickets = pos.value.tickets.filter(ticket => {\r\n          if (state.status.toString() === 'waiting') {\r\n            return (typeof ticket.status === 'undefined' || ['waiting', 'inprogress'].indexOf(ticket.status.toLowerCase()) !== -1) &&\r\n              (_.includes(ticket.name.toLowerCase(), keyword) ||\r\n                _.includes(ticket.notes.toLowerCase(), keyword)\r\n              ) && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          } else {\r\n            return ticket.status && ticket.status.toString() === state.status.toString() && (_.includes(ticket.name.toLowerCase(), keyword) ||\r\n              _.includes(ticket.notes.toLowerCase(), keyword)\r\n            ) && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          }\r\n        })\r\n      } else if (state.keyword) {\r\n        const keyword = state.keyword.trim().toLowerCase()\r\n        tickets = pos.value.tickets.filter(ticket => {\r\n          return (_.includes(ticket.name.toLowerCase(), keyword) ||\r\n            _.includes(ticket.notes.toLowerCase(), keyword)\r\n          )\r\n        })\r\n      } else if (state.status) {\r\n        tickets = pos.value.tickets.filter(ticket => {\r\n          if (state.status.toString() === 'waiting') {\r\n            return (typeof ticket.status === 'undefined' ||\r\n                ['waiting', 'inprogress'].indexOf(ticket.status.toLowerCase()) !== -1) &&\r\n              ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          } else {\r\n            return ticket.status && ticket.status.toString() === state.status.toString() &&\r\n              ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()\r\n          }\r\n        })\r\n      } else {\r\n        tickets = pos.value.tickets\r\n      }\r\n      // return _.orderBy(tickets, 'isActive', 'desc')\r\n      return _.orderBy(tickets, [(a) => {\r\n        return new Date(a.paymentRequest?.TransactionConfirmedOn)\r\n      }, 'isActive'], ['desc', 'desc'])\r\n    })\r\n    \r\n\r\n    const currency = computed(() => {\r\n      return accountInfo.value ? accountInfo.value.PayoutCurrencyShortName : 'EUR'\r\n    })\r\n\r\n    // Methods\r\n    const totalAmount = (ticket) => {\r\n      let totalAmount = 0\r\n      ticket.ticketProducts.map(product => {\r\n        totalAmount = Number(totalAmount) + Number(product.productQuantity) * Number(product.productPrice)\r\n      })\r\n      return toFixed(totalAmount)\r\n    }\r\n    const updateSelectedTicket = (ticket, isRedirect = false) => {\r\n      const tickets = _.cloneDeep(pos.value.tickets)\r\n      if (state.employee && ticket.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()) {\r\n        tickets.map(t => {\r\n          if (t.cashier.toLowerCase() === state.employee.USERNAME.toLowerCase()) {\r\n            t.isActive = t.ticketId.toString() === ticket.ticketId.toString() && t.status !== 'paid' ? 'true' : 'false'\r\n          }\r\n        })\r\n        store.dispatch(SAVE_TICKETS, {\r\n          call: posCalls.value.tickets,\r\n          data: tickets\r\n        })\r\n        toast.success('Ticket selected successfully')\r\n        if (isRedirect) {\r\n          router.push({ name: 'account-pos-products' })\r\n        }\r\n      }\r\n    }\r\n    const continueShopping = (ticket) => {\r\n      // this.index = null\r\n      updateSelectedTicket(ticket, true)\r\n    }\r\n    const addProductsToTicket = (ticket) => {\r\n      if (ticket.status !== 'paid' && state.employee && state.employee.USERNAME.toLowerCase() === ticket.cashier.toLowerCase()) {\r\n        continueShopping(ticket)\r\n      }\r\n    }\r\n    const deleteTicket = (id) => {\r\n      const index = _.findIndex(pos.value.tickets, { ticketId: id })\r\n      if (index !== -1) {\r\n        swal.fire({\r\n          title: 'Ticket',\r\n          text: 'Are you sure, want to delete this ticket?',\r\n          icon: 'warning',\r\n          showCancelButton: true,\r\n          confirmButtonColor: '#d33',\r\n          confirmButtonText: 'Yes',\r\n          cancelButtonText: 'No',\r\n          focusCancel: true,\r\n          customClass: {\r\n            container: 'swal2-tailwind'\r\n          }\r\n        }).then(({ value }) => {\r\n          if (value && value === true) {\r\n            const posData = _.cloneDeep(pos.value)\r\n            const tickets = posData.tickets\r\n            const ticket = tickets[index]\r\n            const products = posData.products\r\n            const isSelected = ticket.isActive\r\n            if (ticket.ticketProducts.length > 0) {\r\n              ticket.ticketProducts.map(product => {\r\n                const productIndex = _.findIndex(products, { id: product.productId })\r\n                if (productIndex !== -1) {\r\n                  products[productIndex].stock =\r\n                    Number(products[productIndex].stock) +\r\n                    Number(product.productQuantity)\r\n                }\r\n                const favIndex = _.findIndex(posData.favourites, { id: product.productId })\r\n                if (favIndex !== -1) {\r\n                  posData.favourites[favIndex].stock =\r\n                    Number(posData.favourites[favIndex].stock) + Number(product.productQuantity)\r\n                }\r\n              })\r\n            }\r\n            store.dispatch(SAVE_PRODUCTS, {\r\n              call: posCalls.value.products,\r\n              data: products\r\n            })\r\n            posData.products = products\r\n            tickets.splice(index, 1)\r\n            posData.tickets = tickets\r\n            if (isSelected === 'true' && posData.tickets.length > 0) {\r\n              const ticketIndex = _.findIndex(posData.tickets, (ticket) => {\r\n                return (ticket.status.toLowerCase() === 'waiting' || ticket.status.toLowerCase() === 'inprogress') &&\r\n                  ticket.cashier === state.employee.USERNAME.toLowerCase()\r\n              })\r\n              if (ticketIndex !== -1) {\r\n                posData.tickets[ticketIndex].isActive = 'true'\r\n              }\r\n            }\r\n            store.dispatch(SAVE_TICKETS, {\r\n              call: posCalls.value.tickets,\r\n              data: posData.tickets\r\n            })\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    const launchSaveTicketModal = (ticket = null) => {\r\n      emitter.emit('saveTicketModal', {\r\n        currency: currency.value,\r\n        employee: state.employee,\r\n        ticket: ticket\r\n      })\r\n    }\r\n\r\n    const initSocket = () => {\r\n      state.socket = new WebSocket('wss://wss.cointopay.com/transactions')\r\n      state.socket.onmessage = (event) => {\r\n        if (event && event.data) {\r\n          const parts = event.data.split(':')\r\n          if (parts[0].toLowerCase() === 'pos') {\r\n            const merchantID = parts[1]\r\n            if (user.value && merchantID.toString() === user.value.ID.toString()) {\r\n              store.dispatch(FETCH_POS_DATA, {})\r\n            }\r\n          }\r\n        }\r\n      }\r\n      state.socket.onclose = (event) => {\r\n        if (!state.isSocketClosed) {\r\n          initSocket()\r\n        }\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      state.employee = _.find(pos.value.users, { isLoggedIn: 'true' })\r\n      initSocket()\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      state.isSocketClosed = true\r\n      if (state.socket) {\r\n        state.socket.close()\r\n      }\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      filteredTickets,\r\n      currency,\r\n      totalAmount,\r\n      continueShopping,\r\n      updateSelectedTicket,\r\n      addProductsToTicket,\r\n      deleteTicket,\r\n      launchSaveTicketModal\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.table-sm {\r\n  thead {\r\n    tr {\r\n      th:first-child {\r\n        @apply pl-3;\r\n      }\r\n    }\r\n  }\r\n\r\n  tbody {\r\n    tr {\r\n      td:first-child {\r\n        @apply pl-3;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <modal :maxWidth=\"maxWidth\" :show=\"show\" @close=\"closeModal()\">\r\n    <template #title>\r\n      <div class=\"flex items-center justify-between\">\r\n        <span>{{ form.name == '' ? translate('pos.products.title') : translate('pos.products.titleupdate') }}</span>\r\n        <span class=\"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer\"\r\n              @click=\"closeModal()\">\r\n          <icon name=\"close\"></icon>\r\n        </span>\r\n      </div>\r\n    </template>\r\n    <template #content>\r\n      <form @submit.prevent=\"submit()\">\r\n        <div class=\"mb-2\">\r\n          <div class=\"flex items-center justify-between mb-1\">\r\n            <label>{{ translate('pos.tickets.name') }}</label>\r\n            <div class=\"text-red-700 dark:text-red-400 text-sm\">{{ showError(errorBag, 'name') }}</div>\r\n          </div>\r\n          <input v-model=\"form.name\" class=\"form-input w-full\" type=\"text\"/>\r\n        </div>\r\n        <div class=\"mb-2\">\r\n          <div class=\"flex items-center justify-between mb-1\">\r\n            <label>{{ translate('pos.tickets.note') }}</label>\r\n            <div class=\"text-red-700 dark:text-red-400 text-sm\">{{ showError(errorBag, 'notes') }}</div>\r\n          </div>\r\n          <input v-model=\"form.notes\" class=\"form-input w-full\" type=\"text\"/>\r\n        </div>\r\n\r\n        <div class=\"mt-4 text-right\">\r\n          <j-button :disabled=\"isProcessing\">\r\n            <div v-if=\"isProcessing\" class=\"mr-3\">\r\n              <icon :name=\"'spinner'\" classes=\"w-4 h-4 text-white\"></icon>\r\n            </div>\r\n            <span>{{ translate('pos.products.btn_save') }}</span>\r\n          </j-button>\r\n        </div>\r\n      </form>\r\n    </template>\r\n  </modal>\r\n</template>\r\n\r\n<script>\r\nimport Modal from '@/components/Modal'\r\nimport Icon from '@/components/Icon'\r\nimport JButton from '@/templates/Button'\r\nimport { computed, inject, onBeforeMount, reactive, toRefs, watch } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport validator from '@/validator'\r\nimport * as _ from 'lodash'\r\nimport { SAVE_TICKETS } from '@/store/keys'\r\n\r\nexport default {\r\n  name: 'SaveTicketModal',\r\n  components: {\r\n    Modal,\r\n    Icon,\r\n    JButton\r\n  },\r\n  setup () {\r\n    // Providers\r\n    const translate = inject('translate')\r\n    const emitter = inject('emitter')\r\n    const toast = inject('toast')\r\n\r\n    // Store\r\n    const store = useStore()\r\n\r\n    const {\r\n      showError,\r\n      validate\r\n    } = validator()\r\n\r\n    // State\r\n    const state = reactive({\r\n      show: false,\r\n      maxWidth: '2xl',\r\n      closeable: true,\r\n      ticket: null,\r\n      currency: 'EUR',\r\n      employee: null,\r\n      form: {\r\n        name: '',\r\n        notes: ''\r\n      },\r\n      errorBag: {},\r\n      rules: {\r\n        name: ['required']\r\n      },\r\n      messages: {\r\n        name: {\r\n          required: 'Ticket name is required'\r\n        }\r\n      },\r\n      isProcessing: false,\r\n      isBarcodeScanner: false\r\n    })\r\n\r\n    // Computed\r\n    const pos = computed(() => store.state.pos)\r\n    const posCalls = computed(() => store.state.posCalls)\r\n    const allAtlCoins = computed(() => store.state.allAltCoins)\r\n    const currencyLongName = computed(() => {\r\n      const altCoin = _.find(allAtlCoins.value, { ShortName: state.currency })\r\n      return altCoin ? altCoin.Name : ''\r\n    })\r\n\r\n    // Watch\r\n    watch(() => ({ ...state.form }),\r\n      (newVal, oldVal) => {\r\n        if (Object.keys(state.errorBag).length > 0) {\r\n          state.errorBag = validate(state.form, state.rules, state.messages)\r\n        }\r\n      })\r\n\r\n    // Methods\r\n    const closeModal = () => {\r\n      state.show = false\r\n    }\r\n    const generateId = () => {\r\n      const tickets = _.cloneDeep(pos.value.tickets)\r\n      if (tickets.length > 0) {\r\n        const ticket = _.maxBy(tickets, ticket => {\r\n          return Number(ticket.ticketId)\r\n        })\r\n        return (Number(ticket.ticketId) + 1).toString()\r\n      }\r\n      return '1'\r\n    }\r\n    // Create or Update Product\r\n    const submit = () => {\r\n      state.errorBag = validate(state.form, state.rules, state.messages)\r\n      if (Object.keys(state.errorBag).length === 0) {\r\n        state.isProcessing = true\r\n        const formData = state.form\r\n        const tickets = _.cloneDeep(pos.value.tickets)\r\n        let isValid = true\r\n        if (state.ticket) {\r\n          let index = _.findIndex(tickets, ticket => {\r\n            return (ticket.name === formData.name && state.ticket.ticketId !== ticket.ticketId)\r\n          })\r\n          if (index === -1) {\r\n            index = _.findIndex(tickets, { ticketId: state.ticket.ticketId })\r\n            tickets.splice(index, 1, {\r\n              ...state.ticket,\r\n              name: formData.name,\r\n              notes: formData.notes\r\n            })\r\n          } else {\r\n            isValid = false\r\n            state.isProcessing = false\r\n            toast.error('Ticket name already exists!')\r\n          }\r\n        } else {\r\n          if (_.findIndex(tickets, { name: formData.name }) === -1) {\r\n            tickets.push({\r\n              ticketId: generateId(),\r\n              status: 'waiting',\r\n              notes: formData.notes,\r\n              name: formData.name,\r\n              isActive: 'true',\r\n              cashier: state.employee.USERNAME.toLowerCase(),\r\n              currency: currencyLongName.value,\r\n              inputCurrency: state.currency,\r\n              ticketProducts: [],\r\n              paymentRequest: null\r\n            })\r\n          } else {\r\n            isValid = false\r\n            state.isProcessing = false\r\n            toast.error('Product with this sku already exists!')\r\n          }\r\n        }\r\n        if (isValid) {\r\n          store.dispatch(SAVE_TICKETS, {\r\n            call: posCalls.value.tickets,\r\n            data: tickets\r\n          }).then(() => {\r\n            state.isProcessing = false\r\n            const message = state.ticket ? 'Ticket updated successfully' : 'Ticket added successfully'\r\n            toast.success(message)\r\n            closeModal()\r\n          }).catch(error => {\r\n            console.log(error)\r\n            state.isProcessing = false\r\n            toast.error('Internal Server Error')\r\n          })\r\n        }\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      emitter.on('saveTicketModal', (args) => {\r\n        state.currency = args.currency\r\n        state.employee = args.employee\r\n        state.ticket = args.ticket || null\r\n        state.form = {\r\n          name: state.ticket ? state.ticket.name : '',\r\n          notes: state.ticket ? state.ticket.notes : ''\r\n        }\r\n        state.show = true\r\n      })\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      showError,\r\n      closeModal,\r\n      submit\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","import { render } from \"./SaveTicketModal.vue?vue&type=template&id=591afd86\"\nimport script from \"./SaveTicketModal.vue?vue&type=script&lang=js\"\nexport * from \"./SaveTicketModal.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\zeesh\\\\OneDrive\\\\Desktop\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Tickets.vue?vue&type=template&id=682010da&scoped=true\"\nimport script from \"./Tickets.vue?vue&type=script&lang=js\"\nexport * from \"./Tickets.vue?vue&type=script&lang=js\"\n\nimport \"./Tickets.vue?vue&type=style&index=0&id=682010da&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\zeesh\\\\OneDrive\\\\Desktop\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-682010da\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Tickets.vue?vue&type=style&index=0&id=682010da&lang=scss&scoped=true\""],"sourceRoot":""}