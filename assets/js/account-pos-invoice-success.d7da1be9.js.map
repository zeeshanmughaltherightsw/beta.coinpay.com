{"version":3,"sources":["webpack:///./src/views/pos/Success.vue","webpack:///./src/views/pos/Success.vue?c38a"],"names":["class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","style","_hoisted_6","_hoisted_7","_hoisted_8","key","_hoisted_9","_hoisted_10","_createTextVNode","render","_ctx","_cache","$props","$setup","$data","$options","_component_icon","_resolveComponent","_component_routerLink","_component_pos_layout","_openBlock","_createBlock","content","paymentRequest","_createElementBlock","_createVNode","name","classes","_createElementVNode","_toDisplayString","TransactionID","onSubmit","placeholder","aria-label","type","email","$event","_vModelText","form","disabled","_createCommentVNode","tag","to","default","components","POSLayout","Icon","setup","translate","inject","http","toast","store","useStore","route","useRoute","router","useRouter","validator","showError","validate","state","reactive","ticket","errorBag","rules","messages","required","isProcessing","user","computed","pos","receipt","_","value","receipts","TICKETNUMBER","ticketId","toString","items","receiptItems","filter","item","RECIEPT_ID","ID","watch","newVal","oldVal","Object","keys","length","apiBaseUrl","process","submit","ticketReceipt","Time","moment","Date","Number","DATE","format","TOTAL","CURRENCY","Cashier","CASHIER","Items","payload","Call","MerchantID","APIKey","ticketData","JSON","stringify","output","encodeForm","data","map","encodeURIComponent","join","post","headers","then","response","success","push","catch","error","console","log","onBeforeMount","params","tickets","toRefs","__exports__"],"mappings":"+JAGWA,MAAM,eAAAC,GAEND,MAAM,iCAAAE,EAAN,CAAAF,MAGQ,gCAAAG,EAAN,CAAAH,MAEU,0BAAAI,EAAN,CAAAC,MACE,mBAAAC,EAAA,CAD4B,eAC5BC,EAAA,CAD4B,YAC5BC,EAAA,CAAoBC,IAAA,EAKGT,MAAM,QAAAU,EAAM,CAOvCV,MAAM,mCAAAW,EAAAC,mDAEoE,SAFnCC,EAEmCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GAEjF,IAFiFC,EAFpEC,sCAEoEC,EAFpED,4CAEoEE,EAFpEF,4CAIb,OAFiFG,yBAFpEC,2BAON,MA5BMC,QAAO,sBACtB,iBAyBM,CAzByBZ,UAAUA,SAAOa,gBAAcH,yBAA9DI,gCAyBM,MAzBN,EAyBM,CAxBJC,yBAA4ET,EAAA,CAAtEU,KAAK,eAAeC,QAAQ,qCAClCC,gCAEI,IAFJ,EAAyC,aAC9BC,6BAAGnB,SAAOa,eAAeO,eAAgB,gCACpD,GACAF,gCAgBM,MAhBN,EAgBM,CAfJA,gCAaO,QAbAG,SAAM,2DAAUlB,aAAM,gBAC3Be,gCAWM,MAXN,EAWM,CAVJA,gCAGM,MAHN,EAGM,6BAAAA,gCADmF,SAD/EI,YAAanB,YAAS,sBACvBoB,aAAW,QAAQrC,MAAM,oBAAoBsC,KAAK,QAAO,qDAAUxB,OAAKyB,MAAKC,KAAA,OAAAlC,GAAA,EAALmC,gBAAA3B,EAAL4B,KAAKH,WAEjFP,gCAKS,UALAW,SAAU7B,eAAcd,MAAM,wBAAsB,CAC/Cc,gBAAYU,yBAAxBI,gCAEO,OAFP,EAEO,CADLC,yBAA4DT,EAAA,CAArDU,KAAM,UAAWC,QAAQ,0BAAoBa,gCAApB,OAElCZ,gCAA6D,YAAAC,6BAApDhB,YAAS,wCAAAV,MAAA,IAIxByB,gCAAqF,MAArF,EAAqFC,6BAArChB,YAAUH,WAAQ,eAEpEe,yBAEaP,EAAA,CAFDtB,MAAM,kBAAkB6C,IAAI,IAAKC,GAAI,CAAAhB,8BAA8B,CAAAiB,QAA9B,8C,SAG7C,2C,qMAeG,GACbjB,KAAM,UACNkB,WAAY,CACV,aAAcC,OACdC,aAEFC,MANa,WAQX,IAAMC,EAAYC,oBAAO,aACnBC,EAAOD,oBAAO,QACdE,EAAQF,oBAAO,SAEfG,EAAQC,iBACRC,EAAQC,iBACRC,EAASC,iBAEf,EAGIC,iBAFFC,EADF,EACEA,UACAC,EAFF,EAEEA,SAIIC,EAAQC,sBAAS,CACrBC,OAAQ,KACRzB,KAAM,CACJH,MAAO,IAET6B,SAAU,GACVC,MAAO,CACL9B,MAAO,CAAC,WAAY,UAEtB+B,SAAU,CACR/B,MAAO,CACLgC,SAAU,4BACVhC,MAAO,yCAGXiC,cAAc,IAIVC,EAAOC,uBAAS,kBAAMlB,EAAMS,MAAMQ,QAClCE,EAAMD,uBAAS,kBAAMlB,EAAMS,MAAMU,OACjCC,EAAUF,uBAAS,WACvB,IAAME,EAAUC,UACdF,EAAIG,MAAMC,UAAU,SAAAH,GAAM,OAAKA,EAAQI,eAAiBf,EAAME,OAAOc,SAASC,cAKhF,OAHIN,IACFA,EAAQO,MAAQR,EAAIG,MAAMM,aAAaC,QAAO,SAAAC,GAAG,OAAKA,EAAKC,aAAeX,EAAQY,OAE7EZ,KAITa,oBAAM,oCAAYxB,EAAMvB,SACtB,SAACgD,EAAQC,GACHC,OAAOC,KAAK5B,EAAMG,UAAU0B,OAAS,IACvC7B,EAAMG,SAAWJ,EAAS0B,EAAQzB,EAAMI,MAAOJ,EAAMK,cAM3D,IAAMyB,EAAaC,4BACbC,EAAS,WAEb,GADAhC,EAAMG,SAAWJ,EAASC,EAAMvB,KAAMuB,EAAMI,MAAOJ,EAAMK,UACd,IAAvCsB,OAAOC,KAAK5B,EAAMG,UAAU0B,QAAgBlB,EAAQE,MAAO,CAC7Db,EAAMO,cAAe,EACrB,IAAM0B,EAAgB,CACpB,aAActB,EAAQE,MAAMU,GAC5BW,KAAMC,IAAO,IAAIC,KAAKC,OAAO1B,EAAQE,MAAMyB,QAAQC,OAAO,qBAC1D,eAAgB5B,EAAQE,MAAM2B,MAAQ,IAAM7B,EAAQE,MAAM4B,SAC1DC,QAAS/B,EAAQE,MAAM8B,QACvBC,MAAOjC,EAAQE,MAAMK,OAEjB2B,EAAU,CACdC,KAAM,aACNC,WAAYV,OAAO7B,EAAKK,MAAMU,IAC9ByB,OAAQxC,EAAKK,MAAMmC,OACnB1E,MAAO0B,EAAMvB,KAAKH,MAClB2E,WAAYC,KAAKC,UAAUlB,GAC3BmB,OAAQ,QAEJC,EAAa,SAAAC,GACjB,OAAO3B,OAAOC,KAAK0B,GAAMC,KAAI,SAAA/G,GAAE,OAAKgH,mBAAmBhH,GAAO,IAAMgH,mBAAmBF,EAAK9G,OAAOiH,KAAK,MAE1GpE,EAAKqE,KAAL,UAAa5B,EAAb,YAAmCuB,EAAWR,GAAU,CACtDc,QAAS,CACP,eAAgB,uCAEjBC,MAAK,SAAAC,GACN7D,EAAMO,cAAe,EACjBsD,EAASP,OACXtD,EAAMvB,KAAKH,MAAQ,GACnBgB,EAAMwE,QAAQ,8BAEhBnE,EAAOoE,KAAK,CAAElG,KAAM,4BACnBmG,OAAM,SAAAC,GACPjE,EAAMO,cAAe,EACrB2D,QAAQC,IAAIF,QAWlB,OANAG,4BAAc,WACRzC,OAAOC,KAAKnC,EAAM4E,QAAQxC,OAAS,GAAKpC,EAAM4E,OAAOrD,WACvDhB,EAAME,OAASU,UAAOF,EAAIG,MAAMyD,QAAS,CAAEtD,SAAUvB,EAAM4E,OAAOrD,eAItE,+BACE7B,aACGoF,oBAAOvE,IAFZ,IAGEF,YACAkC,a,qBCxJN,MAAMwC,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAAS5H,KAErD","file":"assets/js/account-pos-invoice-success.d7da1be9.js","sourcesContent":["<template>\r\n  <pos-layout>\r\n    <template v-slot:content>\r\n      <div class=\"text-center\" v-if=\"ticket && ticket.paymentRequest\">\r\n        <icon name=\"check-circle\" classes=\"w-24 h-24 text-green-500 mx-auto\"></icon>\r\n        <p class=\"font-bold text-green-500 mb-4\">\r\n          Invoice #{{ ticket.paymentRequest.TransactionID }} has been paid successfully!\r\n        </p>\r\n        <div class=\"w-full md:w-3/5 mx-auto mb-3\">\r\n          <form @submit.prevent=\"submit()\">\r\n            <div class=\"flex items-center mb-1\">\r\n              <div style=\"flex-grow: 1\">\r\n                <input :placeholder=\"translate('pos.receipts.email')\"\r\n                       aria-label=\"Email\" class=\"form-input w-full\" type=\"email\" v-model=\"form.email\"/>\r\n              </div>\r\n              <button :disabled=\"isProcessing\" class=\"btn btn-success ml-3\">\r\n                <span v-if=\"isProcessing\" class=\"mr-3\">\r\n                  <icon :name=\"'spinner'\" classes=\"w-4 h-4 text-white\"></icon>\r\n                </span>\r\n                <span>{{ translate('pos.receipts.btn_send_receipt') }}</span>\r\n              </button>\r\n            </div>\r\n          </form>\r\n          <div class=\"text-blue-500 text-sm text-left\">{{ showError(errorBag, 'email') }}</div>\r\n        </div>\r\n        <routerLink class=\"btn btn-primary\" tag=\"a\" :to=\"{name: 'account-pos-products'}\">\r\n          Create New Order\r\n        </routerLink>\r\n      </div>\r\n    </template>\r\n  </pos-layout>\r\n</template>\r\n\r\n<script>\r\nimport POSLayout from '@/components/layouts/POSLayout'\r\nimport Icon from '@/components/Icon'\r\nimport { computed, inject, onBeforeMount, reactive, toRefs, watch } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { useStore } from 'vuex'\r\nimport validator from '@/validator'\r\nimport * as _ from 'lodash'\r\nimport moment from 'moment'\r\n\r\nexport default {\r\n  name: 'Success',\r\n  components: {\r\n    'pos-layout': POSLayout,\r\n    Icon\r\n  },\r\n  setup () {\r\n    // Providers\r\n    const translate = inject('translate')\r\n    const http = inject('http')\r\n    const toast = inject('toast')\r\n\r\n    const store = useStore()\r\n    const route = useRoute()\r\n    const router = useRouter()\r\n\r\n    const {\r\n      showError,\r\n      validate\r\n    } = validator()\r\n\r\n    // State\r\n    const state = reactive({\r\n      ticket: null,\r\n      form: {\r\n        email: ''\r\n      },\r\n      errorBag: {},\r\n      rules: {\r\n        email: ['required', 'email']\r\n      },\r\n      messages: {\r\n        email: {\r\n          required: 'Email address is required',\r\n          email: 'Please provide a valid email address'\r\n        }\r\n      },\r\n      isProcessing: false\r\n    })\r\n\r\n    // Computed\r\n    const user = computed(() => store.state.user)\r\n    const pos = computed(() => store.state.pos)\r\n    const receipt = computed(() => {\r\n      const receipt = _.find(\r\n        pos.value.receipts, receipt => receipt.TICKETNUMBER === state.ticket.ticketId.toString()\r\n      )\r\n      if (receipt) {\r\n        receipt.items = pos.value.receiptItems.filter(item => item.RECIEPT_ID === receipt.ID)\r\n      }\r\n      return receipt\r\n    })\r\n\r\n    // Watch\r\n    watch(() => ({ ...state.form }),\r\n      (newVal, oldVal) => {\r\n        if (Object.keys(state.errorBag).length > 0) {\r\n          state.errorBag = validate(newVal, state.rules, state.messages)\r\n        }\r\n      }\r\n    )\r\n\r\n    // Method\r\n    const apiBaseUrl = process.env.VUE_APP_API_URL\r\n    const submit = () => {\r\n      state.errorBag = validate(state.form, state.rules, state.messages)\r\n      if (Object.keys(state.errorBag).length === 0 && receipt.value) {\r\n        state.isProcessing = true\r\n        const ticketReceipt = {\r\n          'Receipt ID': receipt.value.ID,\r\n          Time: moment(new Date(Number(receipt.value.DATE))).format('DD/MM/YYYY H:mm A'),\r\n          'Total Amount': receipt.value.TOTAL + ' ' + receipt.value.CURRENCY,\r\n          Cashier: receipt.value.CASHIER,\r\n          Items: receipt.value.items\r\n        }\r\n        const payload = {\r\n          Call: 'POSRECEIPT',\r\n          MerchantID: Number(user.value.ID),\r\n          APIKey: user.value.APIKey,\r\n          email: state.form.email,\r\n          ticketData: JSON.stringify(ticketReceipt),\r\n          output: 'json'\r\n        }\r\n        const encodeForm = data => {\r\n          return Object.keys(data).map(key => encodeURIComponent(key) + '=' + encodeURIComponent(data[key])).join('&')\r\n        }\r\n        http.post(`${apiBaseUrl}/v2REAPI`, encodeForm(payload), {\r\n          headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded'\r\n          }\r\n        }).then(response => {\r\n          state.isProcessing = false\r\n          if (response.data) {\r\n            state.form.email = ''\r\n            toast.success('Receipt sent successfully')\r\n          }\r\n          router.push({ name: 'account-pos-products' })\r\n        }).catch(error => {\r\n          state.isProcessing = false\r\n          console.log(error)\r\n        })\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      if (Object.keys(route.params).length > 0 && route.params.ticketId) {\r\n        state.ticket = _.find(pos.value.tickets, { ticketId: route.params.ticketId })\r\n      }\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      showError,\r\n      submit\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped></style>\r\n","import { render } from \"./Success.vue?vue&type=template&id=02b8e37c\"\nimport script from \"./Success.vue?vue&type=script&lang=js\"\nexport * from \"./Success.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\TRS 37\\\\Desktop\\\\Zeeshan\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}