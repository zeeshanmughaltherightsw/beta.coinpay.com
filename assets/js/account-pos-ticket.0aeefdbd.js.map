{"version":3,"sources":["webpack:///./src/views/pos/Ticket.vue?efeb","webpack:///./src/views/pos/Ticket.vue","webpack:///./src/components/account/pos/modals/tickets/UpdateCartItemModal.vue","webpack:///./src/components/account/pos/modals/tickets/UpdateCartItemModal.vue?5220","webpack:///./src/views/pos/Ticket.vue?fe9b"],"names":["class","_createElementVNode","style","colspan","_hoisted_16","_createVNode","_component_pos_layout","content","_hoisted_1","_hoisted_2","_hoisted_3","_component_router_link","tag","to","name","$setup","_ctx","status","cashier","USERNAME","_createBlock","_hoisted_4","_createElementBlock","_hoisted_5","_hoisted_6","_Fragment","ticketProducts","product","index","key","onClick","productName","productSku","productPrice","productQuantity","_component_icon","length","_component_update_cart_item_modal","_component_modal","maxWidth","show","onClose","title","onSubmit","itemName","_component_j_button","type","onKeyup","qty","_hoisted_7","disabled","_hoisted_8","classes","components","Modal","Icon","JButton","setup","translate","inject","emitter","toast","store","useStore","showError","validate","validator","state","reactive","closeable","item","ticket","itemIndex","currency","form","errorBag","rules","messages","required","minValue","isProcessing","confirmHook","pos","computed","posCalls","stockLeft","_","value","products","id","productId","Number","stock","totalPrice","toFixed","watch","newVal","oldVal","Object","keys","closeModal","add","sub","validateQty","submit","posData","ticketIndex","tickets","ticketId","toString","paymentRequest","dispatch","SAVE_TICKETS","call","data","productIndex","SAVE_PRODUCTS","favIndex","favourites","commit","SET_POS","success","onBeforeMount","on","args","confirm","toRefs","__exports__","POSLayout","UpdateCartItemModal","swal","route","useRoute","saveNotification","compositionUtils","employee","socket","isSocketClosed","accountInfo","user","PayoutCurrencyShortName","launchUpdateCartItem","emit","removeItemFromCart","fire","text","icon","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","focusCancel","customClass","container","then","activeTicket","splice","initSocket","WebSocket","onmessage","event","parts","split","toLowerCase","merchantID","ID","FETCH_POS_DATA","onclose","users","isLoggedIn","params","onBeforeUnmount","close","render"],"mappings":"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","file":"assets/js/account-pos-ticket.0aeefdbd.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Ticket.vue?vue&type=style&index=0&id=1f31a733&lang=scss&scoped=true\"","<template>\r\n  <pos-layout>\r\n    <template v-slot:content>\r\n      <div class=\"card\">\r\n        <div class=\"body\">\r\n          <div class=\"flex items-center justify-end mb-3\">\r\n            <router-link tag=\"a\" :to=\"{name: 'account-pos-tickets'}\"\r\n                         class=\"btn btn-primary mr-2\">{{ translate('pos.tickets.back') }}\r\n            </router-link>\r\n            <router-link tag=\"a\" :to=\"{name: 'account-pos-products'}\" class=\"btn btn-primary\"\r\n                         v-if=\"ticket.status !== 'paid' && ticket.cashier === employee.USERNAME\">\r\n              {{ translate('pos.tickets.add_product') }}\r\n            </router-link>\r\n          </div>\r\n          <div\r\n            class=\"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600\">\r\n            <table class=\"table-sm mb-2\" v-if=\"ticket\">\r\n              <thead>\r\n              <tr>\r\n                <th style=\"min-width: 150px;\">Product</th>\r\n                <th style=\"min-width: 100px;\">SKU</th>\r\n                <th>Price</th>\r\n                <th>Quantity</th>\r\n                <th>Total Price</th>\r\n                <th style=\"min-width: 100px;\">Actions</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody>\r\n              <tr :key=\"index\" v-for=\"(product, index) in ticket.ticketProducts\">\r\n                <td @click=\"launchUpdateCartItem(product, index)\">{{ product.productName }}</td>\r\n                <td @click=\"launchUpdateCartItem(product, index)\">{{ product.productSku }}</td>\r\n                <td @click=\"launchUpdateCartItem(product, index)\">{{ `${product.productPrice} ${currency}` }}</td>\r\n                <td @click=\"launchUpdateCartItem(product, index)\">{{ product.productQuantity }}</td>\r\n                <td @click=\"launchUpdateCartItem(product, index)\">\r\n                  {{ `${toFixed(product.productPrice * product.productQuantity)} ${currency}` }}\r\n                </td>\r\n                <td>\r\n                  <div v-if=\"employee && employee.USERNAME === ticket.cashier\">\r\n                    <button @click=\"launchUpdateCartItem(product, index)\"\r\n                            class=\"hover:text-blue-500 mr-2\" v-if=\"ticket.status !== 'paid'\">\r\n                      <icon name=\"edit\"></icon>\r\n                    </button>\r\n                    <button @click=\"removeItemFromCart(product, index)\"\r\n                            class=\"hover:text-red-500\" v-if=\"ticket.status !== 'paid'\">\r\n                      <icon name=\"trash\"></icon>\r\n                    </button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n              <tr v-if=\"ticket.ticketProducts.length === 0\">\r\n                <td colspan=\"6\">No products available!</td>\r\n              </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </template>\r\n  </pos-layout>\r\n  <!-- Update Cart Item Modal -->\r\n  <update-cart-item-modal></update-cart-item-modal>\r\n</template>\r\n\r\n<script>\r\nimport POSLayout from '@/components/layouts/POSLayout'\r\nimport UpdateCartItemModal from '@/components/account/pos/modals/tickets/UpdateCartItemModal'\r\nimport Icon from '@/components/Icon'\r\nimport { computed, inject, onBeforeMount, onBeforeUnmount, reactive, toRefs } from 'vue'\r\nimport compositionUtils from '@/compositionUtils'\r\nimport { useStore } from 'vuex'\r\nimport * as _ from 'lodash'\r\nimport { FETCH_POS_DATA, SAVE_PRODUCTS, SAVE_TICKETS, SET_POS } from '@/store/keys'\r\nimport { useRoute } from 'vue-router'\r\n\r\nexport default {\r\n  name: 'Ticket',\r\n  components: {\r\n    'pos-layout': POSLayout,\r\n    Icon,\r\n    UpdateCartItemModal\r\n  },\r\n  setup () {\r\n    // Providers\r\n    const translate = inject('translate')\r\n    const swal = inject('swal')\r\n    const emitter = inject('emitter')\r\n    const toast = inject('toast')\r\n    // Store\r\n    const store = useStore()\r\n    const route = useRoute()\r\n\r\n    const {\r\n      toFixed,\r\n      saveNotification\r\n    } = compositionUtils()\r\n\r\n    const state = reactive({\r\n      ticket: null,\r\n      employee: null,\r\n      socket: null,\r\n      isSocketClosed: false\r\n    })\r\n\r\n    // Computed\r\n    const accountInfo = computed(() => store.state.accountInfo)\r\n    const user = computed(() => store.state.user)\r\n    const pos = computed(() => store.state.pos)\r\n    const posCalls = computed(() => store.state.posCalls)\r\n    const currency = computed(() => {\r\n      return accountInfo.value ? accountInfo.value.PayoutCurrencyShortName : 'EUR'\r\n    })\r\n\r\n    // Methods\r\n    const launchUpdateCartItem = (product, index) => {\r\n      emitter.emit('updateCartItemModal', {\r\n        product: product,\r\n        itemIndex: index,\r\n        currency: currency.value,\r\n        ticket: state.ticket,\r\n        confirm: () => {\r\n          state.ticket = _.find(pos.value.tickets, { ticketId: state.ticket.ticketId })\r\n        }\r\n      })\r\n    }\r\n    // Remove product from cart\r\n    const removeItemFromCart = (product, index) => {\r\n      swal.fire({\r\n        title: 'Ticket',\r\n        text: 'Are you sure, want to remove this product?',\r\n        icon: 'warning',\r\n        showCancelButton: true,\r\n        confirmButtonColor: '#d33',\r\n        confirmButtonText: 'Yes',\r\n        cancelButtonText: 'No',\r\n        focusCancel: true,\r\n        customClass: {\r\n          container: 'swal2-tailwind'\r\n        }\r\n      }).then(({ value }) => {\r\n        if (value && value === true) {\r\n          const posData = _.cloneDeep(pos.value)\r\n          const productIndex = _.findIndex(posData.products, { id: product.productId })\r\n          if (productIndex !== -1) {\r\n            posData.products[productIndex].stock =\r\n              Number(posData.products[productIndex].stock) + Number(product.productQuantity)\r\n            store.dispatch(SAVE_PRODUCTS, {\r\n              call: posCalls.value.products,\r\n              data: posData.products\r\n            })\r\n          }\r\n          const favIndex = _.findIndex(posData.favourites, { id: product.productId })\r\n          if (favIndex !== -1) {\r\n            posData.favourites[favIndex].stock =\r\n              Number(pos.value.favourites[favIndex].stock) + Number(product.productQuantity)\r\n          }\r\n          const activeTicket = _.cloneDeep(state.ticket)\r\n          const ticketIndex = _.findIndex(posData.tickets, { ticketId: activeTicket.ticketId })\r\n          if (ticketIndex !== -1) {\r\n            activeTicket.ticketProducts.splice(index, 1)\r\n            state.ticket = activeTicket\r\n            posData.tickets.splice(ticketIndex, 1, activeTicket)\r\n            store.dispatch(SAVE_TICKETS, {\r\n              call: posCalls.value.tickets,\r\n              data: posData.tickets\r\n            })\r\n            store.commit(SET_POS, posData)\r\n            toast.success('Product removed successfully!')\r\n            saveNotification('Product removed successfully!')\r\n          }\r\n        }\r\n      })\r\n    }\r\n    // Initialize socket\r\n    const initSocket = () => {\r\n      state.socket = new WebSocket('wss://wss.cointopay.com/transactions')\r\n      state.socket.onmessage = (event) => {\r\n        if (event && event.data) {\r\n          const parts = event.data.split(':')\r\n          if (parts[0].toLowerCase() === 'pos') {\r\n            const merchantID = parts[1]\r\n            if (user.value && merchantID.toString() === user.value.ID.toString()) {\r\n              store.dispatch(FETCH_POS_DATA, {})\r\n            }\r\n          }\r\n        }\r\n      }\r\n      state.socket.onclose = (event) => {\r\n        if (!state.isSocketClosed) {\r\n          initSocket()\r\n        }\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      state.employee = _.find(pos.value.users, { isLoggedIn: 'true' })\r\n      if (Object.keys(route.params).length > 0 && route.params.ticketId) {\r\n        state.ticket = _.find(pos.value.tickets, { ticketId: route.params.ticketId })\r\n        initSocket()\r\n      }\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      state.isSocketClosed = true\r\n      if (state.socket) {\r\n        state.socket.close()\r\n      }\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      toFixed,\r\n      currency,\r\n      launchUpdateCartItem,\r\n      removeItemFromCart\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.table-sm {\r\n  thead {\r\n    tr {\r\n      th:first-child {\r\n        @apply pl-3;\r\n      }\r\n    }\r\n  }\r\n\r\n  tbody {\r\n    tr {\r\n      td:first-child {\r\n        @apply pl-3;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <modal :maxWidth=\"maxWidth\" :show=\"show\" @close=\"closeModal()\">\r\n    <template #title>\r\n      <div class=\"flex items-center justify-between\">\r\n        <span>{{ translate('pos.title') }}</span>\r\n        <span class=\"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer\"\r\n              @click=\"closeModal()\">\r\n          <icon name=\"close\"></icon>\r\n        </span>\r\n      </div>\r\n    </template>\r\n    <template #content>\r\n      <div v-if=\"item\">\r\n        <form @submit.prevent=\"submit()\">\r\n          <p>{{ item.itemName }}</p>\r\n          <div class=\"mb-2\">\r\n            <label class=\"block mb-1\">{{ translate('pos.tickets.lbl_quantity') }}</label>\r\n            <div class=\"flex items-center\">\r\n              <j-button @click=\"sub()\" type=\"button\" class=\"rounded-r-none\">\r\n                <icon name=\"minus\"></icon>\r\n              </j-button>\r\n              <input @keyup=\"validateQty()\"\r\n                     class=\"form-input w-24 text-center rounded-none\" type=\"text\" v-model=\"form.qty\"/>\r\n              <j-button @click=\"add()\" type=\"button\" class=\"rounded-l-none\">\r\n                <icon name=\"plus\"></icon>\r\n              </j-button>\r\n            </div>\r\n            <div class=\"text-red-700 dark:text-red-400 text-sm\">{{ showError(errorBag, 'qty') }}</div>\r\n          </div>\r\n\r\n          <p>{{ translate('pos.tickets.stock_left') }} {{ stockLeft }}</p>\r\n          <p>{{ translate('pos.tickets.product_price') }} {{ `${item.productPrice} ${currency}` }}</p>\r\n          <p>{{ translate('pos.tickets.total_price') }} {{ `${totalPrice} ${currency}` }}</p>\r\n\r\n          <div class=\"mt-4 text-right\">\r\n            <j-button :disabled=\"isProcessing\">\r\n              <div v-if=\"isProcessing\" class=\"mr-3\">\r\n                <icon :name=\"'spinner'\" classes=\"w-4 h-4 text-white\"></icon>\r\n              </div>\r\n              <span>{{ translate('pos.tickets.btn_save') }}</span>\r\n            </j-button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </template>\r\n  </modal>\r\n</template>\r\n\r\n<script>\r\nimport Modal from '@/components/Modal'\r\nimport Icon from '@/components/Icon'\r\nimport JButton from '@/templates/Button'\r\nimport { computed, inject, onBeforeMount, reactive, toRefs, watch } from 'vue'\r\nimport validator from '@/validator'\r\nimport * as _ from 'lodash'\r\nimport { useStore } from 'vuex'\r\nimport { SAVE_PRODUCTS, SAVE_TICKETS, SET_POS } from '@/store/keys'\r\n\r\nexport default {\r\n  name: 'UpdateCartItemModal',\r\n  components: {\r\n    Modal,\r\n    Icon,\r\n    JButton\r\n  },\r\n  setup () {\r\n    // Providers\r\n    const translate = inject('translate')\r\n    const emitter = inject('emitter')\r\n    const toast = inject('toast')\r\n    // Store\r\n    const store = useStore()\r\n\r\n    const {\r\n      showError,\r\n      validate\r\n    } = validator()\r\n\r\n    // State\r\n    const state = reactive({\r\n      show: false,\r\n      maxWidth: '2xl',\r\n      closeable: true,\r\n      item: null,\r\n      ticket: null,\r\n      itemIndex: -1,\r\n      currency: 'EUR',\r\n      form: {\r\n        qty: 0\r\n      },\r\n      errorBag: {},\r\n      rules: {\r\n        qty: ['required', 'minValue:1']\r\n      },\r\n      messages: {\r\n        qty: {\r\n          required: 'Please enter valid quantity',\r\n          minValue: 'Quantity should be greater than 0'\r\n        }\r\n      },\r\n      isProcessing: false,\r\n      confirmHook: () => {\r\n      }\r\n    })\r\n\r\n    // Computed\r\n    const pos = computed(() => store.state.pos)\r\n    const posCalls = computed(() => store.state.posCalls)\r\n    const stockLeft = computed(() => {\r\n      if (!state.item) {\r\n        return 0\r\n      }\r\n      const product = _.find(pos.value.products, { id: state.item.productId })\r\n      return product ? Number(product.stock) + Number(state.item.productQuantity) - Number(state.form.qty) : 0\r\n    })\r\n    const totalPrice = computed(() => {\r\n      return state.item ? (state.item.productPrice * state.form.qty).toFixed(8) : 0\r\n    })\r\n\r\n    // Watch\r\n    watch(() => ({ ...state.form }),\r\n      (newVal, oldVal) => {\r\n        if (Object.keys(state.errorBag).length > 0) {\r\n          state.errorBag = validate(state.form, state.rules, state.messages)\r\n        }\r\n      })\r\n\r\n    // Methods\r\n    const closeModal = () => {\r\n      state.show = false\r\n    }\r\n    const add = () => {\r\n      if (Number(state.form.qty) < Number(stockLeft.value)) {\r\n        state.form.qty = Number(state.form.qty) + 1\r\n      }\r\n    }\r\n    const sub = () => {\r\n      if (Number(state.form.qty) > 1) {\r\n        state.form.qty = Number(state.form.qty) - 1\r\n      }\r\n    }\r\n    const validateQty = () => {\r\n      if (Number(state.form.qty) < 1) {\r\n        state.form.qty = 1\r\n      } else if (Number(state.form.qty) > Number(stockLeft.value)) {\r\n        state.form.qty = Number(stockLeft.value)\r\n      }\r\n    }\r\n    const submit = () => {\r\n      state.errorBag = validate(state.form, state.rules, state.messages)\r\n      if (Object.keys(state.errorBag).length === 0) {\r\n        state.isProcessing = true\r\n        const posData = _.cloneDeep(pos.value)\r\n        const ticketIndex = _.findIndex(posData.tickets, { ticketId: state.ticket.ticketId.toString() })\r\n        if (ticketIndex !== -1) {\r\n          posData.tickets[ticketIndex].ticketProducts[state.itemIndex].productQuantity = state.form.qty\r\n          posData.tickets[ticketIndex].paymentRequest = null\r\n          store.dispatch(SAVE_TICKETS, {\r\n            call: posCalls.value.tickets,\r\n            data: posData.tickets\r\n          })\r\n          const productIndex = _.findIndex(posData.products, { id: state.item.productId })\r\n          if (productIndex !== -1) {\r\n            posData.products[productIndex].stock = stockLeft.value.toString()\r\n            store.dispatch(SAVE_PRODUCTS, {\r\n              call: posCalls.value.products,\r\n              data: posData.products\r\n            })\r\n          }\r\n          const favIndex = _.findIndex(posData.favourites, { id: state.item.productId })\r\n          if (favIndex !== -1) {\r\n            posData.favourites[favIndex].stock = stockLeft.value.toString()\r\n          }\r\n          \r\n          store.commit(SET_POS, posData)\r\n          toast.success('Quantity updated successfully')\r\n          state.isProcessing = false\r\n          state.confirmHook()\r\n          closeModal()\r\n        }\r\n      }\r\n    }\r\n\r\n    onBeforeMount(() => {\r\n      emitter.on('updateCartItemModal', (args) => {\r\n        state.currency = args.currency\r\n        state.item = args.product\r\n        state.ticket = args.ticket\r\n        state.itemIndex = args.itemIndex\r\n        state.confirmHook = args.confirm\r\n        state.form = {\r\n          qty: Number(state.item.productQuantity)\r\n        }\r\n        // Show modal\r\n        state.show = true\r\n      })\r\n    })\r\n\r\n    return {\r\n      translate,\r\n      ...toRefs(state),\r\n      stockLeft,\r\n      totalPrice,\r\n      closeModal,\r\n      showError,\r\n      add,\r\n      sub,\r\n      validateQty,\r\n      submit\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped></style>\r\n","import { render } from \"./UpdateCartItemModal.vue?vue&type=template&id=4bf642cb\"\nimport script from \"./UpdateCartItemModal.vue?vue&type=script&lang=js\"\nexport * from \"./UpdateCartItemModal.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\zeesh\\\\OneDrive\\\\Desktop\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Ticket.vue?vue&type=template&id=1f31a733&scoped=true\"\nimport script from \"./Ticket.vue?vue&type=script&lang=js\"\nexport * from \"./Ticket.vue?vue&type=script&lang=js\"\n\nimport \"./Ticket.vue?vue&type=style&index=0&id=1f31a733&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\zeesh\\\\OneDrive\\\\Desktop\\\\Cointopay\\\\cointopay.com.frontend.vuejs3.paymentfocus\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-1f31a733\"]])\n\nexport default __exports__"],"sourceRoot":""}