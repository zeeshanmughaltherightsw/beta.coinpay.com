"use strict";(self["webpackChunkcointopay"]=self["webpackChunkcointopay"]||[]).push([[464],{784:function(e,t,o){o.d(t,{Z:function(){return p}});var n=o(821);const r={class:"p-4"},a={class:"max-w-7xl 3xl:max-w-8xl mx-auto"},i={class:"flex flex-col md:flex-row space-x-0 md:space-x-4"},l={class:"w-full mb-4 md:mb-0 bg-white dark:bg-gray-800 rounded shadow p-4",style:{"min-height":"calc(100vh - 351px)"}};function c(e,t,o,c,s,d){return(0,n.openBlock)(),(0,n.createElementBlock)("div",r,[(0,n.createElementVNode)("div",a,[(0,n.createElementVNode)("div",i,[(0,n.createElementVNode)("div",l,[(0,n.renderSlot)(e.$slots,"default")])])])])}var s={name:"CenteredLayout"},d=o(3744);const m=(0,d.Z)(s,[["render",c]]);var p=m},5943:function(e,t,o){o.r(t),o.d(t,{default:function(){return Ve}});var n=o(821);const r={class:"text-center mb-3"},a={class:"font-bold"},i={class:"font-bold"},l={class:"w-full lg:w-3/5 mx-auto"},c={class:"mb-4"},s={class:"text-3xl font-bold text-blue-500 text-center"},d=["href"],m=(0,n.createElementVNode)("span",{class:"mr-2"},"Click to Redirect",-1),p={key:0},u={class:"mt-4"},v={class:"flex justify-center flex-wrap items-stretch w-full mb-4 relative"},h={class:"flex -mr-px"},g={class:"mb-4"},k={class:"text-3xl font-bold text-blue-500 text-center"},N=["href"],y=(0,n.createElementVNode)("span",{class:"mr-2"},"Click to Redirect",-1),b={key:0},V={class:"mt-4"},f={key:0,class:"text-center mb-3"},E={class:"flex justify-center flex-wrap items-stretch w-full mb-4 relative"},x={class:"flex -mr-px"},C={class:"mb-4"},w={class:"text-3xl font-bold text-blue-500 text-center"},O=["href"],q=(0,n.createElementVNode)("span",{class:"mr-2"},"Click to Redirect",-1),B={key:0},S={class:"text-center"},T={key:0,class:"card mt-4"},D={class:"body"},I={class:"scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},R={class:"table-sm mb-2"},L=(0,n.createElementVNode)("th",null,"Item",-1),P={key:0},A=(0,n.createElementVNode)("th",null,"Price",-1),M=(0,n.createElementVNode)("th",null,"Quantity",-1),j=(0,n.createElementVNode)("th",null,"Subtotal",-1),_={class:"flex items-center"},Z=["src","onClick"],U={key:0},$={key:0},F=["colspan"],z={colspan:"1"},Q={key:1},H=["colspan"],K={class:"text-red-500"},W={colspan:"1"},G={class:"text-red-500"},J=["colspan"],X=(0,n.createElementVNode)("span",{class:"font-bold"},"Total:",-1),Y=[X],ee={colspan:"1"},te={class:"font-bold"},oe={class:"text-center"},ne=(0,n.createTextVNode)("Invoice Page ");function re(e,t,o,X,re,ae){const ie=(0,n.resolveComponent)("icon"),le=(0,n.resolveComponent)("QRCodeVue3"),ce=(0,n.resolveComponent)("Tab"),se=(0,n.resolveComponent)("TabSet"),de=(0,n.resolveComponent)("router-link"),me=(0,n.resolveComponent)("centered-layout");return(0,n.openBlock)(),(0,n.createBlock)(me,null,{default:(0,n.withCtx)((()=>[e.invoice&&!X.isInvoiceComplete?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[(0,n.createElementVNode)("div",r,[(0,n.createElementVNode)("p",null,(0,n.toDisplayString)(X.translate("pos.invoice.message")),1),(0,n.createElementVNode)("p",null,[(0,n.createElementVNode)("span",a,(0,n.toDisplayString)(X.translate("pos.invoice.merchant")),1),(0,n.createTextVNode)(" "+(0,n.toDisplayString)(e.invoice.ShopTitle),1)]),(0,n.createElementVNode)("p",null,[(0,n.createElementVNode)("span",i,(0,n.toDisplayString)(X.translate("pos.invoice.invoice_number")),1),(0,n.createTextVNode)("  "+(0,n.toDisplayString)(e.invoice.TransactionID),1)])]),(0,n.createElementVNode)("div",l,[(0,n.createVNode)(se,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(ce,{name:X.translate("invoice.address_only")},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",c,[(0,n.createElementVNode)("p",s,(0,n.toDisplayString)(e.timer),1),X.isPaid?((0,n.openBlock)(),(0,n.createElementBlock)("a",{key:0,href:e.invoice.RedirectTargetURL,class:"mt-3 text-blue-500 hover:underline inline-flex items-center"},[m,(0,n.createVNode)(ie,{name:"arrow-right",classes:"w-5 h-5"})],8,d)):(0,n.createCommentVNode)("",!0)]),X.isPaid||X.isExpired?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createElementBlock)("div",p,[(0,n.createVNode)(le,{imgclass:"mx-auto",width:X.qrOptions.width,height:X.qrOptions.height,"qr-options":X.qrOptions.qrOptions,"background-options":X.qrOptions.backgroundOptions,"dots-options":X.qrOptions.dotsOptions,"corners-dot-options":X.qrOptions.cornersDotOptions,"corners-square-options":X.qrOptions.cornersSquareOptions,value:e.invoice.coinAddress},null,8,["width","height","qr-options","background-options","dots-options","corners-dot-options","corners-square-options","value"]),(0,n.createElementVNode)("div",u,[(0,n.createElementVNode)("div",v,[(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=t=>e.invoice.coinAddress=t),readonly:"",class:"form-input w-2/3 rounded-r-none"},null,512),[[n.vModelText,e.invoice.coinAddress]]),(0,n.createElementVNode)("div",h,[(0,n.createElementVNode)("span",{onClick:t[1]||(t[1]=t=>X.copyToClipboard(e.invoice.coinAddress)),class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-300 dark:border-gray-600 px-3 whitespace-no-wrap text-sm"},[(0,n.createVNode)(ie,{name:"clipboard",classes:"w-5 h-5"})])])])])]))])),_:1},8,["name"]),(0,n.createVNode)(ce,{name:X.translate("invoice.full_crypto_link"),selected:!0},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",g,[(0,n.createElementVNode)("p",k,(0,n.toDisplayString)(e.timer),1),X.isPaid?((0,n.openBlock)(),(0,n.createElementBlock)("a",{key:0,href:e.invoice.RedirectTargetURL,class:"mt-3 text-blue-500 hover:underline inline-flex items-center"},[y,(0,n.createVNode)(ie,{name:"arrow-right",classes:"w-5 h-5"})],8,N)):(0,n.createCommentVNode)("",!0)]),X.isPaid||X.isExpired?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createElementBlock)("div",b,[(0,n.createVNode)(le,{imgclass:"mx-auto",width:X.qrOptions.width,height:X.qrOptions.height,"qr-options":X.qrOptions.qrOptions,"background-options":X.qrOptions.backgroundOptions,"dots-options":X.qrOptions.dotsOptions,"corners-dot-options":X.qrOptions.cornersDotOptions,"corners-square-options":X.qrOptions.cornersSquareOptions,value:X.qrLink},null,8,["width","height","qr-options","background-options","dots-options","corners-dot-options","corners-square-options","value"]),(0,n.createElementVNode)("div",V,[e.invoice.Tag?((0,n.openBlock)(),(0,n.createElementBlock)("div",f,"Memo/Tag: "+(0,n.toDisplayString)(e.invoice.Tag),1)):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",E,[(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.invoice.coinAddress=t),readonly:"",class:"form-input w-2/3 rounded-r-none"},null,512),[[n.vModelText,e.invoice.coinAddress]]),(0,n.createElementVNode)("div",x,[(0,n.createElementVNode)("span",{onClick:t[3]||(t[3]=t=>X.copyToClipboard(e.invoice.coinAddress)),class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-300 dark:border-gray-600 px-3 whitespace-no-wrap text-sm"},[(0,n.createVNode)(ie,{name:"clipboard",classes:"w-5 h-5"})])])])])]))])),_:1},8,["name"]),(0,n.createVNode)(ce,{name:X.translate("invoice.tzero")},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",C,[(0,n.createElementVNode)("p",w,(0,n.toDisplayString)(e.timer),1),X.isPaid?((0,n.openBlock)(),(0,n.createElementBlock)("a",{key:0,href:e.invoice.RedirectTargetURL,class:"mt-3 text-blue-500 hover:underline inline-flex items-center"},[q,(0,n.createVNode)(ie,{name:"arrow-right",classes:"w-5 h-5"})],8,O)):(0,n.createCommentVNode)("",!0)]),X.isPaid||X.isExpired?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createElementBlock)("div",B,[(0,n.createVNode)(le,{imgclass:"mx-auto",width:X.qrOptions.width,height:X.qrOptions.height,"qr-options":X.qrOptions.qrOptions,"background-options":X.qrOptions.backgroundOptions,"dots-options":X.qrOptions.dotsOptions,"corners-dot-options":X.qrOptions.cornersDotOptions,"corners-square-options":X.qrOptions.cornersSquareOptions,value:e.invoice.TZERO},null,8,["width","height","qr-options","background-options","dots-options","corners-dot-options","corners-square-options","value"])]))])),_:1},8,["name"])])),_:1}),(0,n.createElementVNode)("p",S,(0,n.toDisplayString)(`${X.translate("pos.invoice.amount")}: ${e.invoice.Amount} ${e.invoice.LongName}`),1),e.order.items.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("div",T,[(0,n.createElementVNode)("div",D,[(0,n.createElementVNode)("div",I,[(0,n.createElementVNode)("table",R,[(0,n.createElementVNode)("thead",null,[(0,n.createElementVNode)("tr",null,[L,6===Object.keys(e.order.items[0]).length?((0,n.openBlock)(),(0,n.createElementBlock)("th",P,"SKU")):(0,n.createCommentVNode)("",!0),A,M,j])]),(0,n.createElementVNode)("tbody",null,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.order.items,((t,o)=>((0,n.openBlock)(),(0,n.createElementBlock)("tr",{key:o},[(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("div",_,[t.url?((0,n.openBlock)(),(0,n.createElementBlock)("img",{key:0,src:t.url,alt:"",class:"w-12 h-12 rounded-full overflow-hidden mr-2 cursor-pointer",onClick:e=>X.fancyBox(t.url)},null,8,Z)):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("p",null,(0,n.toDisplayString)(t.name),1)])]),6===Object.keys(e.order.items[0]).length?((0,n.openBlock)(),(0,n.createElementBlock)("td",U,(0,n.toDisplayString)(t.sku),1)):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(X.formatPrice(t.price,X.currency)),1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)("x "+t.qty),1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(X.formatPrice(t.price*t.qty,X.currency)),1)])))),128)),e.order.shipping?((0,n.openBlock)(),(0,n.createElementBlock)("tr",$,[(0,n.createElementVNode)("td",{colspan:6===Object.keys(e.order.items[0]).length?4:3,class:"text-right"},(0,n.toDisplayString)(X.translate("invoice.shipping_cost"))+": ",9,F),(0,n.createElementVNode)("td",z,(0,n.toDisplayString)(e.order.shipping.method+" "+X.formatPrice(e.order.shipping.cost,X.currency)),1)])):(0,n.createCommentVNode)("",!0),e.order.coupon?((0,n.openBlock)(),(0,n.createElementBlock)("tr",Q,[(0,n.createElementVNode)("td",{colspan:6===Object.keys(e.order.items[0]).length?4:3,class:"text-right"},[(0,n.createElementVNode)("span",K,(0,n.toDisplayString)(X.translate("invoice.discount"))+":",1)],8,H),(0,n.createElementVNode)("td",W,[(0,n.createElementVNode)("span",G,"-"+(0,n.toDisplayString)(X.formatPrice(e.order.coupon.discount,X.currency)),1)])])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("td",{colspan:6===Object.keys(e.order.items[0]).length?4:3,class:"text-right"},Y,8,J),(0,n.createElementVNode)("td",ee,[(0,n.createElementVNode)("span",te,(0,n.toDisplayString)(X.cartTotal),1)])])])])])])])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",oe,[(0,n.createVNode)(de,{to:{name:"invoice",params:{confirmCode:e.invoice.Security}},tag:"a",class:"btn btn-primary"},{default:(0,n.withCtx)((()=>[ne])),_:1},8,["to"])])])],64)):(0,n.createCommentVNode)("",!0)])),_:1})}var ae=o(784),ie=o(7983),le=o(2119),ce=o(8637),se=o(9783),de=o(1322),me=o(7304),pe=o(2215),ue=o.n(pe),ve=o(9414),he=o(4729),ge=o(6486);const ke=o(1798);var Ne={name:"ShopInvoice",components:{CenteredLayout:ae.Z,TabSet:de.Z,Tab:me.Z,Icon:ie.Z,QRCodeVue3:ue()},setup(){const e=(0,n.inject)("translate"),t=(0,n.inject)("http"),o=(0,le.yj)(),r=(0,le.tv)(),a=(0,ce.oR)(),{qrOptions:i}=(0,ve.Z)(),{copyToClipboard:l,formatPrice:c,fancyBox:s}=(0,he.Z)(),d=(0,n.reactive)({confirmCode:null,invoice:null,order:{items:[],shipping:null,coupon:null},interval:null,transactionInterval:null,timer:null,loader:"",socket:null,isClosedSocket:!1}),m=(0,n.computed)((()=>!!d.invoice&&-1!==["paid","underpaid","complete"].indexOf(d.invoice.Status.toLowerCase()))),p=(0,n.computed)((()=>d.invoice&&("paid"===d.invoice.Status.toLowerCase()||"underpaid"===d.invoice.Status.toLowerCase()))),u=(0,n.computed)((()=>d.invoice&&"expired"===d.invoice.Status.toLowerCase())),v=(0,n.computed)((()=>d.invoice.CoinName.toLowerCase()+":"+d.invoice.coinAddress+"?amount="+d.invoice.Amount)),h=(0,n.computed)((()=>d.invoice?d.invoice.inputCurrency:"EUR")),g=(0,n.computed)((()=>{let e=0;return d.order.items.length>0&&d.order.items.map((t=>{e+=Number(t.qty)*Number(t.price)})),d.order.shipping&&(e+=Number(d.order.shipping.cost)),d.order.coupon&&(e-=Number(d.order.coupon.discount)),c(e,h.value)})),k="https://app.cointopay.com",N=e=>{const t=decodeURIComponent(e.CustomerReferenceNr),o=document.createElement("div");o.innerHTML=t;let n=o.innerHTML.trim();d.order={items:[],shipping:null,coupon:null},n&&(n=n.split(":::").filter(Boolean),n.map((e=>{e=e.split("|").filter(Boolean),6===e.length?d.order.items.push({id:e[0],sku:e[1],name:e[2],url:e[3],price:Number(e[4]),qty:Number(e[5])}):5===e.length?d.order.items.push({id:e[0],name:e[1],url:e[2],price:Number(e[3]),qty:Number(e[4])}):2===e.length?d.order.shipping={method:e[0],cost:e[1]}:3===e.length&&(d.order.coupon={code:e[0],value:e[1],discount:e[2]})})))},y=(e,o="main")=>{d.loader=o;const n={Call:"Transactiondetail",MerchantID:0,APIKey:"_",ConfirmCode:e,output:"json"};t.get(`${k}/v2REAPI`,{params:n}).then((e=>{if(d.loader="",200===e.status&&"failed"!==e.data.result){d.invoice=e.data.data,N(d.invoice),a.commit(se.MF,d.invoice);const t=d.invoice.Status.toLowerCase();-1!==["paid","underpaid","expired"].indexOf(t)&&(d.timer=d.invoice.Status,d.transactionInterval&&clearInterval(d.transactionInterval),d.interval&&(clearInterval(d.interval),d.timer=t)),-1!==["waiting","awaiting-fiat"].indexOf(t)&&V()}})).catch((e=>{d.loader="",console.log(e)}))},b=()=>{if(Object.keys(o.params).length>0){const e=o.params.confirmCode;y(e),d.transactionInterval&&clearInterval(d.transactionInterval),d.transactionInterval=setInterval((()=>{y(e,!1)}),6e4)}else r.push({name:"shop"})},V=()=>{if(!d.timer){const e=ke.tz(d.invoice.CreatedOn,"Europe/Amsterdam").add(Number(d.invoice.ExpiryTime),"minutes");d.interval=setInterval((()=>{const t=ke().tz("Europe/Amsterdam").valueOf(),o=e.valueOf()-t,n=Math.floor(o/864e5),r=Math.floor(o%864e5/36e5),a=Math.floor(o%36e5/6e4),i=Math.floor(o%6e4/1e3);d.timer=`${n}d ${r}h ${a}m ${i}s`,o<0&&(clearInterval(d.interval),d.timer="Expired",y(d.invoice.ConfirmCode,""))}),1e3)}},f=()=>{d.socket=new WebSocket("wss://wss.cointopay.com/transactions"),d.socket.onmessage=e=>{if(e&&e.data){const t=e.data.split(":");if(d.invoice){const e=ge.cloneDeep(d.invoice);"TZERO"===t[0]&&e&&Number(e.TransactionID)===Number(t[1])&&(d.interval&&clearInterval(d.interval),e.Status=t[2].toLowerCase(),a.commit(se.MF,e))}}},d.socket.onclose=e=>{d.isClosedSocket||f()}};return(0,n.onBeforeMount)((()=>{b(),f()})),(0,n.onBeforeUnmount)((()=>{d.transactionInterval&&clearInterval(d.transactionInterval),d.interval&&clearInterval(d.interval),null!==d.socket&&(d.isClosedSocket=!0,d.socket.close())})),{translate:e,...(0,n.toRefs)(d),currency:h,isInvoiceComplete:m,copyToClipboard:l,qrOptions:i,isPaid:p,isExpired:u,qrLink:v,formatPrice:c,cartTotal:g,fancyBox:s}}},ye=o(3744);const be=(0,ye.Z)(Ne,[["render",re]]);var Ve=be}}]);
//# sourceMappingURL=shop-invoice.1fe6a9ae.js.map