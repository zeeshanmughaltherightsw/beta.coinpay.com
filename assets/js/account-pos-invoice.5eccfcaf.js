"use strict";(self["webpackChunkcointopay"]=self["webpackChunkcointopay"]||[]).push([[279],{9069:function(e,t,o){o.d(t,{Z:function(){return l}});var n=o(821);const r=(0,n.createStaticVNode)('<div class="p-2 w-full mx-auto"><div class="animate-pulse"><div class="flex-1 space-y-3 py-1"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-2"></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-1"></div></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div></div></div></div></div><div class="p-2 w-full mx-auto"><div class="animate-pulse"><div class="flex-1 space-y-3 py-1"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-1"></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-2"></div></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div></div></div></div></div>',2);function i(e,t,o,n,i,a){return r}var a={name:"PulseSkeleton"},s=o(3744);const c=(0,s.Z)(a,[["render",i]]);var l=c},6129:function(e,t,o){o.r(t),o.d(t,{default:function(){return ee}});var n=o(821);const r={class:"mb-4 text-center"},i={class:"font-bold mr-2"},a={class:"font-bold mr-2"},s={class:"mb-4 flex items-center flex-col"},c={class:"flex flex-wrap justify-center items-stretch w-full relative"},l=["value"],d={class:"flex -mr-px"},p={class:"mb-4 flex items-center flex-col"},u={class:"flex flex-wrap justify-center items-stretch w-full relative"},m=["value"],v={class:"flex -mr-px"},g={class:"mb-4 flex items-center justify-between flex-col"},y={class:"text-center"},h={class:"text-2xl font-bold text-blue-500 text-center capitalize"},k={key:0,class:"mt-4"},f={class:"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},b={class:"table-md"},N=(0,n.createElementVNode)("thead",null,[(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("th",{style:{"min-width":"250px"}},"Item"),(0,n.createElementVNode)("th",null,"SKU"),(0,n.createElementVNode)("th",null,"Price"),(0,n.createElementVNode)("th",null,"Quantity"),(0,n.createElementVNode)("th",null,"Subtotal")])],-1),E={class:""},V=["src"],C={class:"mb-0 ml-1"},q={key:0},x={class:"text-right",colspan:"3"},w={colspan:"2"},I={key:1},S={class:"text-right",colspan:"3"},O={class:"text-blue-500",colspan:"2"},D=(0,n.createElementVNode)("td",{class:"text-right",colspan:"3"},[(0,n.createElementVNode)("span",{class:"font-bold"},"Total:")],-1),R={colspan:"2"},T={class:"font-bold"},A={class:"mt-2 text-center"},B=["href"];function P(e,t,o,P,_,U){const M=(0,n.resolveComponent)("QRCodeVue3"),L=(0,n.resolveComponent)("icon"),Z=(0,n.resolveComponent)("tab"),$=(0,n.resolveComponent)("tab-set"),j=(0,n.resolveComponent)("pulse-skeleton"),z=(0,n.resolveComponent)("pos-layout");return(0,n.openBlock)(),(0,n.createBlock)(z,null,{content:(0,n.withCtx)((()=>[e.ticket&&e.invoice&&!P.isInvoiceComplete&&!e.isProcessing?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[(0,n.createElementVNode)("div",r,[(0,n.createElementVNode)("p",null,(0,n.toDisplayString)(P.translate("pos.invoice.message")),1),(0,n.createElementVNode)("p",null,[(0,n.createElementVNode)("span",i,(0,n.toDisplayString)(P.translate("pos.invoice.merchant"))+":",1),(0,n.createElementVNode)("span",null,(0,n.toDisplayString)(e.invoice.ShopTitle),1)]),(0,n.createElementVNode)("p",null,[(0,n.createElementVNode)("span",a,(0,n.toDisplayString)(P.translate("pos.invoice.invoice_number")),1),(0,n.createElementVNode)("span",null,(0,n.toDisplayString)(e.invoice.TransactionID),1)])]),(0,n.createVNode)($,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(Z,{name:P.translate("invoice.address_only")},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",s,[(0,n.createVNode)(M,{"background-options":P.qrOptions.backgroundOptions,"corners-dot-options":P.qrOptions.cornersDotOptions,"corners-square-options":P.qrOptions.cornersSquareOptions,"dots-options":P.qrOptions.dotsOptions,height:P.qrOptions.height,"qr-options":P.qrOptions.qrOptions,value:e.invoice.coinAddress,width:P.qrOptions.width,imgclass:"mx-auto mb-4"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"]),(0,n.createElementVNode)("div",c,[(0,n.createElementVNode)("input",{value:decodeURIComponent(e.invoice.coinAddress),class:"form-input flex-1 md:flex-none md:w-2/3 rounded-r-none",readonly:"",type:"text"},null,8,l),(0,n.createElementVNode)("div",d,[(0,n.createElementVNode)("span",{class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-500 px-3 whitespace-no-wrap text-sm",onClick:t[0]||(t[0]=t=>P.copyToClipboard(decodeURIComponent(e.invoice.coinAddress)))},[(0,n.createVNode)(L,{classes:"w-5 h-5",name:"clipboard"})])])])])])),_:1},8,["name"]),(0,n.createVNode)(Z,{name:P.translate("invoice.full_crypto_link"),selected:!0},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",p,[(0,n.createVNode)(M,{"background-options":P.qrOptions.backgroundOptions,"corners-dot-options":P.qrOptions.cornersDotOptions,"corners-square-options":P.qrOptions.cornersSquareOptions,"dots-options":P.qrOptions.dotsOptions,height:P.qrOptions.height,"qr-options":P.qrOptions.qrOptions,value:P.cryptoLink,width:P.qrOptions.width,imgclass:"mx-auto mb-4"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"]),(0,n.createElementVNode)("div",u,[(0,n.createElementVNode)("input",{value:decodeURIComponent(e.invoice.coinAddress),class:"form-input flex-1 md:flex-none md:w-2/3 rounded-r-none",readonly:"",type:"text"},null,8,m),(0,n.createElementVNode)("div",v,[(0,n.createElementVNode)("span",{class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-500 px-3 whitespace-no-wrap text-sm",onClick:t[1]||(t[1]=t=>P.copyToClipboard(decodeURIComponent(e.invoice.coinAddress)))},[(0,n.createVNode)(L,{classes:"w-5 h-5",name:"clipboard"})])])])])])),_:1},8,["name"]),(0,n.createVNode)(Z,{name:P.translate("invoice.tzero")},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",g,[(0,n.createVNode)(M,{"background-options":P.qrOptions.backgroundOptions,"corners-dot-options":P.qrOptions.cornersDotOptions,"corners-square-options":P.qrOptions.cornersSquareOptions,"dots-options":P.qrOptions.dotsOptions,height:P.qrOptions.height,"qr-options":P.qrOptions.qrOptions,value:e.invoice.TZERO,width:P.qrOptions.width,imgclass:"mx-auto"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"])])])),_:1},8,["name"])])),_:1}),(0,n.createElementVNode)("p",y,(0,n.toDisplayString)(P.translate("pos.invoice.amount"))+": "+(0,n.toDisplayString)(`${e.invoice.Amount} ${e.invoice.LongName}`),1),(0,n.createElementVNode)("p",h,(0,n.toDisplayString)(e.timer),1),e.order.items.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("div",k,[(0,n.createElementVNode)("div",f,[(0,n.createElementVNode)("table",b,[N,(0,n.createElementVNode)("tbody",null,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.order.items,((e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("tr",{key:t},[(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("div",E,[(0,n.createElementVNode)("img",{src:e.url,alt:"",style:{width:"100px"}},null,8,V),(0,n.createElementVNode)("p",C,(0,n.toDisplayString)(e.name),1)])]),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(e.sku),1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(P.formatPrice(e.price,P.currency)),1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(`x ${e.qty}`),1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(P.formatPrice(e.price*e.qty,P.currency)),1)])))),128)),e.order.shipping?((0,n.openBlock)(),(0,n.createElementBlock)("tr",q,[(0,n.createElementVNode)("td",x,(0,n.toDisplayString)(P.translate("invoice.shipping_cost")),1),(0,n.createElementVNode)("td",w,(0,n.toDisplayString)(e.order.shipping.method+" "+P.formatPrice(e.order.shipping.cost,P.currency)),1)])):(0,n.createCommentVNode)("",!0),e.order.coupon?((0,n.openBlock)(),(0,n.createElementBlock)("tr",I,[(0,n.createElementVNode)("td",S,(0,n.toDisplayString)(P.translate("invoice.discount")),1),(0,n.createElementVNode)("td",O,(0,n.toDisplayString)(`-${P.formatPrice(e.order.coupon.discount,P.currency)}`),1)])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("tr",null,[D,(0,n.createElementVNode)("td",R,[(0,n.createElementVNode)("span",T,(0,n.toDisplayString)(P.cartTotal),1)])])])])])])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",A,[(0,n.createElementVNode)("a",{href:e.ticket.paymentRequest.RedirectURL,class:"btn btn-primary",target:"_blank"},"Invoice Detail",8,B)])],64)):(0,n.createCommentVNode)("",!0),e.isProcessing?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createVNode)(j),(0,n.createVNode)(j)],64)):(0,n.createCommentVNode)("",!0)])),_:1})}var _=o(2630),U=o(8637),M=o(6486),L=o(9783),Z=o(2119),$=o(8),j=o(4729),z=o(9069),F=o(1322),K=o(7304),Q=o(2215),H=o.n(Q),Y=o(9414),W=o(7983),G={name:"Invoice",components:{PulseSkeleton:z.Z,"pos-layout":_.Z,TabSet:F.Z,Tab:K.Z,QRCodeVue3:H(),Icon:W.Z},setup(){const e=(0,n.inject)("translate"),t=(0,n.inject)("http"),o=(0,U.oR)(),r=(0,Z.yj)(),i=(0,Z.tv)(),{generateId:a,copyToClipboard:s,formatPrice:c}=(0,j.Z)(),{qrOptions:l}=(0,Y.Z)(),d=(0,n.reactive)({invoice:null,ticket:null,order:{items:[],shipping:null,coupon:null},invoiceStatus:null,timer:null,interval:null,transactionInterval:null,socket:null,isCloseSocket:!1,isProcessing:!1}),p=(0,n.computed)((()=>o.state.pos)),u=(0,n.computed)((()=>o.state.posCalls)),m=(0,n.computed)((()=>`${d.invoice.CoinName.toLowerCase()}:${d.invoice.coinAddress}?amount=${d.invoice.Amount}`)),v=(0,n.computed)((()=>d.ticket.paymentRequest?d.ticket.paymentRequest.inputCurrency:"EUR")),g=(0,n.computed)((()=>{let e=0;return d.order.items.length>0&&d.order.items.map((t=>{e+=Number(t.qty)*Number(t.price)})),d.order.shipping&&(e+=Number(d.order.shipping.cost)),d.order.coupon&&(e-=Number(d.order.coupon.discount)),c(e,v.value)})),y=(0,n.computed)((()=>!!d.invoiceStatus&&-1!==["paid","underpaid","complete"].indexOf(d.invoiceStatus))),h="https://app.cointopay.com",k=(e,n=!0)=>{d.isProcessing=n;const r={Call:"Transactiondetail",MerchantID:0,APIKey:"_",ConfirmCode:e,output:"json"};t.get(`${h}/v2REAPI`,{params:r}).then((t=>{if(d.isProcessing=!1,200===t.status&&"failed"!==t.data.result&&(d.invoice=t.data.data,d.invoice)){const t=M.cloneDeep(p.value.tickets),n=M.findIndex(t,(t=>t.paymentRequest&&t.paymentRequest.Security===e));if(-1!==n){if(d.ticket=t[n],d.ticket){b(d.ticket.paymentRequest);const e=d.invoice.Status.toLowerCase();if("paid"===e||"underpaid"===e?t[n].status="paid":"waiting"===e?t[n].status="inprogress":"expired"===e&&(t[n].status="waiting"),"waiting"===d.ticket.status)t[n].paymentRequest=null;else if("paid"===d.ticket.status){t[n].isActive=!1;const e=M.find(p.value.receipts,{TICKETNUMBER:d.ticket.id.toString()});e||N(d.ticket)}}t[n].paymentRequest=d.invoice,o.dispatch(L.yF,{call:u.value.tickets,data:t});const e=d.invoice.Status.toLowerCase();if(d.invoiceStatus=e,"paid"===e||"underpaid"===e||"expired"===e){if(d.timer=d.invoice.Status,d.transactionInterval&&clearInterval(d.transactionInterval),d.interval&&(clearInterval(d.interval),d.timer=e),"paid"===d.ticket.status)return i.push({name:"account-pos-invoice-success",params:{ticketId:d.ticket.ticketId}});if("waiting"===d.ticket.status)return i.push({name:"account-pos-tickets"})}"waiting"!==e&&"awaiting-fiat"!==e||f()}}})).catch((e=>{d.isProcessing=!1,console.log(e)}))},f=()=>{if(!d.timer){const e=$.tz(d.invoice.CreatedOn,"Atlantic/Azores").add(d.invoice.ExpiryTime,"minutes");d.interval=setInterval((()=>{const t=$.tz("Atlantic/Azores").valueOf(),o=e.valueOf()-t,n=Math.floor(o/864e5),r=Math.floor(o%864e5/36e5),i=Math.floor(o%36e5/6e4),a=Math.floor(o%6e4/1e3);d.timer=`${n}d ${r}h ${i}m ${a}s`,o<0&&(clearInterval(d.interval),d.timer="Expired")}),1e3)}},b=e=>{const t=decodeURIComponent(e.CustomerReferenceNr),o=document.createElement("div");o.innerHTML=t;let n=o.innerHTML.trim();d.order={items:[],shipping:null,coupon:null},n&&(n=n.split(":::").filter(Boolean),n.map((e=>{e=e.split("|").filter(Boolean),6===e.length?d.order.items.push({id:e[0],sku:e[1],name:e[2],url:e[3],price:Number(e[4]),qty:Number(e[5])}):5===e.length?d.order.items.push({id:e[0],name:e[1],url:e[2],price:Number(e[3]),qty:Number(e[4])}):2===e.length?d.order.shipping={method:e[0],cost:e[1]}:3===e.length&&(d.order.coupon={code:e[0],value:e[1],discount:e[2]})})))},N=e=>{const t=M.cloneDeep(p.value),n=t.receipts,r={ID:a(n),CASHIER:e.cashier,CURRENCY:e.inputCurrency,DATE:(new Date).getTime().toString(),TRANSACTION_ID:e.paymentRequest.TransactionID.toString(),TICKETNUMBER:e.ticketId.toString(),TOTAL:`Total Price: ${e.paymentRequest.OriginalAmount}`};n.push(r),o.dispatch(L.Z9,{call:u.value.receipts,data:n});const i=t.receiptItems;e.ticketProducts.forEach((e=>{const t={ID:a(i),ITEM_NAME:e.productName,ITEM_PRICE:e.productPrice.toString(),ITEM_SKU:e.productSku,QUANTITY:e.productQuantity.toString(),CURRENCY:e.currency,RECIEPT_ID:r.ID,DATE:(new Date).getTime()};i.push(t)})),o.dispatch(L.CE,{call:u.value.receiptItems,data:i})},E=e=>(e=e.toLowerCase(),"complete"===e?"paid":"failed"===e?"waiting":void 0),V=()=>{d.socket=new WebSocket("wss://wss.cointopay.com/transactions"),d.socket.onmessage=e=>{if(e&&e.data){const t=e.data.split(":");if(d.invoice){const e=M.cloneDeep(d.invoice),n=M.cloneDeep(p.value),r=n.tickets;if("TZERO"===t[0]&&e&&Number(e.TransactionID)===Number(t[1])){const a=M.cloneDeep(d.ticket);4===t.length?(a.status="waiting",a.paymentRequest=null):a&&"inprogress"===a.status.toLowerCase()&&(a.status=E(t[2]),"waiting"===a.status?a.paymentRequest=null:"paid"===a.status&&(a.isActive=!1,N(a)));const s=M.findIndex(r,(e=>{if(e.paymentRequest)return e.paymentRequest.Security===d.invoice.Security}));if(-1!==s){if(d.interval&&clearInterval(d.interval),d.invoiceStatus=e.Status,n.tickets.splice(s,1,a),o.dispatch(L.yF,{call:u.value.tickets,data:n.tickets}),"paid"===a.status)return i.push({name:"account-pos-invoice-success",params:{ticketId:a.ticketId}});if("waiting"===a.status)return i.push({name:"account-pos-tickets"})}}}}},d.socket.onclose=e=>{d.isCloseSocket||V()}};return(0,n.onBeforeMount)((()=>{r.params.confirmCode&&(k(r.params.confirmCode),V())})),(0,n.onBeforeUnmount)((()=>{d.interval&&clearInterval(d.interval),d.transactionInterval&&clearInterval(d.transactionInterval),d.isCloseSocket=!0,d.socket.close()})),{translate:e,...(0,n.toRefs)(d),cryptoLink:m,copyToClipboard:s,qrOptions:l,currency:v,formatPrice:c,cartTotal:g,isInvoiceComplete:y}}},J=o(3744);const X=(0,J.Z)(G,[["render",P]]);var ee=X}}]);
//# sourceMappingURL=account-pos-invoice.5eccfcaf.js.map