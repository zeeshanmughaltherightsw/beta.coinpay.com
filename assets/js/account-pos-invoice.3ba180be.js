(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["account-pos-invoice"],{"8fab":function(e,t,o){"use strict";o.r(t);var n=o("f2bf");const c={class:"mb-4 text-center"},r={class:"font-bold mr-2"},a={class:"font-bold mr-2"},i={class:"mb-4 flex items-center flex-col"},s={class:"flex flex-wrap justify-center items-stretch w-full relative"},l=["value"],d={class:"flex -mr-px"},p={class:"mb-4 flex items-center flex-col"},u={class:"flex flex-wrap justify-center items-stretch w-full relative"},m=["value"],b={class:"flex -mr-px"},O={class:"mb-4 flex items-center justify-between flex-col"},v={class:"text-center"},g={class:"text-2xl font-bold text-blue-500 text-center capitalize"},j={key:0,class:"mt-4"},y={class:"w-full scrollbar scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-track-gray-900 dark:scrollbar-thumb-gray-600"},h={class:"table-md"},f=Object(n["createElementVNode"])("thead",null,[Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",{style:{"min-width":"250px"}},"Item"),Object(n["createElementVNode"])("th",null,"SKU"),Object(n["createElementVNode"])("th",null,"Price"),Object(n["createElementVNode"])("th",null,"Quantity"),Object(n["createElementVNode"])("th",null,"Subtotal")])],-1),k={class:""},N=["src"],E={class:"mb-0 ml-1"},V={key:0},x={class:"text-right",colspan:"3"},q={colspan:"2"},C={key:1},w={class:"text-right",colspan:"3"},I={class:"text-blue-500",colspan:"2"},S=Object(n["createElementVNode"])("td",{class:"text-right",colspan:"3"},[Object(n["createElementVNode"])("span",{class:"font-bold"},"Total:")],-1),D={colspan:"2"},R={class:"font-bold"},T={class:"mt-2 text-center"},A=["href"];function B(e,t,o,B,P,_){const U=Object(n["resolveComponent"])("QRCodeVue3"),M=Object(n["resolveComponent"])("icon"),L=Object(n["resolveComponent"])("tab"),$=Object(n["resolveComponent"])("tab-set"),z=Object(n["resolveComponent"])("pulse-skeleton"),K=Object(n["resolveComponent"])("pos-layout");return Object(n["openBlock"])(),Object(n["createBlock"])(K,null,{content:Object(n["withCtx"])(()=>[e.ticket&&e.invoice&&!B.isInvoiceComplete&&!e.isProcessing?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:0},[Object(n["createElementVNode"])("div",c,[Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(B.translate("pos.invoice.message")),1),Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("span",r,Object(n["toDisplayString"])(B.translate("pos.invoice.merchant"))+":",1),Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.invoice.ShopTitle),1)]),Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("span",a,Object(n["toDisplayString"])(B.translate("pos.invoice.invoice_number")),1),Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.invoice.TransactionID),1)])]),Object(n["createVNode"])($,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(L,{name:B.translate("invoice.address_only")},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",i,[Object(n["createVNode"])(U,{"background-options":B.qrOptions.backgroundOptions,"corners-dot-options":B.qrOptions.cornersDotOptions,"corners-square-options":B.qrOptions.cornersSquareOptions,"dots-options":B.qrOptions.dotsOptions,height:B.qrOptions.height,"qr-options":B.qrOptions.qrOptions,value:e.invoice.coinAddress,width:B.qrOptions.width,imgclass:"mx-auto mb-4"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"]),Object(n["createElementVNode"])("div",s,[Object(n["createElementVNode"])("input",{value:decodeURIComponent(e.invoice.coinAddress),class:"form-input flex-1 md:flex-none md:w-2/3 rounded-r-none",readonly:"",type:"text"},null,8,l),Object(n["createElementVNode"])("div",d,[Object(n["createElementVNode"])("span",{class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-500 px-3 whitespace-no-wrap text-sm",onClick:t[0]||(t[0]=t=>B.copyToClipboard(decodeURIComponent(e.invoice.coinAddress)))},[Object(n["createVNode"])(M,{classes:"w-5 h-5",name:"clipboard"})])])])])]),_:1},8,["name"]),Object(n["createVNode"])(L,{name:B.translate("invoice.full_crypto_link"),selected:!0},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",p,[Object(n["createVNode"])(U,{"background-options":B.qrOptions.backgroundOptions,"corners-dot-options":B.qrOptions.cornersDotOptions,"corners-square-options":B.qrOptions.cornersSquareOptions,"dots-options":B.qrOptions.dotsOptions,height:B.qrOptions.height,"qr-options":B.qrOptions.qrOptions,value:B.cryptoLink,width:B.qrOptions.width,imgclass:"mx-auto mb-4"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"]),Object(n["createElementVNode"])("div",u,[Object(n["createElementVNode"])("input",{value:decodeURIComponent(e.invoice.coinAddress),class:"form-input flex-1 md:flex-none md:w-2/3 rounded-r-none",readonly:"",type:"text"},null,8,m),Object(n["createElementVNode"])("div",b,[Object(n["createElementVNode"])("span",{class:"hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer flex items-center leading-normal rounded rounded-l-none border border-l-0 border-gray-500 px-3 whitespace-no-wrap text-sm",onClick:t[1]||(t[1]=t=>B.copyToClipboard(decodeURIComponent(e.invoice.coinAddress)))},[Object(n["createVNode"])(M,{classes:"w-5 h-5",name:"clipboard"})])])])])]),_:1},8,["name"]),Object(n["createVNode"])(L,{name:B.translate("invoice.tzero")},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",O,[Object(n["createVNode"])(U,{"background-options":B.qrOptions.backgroundOptions,"corners-dot-options":B.qrOptions.cornersDotOptions,"corners-square-options":B.qrOptions.cornersSquareOptions,"dots-options":B.qrOptions.dotsOptions,height:B.qrOptions.height,"qr-options":B.qrOptions.qrOptions,value:e.invoice.TZERO,width:B.qrOptions.width,imgclass:"mx-auto"},null,8,["background-options","corners-dot-options","corners-square-options","dots-options","height","qr-options","value","width"])])]),_:1},8,["name"])]),_:1}),Object(n["createElementVNode"])("p",v,Object(n["toDisplayString"])(B.translate("pos.invoice.amount"))+": "+Object(n["toDisplayString"])(`${e.invoice.Amount} ${e.invoice.LongName}`),1),Object(n["createElementVNode"])("p",g,Object(n["toDisplayString"])(e.timer),1),e.order.items.length>0?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",j,[Object(n["createElementVNode"])("div",y,[Object(n["createElementVNode"])("table",h,[f,Object(n["createElementVNode"])("tbody",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.order.items,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{key:t},[Object(n["createElementVNode"])("td",null,[Object(n["createElementVNode"])("div",k,[Object(n["createElementVNode"])("img",{src:e.url,alt:"",style:{width:"100px"}},null,8,N),Object(n["createElementVNode"])("p",E,Object(n["toDisplayString"])(e.name),1)])]),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(e.sku),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(B.formatPrice(e.price,B.currency)),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])("x "+e.qty),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(B.formatPrice(e.price*e.qty,B.currency)),1)]))),128)),e.order.shipping?(Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",V,[Object(n["createElementVNode"])("td",x,Object(n["toDisplayString"])(B.translate("invoice.shipping_cost")),1),Object(n["createElementVNode"])("td",q,Object(n["toDisplayString"])(e.order.shipping.method+" "+B.formatPrice(e.order.shipping.cost,B.currency)),1)])):Object(n["createCommentVNode"])("",!0),e.order.coupon?(Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",C,[Object(n["createElementVNode"])("td",w,Object(n["toDisplayString"])(B.translate("invoice.discount")),1),Object(n["createElementVNode"])("td",I,Object(n["toDisplayString"])("-"+B.formatPrice(e.order.coupon.discount,B.currency)),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("tr",null,[S,Object(n["createElementVNode"])("td",D,[Object(n["createElementVNode"])("span",R,Object(n["toDisplayString"])(B.cartTotal),1)])])])])])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",T,[Object(n["createElementVNode"])("a",{href:e.ticket.paymentRequest.RedirectURL,class:"btn btn-primary",target:"_blank"},"Invoice Detail",8,A)])],64)):Object(n["createCommentVNode"])("",!0),e.isProcessing?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:1},[Object(n["createVNode"])(z),Object(n["createVNode"])(z)],64)):Object(n["createCommentVNode"])("",!0)]),_:1})}o("14d9");var P=o("66c3"),_=o("5502"),U=o("2ef0"),M=o("8923"),L=o("6605"),$=o("7f45"),z=o("2e13"),K=o("bf2e"),Q=o("bad0"),F=o("f51a"),H=o("61c6"),Y=o.n(H),J=o("3fbe"),Z=o("cdae"),W={name:"Invoice",components:{PulseSkeleton:K["a"],"pos-layout":P["a"],TabSet:Q["a"],Tab:F["a"],QRCodeVue3:Y.a,Icon:Z["a"]},setup(){const e=Object(n["inject"])("translate"),t=Object(n["inject"])("http"),o=Object(_["b"])(),c=Object(L["d"])(),r=Object(L["e"])(),{generateId:a,copyToClipboard:i,formatPrice:s}=Object(z["a"])(),{qrOptions:l}=Object(J["a"])(),d=Object(n["reactive"])({invoice:null,ticket:null,order:{items:[],shipping:null,coupon:null},invoiceStatus:null,timer:null,interval:null,transactionInterval:null,socket:null,isCloseSocket:!1,isProcessing:!1}),p=Object(n["computed"])(()=>o.state.pos),u=Object(n["computed"])(()=>o.state.posCalls),m=Object(n["computed"])(()=>`${d.invoice.CoinName.toLowerCase()}:${d.invoice.coinAddress}?amount=${d.invoice.Amount}`),b=Object(n["computed"])(()=>d.ticket.paymentRequest?d.ticket.paymentRequest.inputCurrency:"EUR"),O=Object(n["computed"])(()=>{let e=0;return d.order.items.length>0&&d.order.items.map(t=>{e+=Number(t.qty)*Number(t.price)}),d.order.shipping&&(e+=Number(d.order.shipping.cost)),d.order.coupon&&(e-=Number(d.order.coupon.discount)),s(e,b.value)}),v=Object(n["computed"])(()=>!!d.invoiceStatus&&-1!==["paid","underpaid","complete"].indexOf(d.invoiceStatus)),g="https://app.cointopay.com",j=(e,n=!0)=>{d.isProcessing=n;const c={Call:"Transactiondetail",MerchantID:0,APIKey:"_",ConfirmCode:e,output:"json"};t.get(g+"/v2REAPI",{params:c}).then(t=>{if(d.isProcessing=!1,200===t.status&&"failed"!==t.data.result&&(d.invoice=t.data.data,d.invoice)){const t=U["cloneDeep"](p.value.tickets),n=U["findIndex"](t,t=>t.paymentRequest&&t.paymentRequest.Security===e);if(-1!==n){if(d.ticket=t[n],d.ticket){h(d.ticket.paymentRequest);const e=d.invoice.Status.toLowerCase();if("paid"===e||"underpaid"===e?t[n].status="paid":"waiting"===e?t[n].status="inprogress":"expired"===e&&(t[n].status="waiting"),"waiting"===d.ticket.status)t[n].paymentRequest=null;else if("paid"===d.ticket.status){t[n].isActive=!1;const e=U["find"](p.value.receipts,{TICKETNUMBER:d.ticket.id.toString()});e||f(d.ticket)}}t[n].paymentRequest=d.invoice,o.dispatch(M["A"],{call:u.value.tickets,data:t});const e=d.invoice.Status.toLowerCase();if(d.invoiceStatus=e,"paid"===e||"underpaid"===e||"expired"===e){if(d.timer=d.invoice.Status,d.transactionInterval&&clearInterval(d.transactionInterval),d.interval&&(clearInterval(d.interval),d.timer=e),"paid"===d.ticket.status)return r.push({name:"account-pos-invoice-success",params:{ticketId:d.ticket.ticketId}});if("waiting"===d.ticket.status)return r.push({name:"account-pos-tickets"})}"waiting"!==e&&"awaiting-fiat"!==e||y()}}}).catch(e=>{d.isProcessing=!1,console.log(e)})},y=()=>{if(!d.timer){const e=$["tz"](d.invoice.CreatedOn,"Atlantic/Azores").add(d.invoice.ExpiryTime,"minutes");d.interval=setInterval(()=>{const t=$["tz"]("Atlantic/Azores").valueOf(),o=e.valueOf()-t,n=Math.floor(o/864e5),c=Math.floor(o%864e5/36e5),r=Math.floor(o%36e5/6e4),a=Math.floor(o%6e4/1e3);d.timer=`${n}d ${c}h ${r}m ${a}s`,o<0&&(clearInterval(d.interval),d.timer="Expired")},1e3)}},h=e=>{const t=decodeURIComponent(e.CustomerReferenceNr),o=document.createElement("div");o.innerHTML=t;let n=o.innerHTML.trim();d.order={items:[],shipping:null,coupon:null},n&&(n=n.split(":::").filter(Boolean),n.map(e=>{e=e.split("|").filter(Boolean),6===e.length?d.order.items.push({id:e[0],sku:e[1],name:e[2],url:e[3],price:Number(e[4]),qty:Number(e[5])}):5===e.length?d.order.items.push({id:e[0],name:e[1],url:e[2],price:Number(e[3]),qty:Number(e[4])}):2===e.length?d.order.shipping={method:e[0],cost:e[1]}:3===e.length&&(d.order.coupon={code:e[0],value:e[1],discount:e[2]})}))},f=e=>{const t=U["cloneDeep"](p.value),n=t.receipts,c={ID:a(n),CASHIER:e.cashier,CURRENCY:e.inputCurrency,DATE:(new Date).getTime().toString(),TRANSACTION_ID:e.paymentRequest.TransactionID.toString(),TICKETNUMBER:e.ticketId.toString(),TOTAL:"Total Price: "+e.paymentRequest.OriginalAmount};n.push(c),o.dispatch(M["x"],{call:u.value.receipts,data:n});const r=t.receiptItems;e.ticketProducts.forEach(e=>{const t={ID:a(r),ITEM_NAME:e.productName,ITEM_PRICE:e.productPrice.toString(),ITEM_SKU:e.productSku,QUANTITY:e.productQuantity.toString(),CURRENCY:e.currency,RECIEPT_ID:c.ID,DATE:(new Date).getTime()};r.push(t)}),o.dispatch(M["y"],{call:u.value.receiptItems,data:r})},k=e=>(e=e.toLowerCase(),"complete"===e?"paid":"failed"===e?"waiting":void 0),N=()=>{d.socket=new WebSocket("wss://wss.cointopay.com/transactions"),d.socket.onmessage=e=>{if(e&&e.data){const t=e.data.split(":");if(d.invoice){const e=U["cloneDeep"](d.invoice),n=U["cloneDeep"](p.value),c=n.tickets;if("TZERO"===t[0]&&e&&Number(e.TransactionID)===Number(t[1])){const a=U["cloneDeep"](d.ticket);4===t.length?(a.status="waiting",a.paymentRequest=null):a&&"inprogress"===a.status.toLowerCase()&&(a.status=k(t[2]),"waiting"===a.status?a.paymentRequest=null:"paid"===a.status?(a.isActive=!1,f(a)):"expired"===a.status&&(a.paymentRequest=null));const i=U["findIndex"](c,e=>{if(e.paymentRequest)return e.paymentRequest.Security===d.invoice.Security});if(-1!==i){if(d.interval&&clearInterval(d.interval),d.invoiceStatus=e.Status,n.tickets.splice(i,1,a),o.dispatch(M["A"],{call:u.value.tickets,data:n.tickets}),"paid"===a.status)return r.push({name:"account-pos-invoice-success",params:{ticketId:a.ticketId}});if("waiting"===a.status)return r.push({name:"account-pos-tickets"})}else if("expired"===a.status)return r.push({name:"account-pos-invoice-expired",params:{ticketId:a.ticketId}})}}}},d.socket.onclose=e=>{d.isCloseSocket||N()}};return Object(n["onBeforeMount"])(()=>{c.params.confirmCode&&(j(c.params.confirmCode),N())}),Object(n["onBeforeUnmount"])(()=>{d.interval&&clearInterval(d.interval),d.transactionInterval&&clearInterval(d.transactionInterval),d.isCloseSocket=!0,d.socket.close()}),{translate:e,...Object(n["toRefs"])(d),cryptoLink:m,copyToClipboard:i,qrOptions:l,currency:b,formatPrice:s,cartTotal:O,isInvoiceComplete:v}}},G=o("6b0d"),X=o.n(G);const ee=X()(W,[["render",B]]);t["default"]=ee},bf2e:function(e,t,o){"use strict";var n=o("f2bf");const c=Object(n["createStaticVNode"])('<div class="p-2 w-full mx-auto"><div class="animate-pulse"><div class="flex-1 space-y-3 py-1"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-2"></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-1"></div></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div></div></div></div></div><div class="p-2 w-full mx-auto"><div class="animate-pulse"><div class="flex-1 space-y-3 py-1"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-1"></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded col-span-2"></div></div><div class="h-2 bg-gray-200 dark:bg-gray-500 rounded"></div></div></div></div></div>',2);function r(e,t,o,n,r,a){return c}var a={name:"PulseSkeleton"},i=o("6b0d"),s=o.n(i);const l=s()(a,[["render",r]]);t["a"]=l}}]);
//# sourceMappingURL=account-pos-invoice.3ba180be.js.map